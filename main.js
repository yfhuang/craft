!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var i=t();for(var n in i)("object"==typeof exports?exports:e)[n]=i[n]}}(window,function(){return function(e){var t={};function i(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,i),o.l=!0,o.exports}return i.m=e,i.c=t,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)i.d(n,o,function(t){return e[t]}.bind(null,o));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=10)}([function(e,t,i){"use strict";var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();var o=i(6);e.exports=function(){function e(t,i,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.GameController=t,this.Game=t.game,this.HighlightCallback=i,this.state=o.NOT_STARTED,this.target=n,this.repeat=!1}return n(e,[{key:"tick",value:function(){}},{key:"begin",value:function(){this.HighlightCallback&&this.HighlightCallback(),this.state=o.WORKING}},{key:"isStarted",value:function(){return this.state!==o.NOT_STARTED}},{key:"isFinished",value:function(){return this.isSucceeded()||this.isFailed()}},{key:"isSucceeded",value:function(){return this.state===o.SUCCESS}},{key:"isFailed",value:function(){return this.state===o.FAILURE}},{key:"succeeded",value:function(){this.state=o.SUCCESS}},{key:"failed",value:function(){this.state=o.FAILURE}}]),e}()},function(e,t,i){"use strict";var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();var o=i(5),a=i(2),r=i(3),s=i(7),l=i(4),c=i(8);e.exports=function(){function e(t,i,n,a,s,l){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.queue=new o(t),this.controller=t,this.game=t.game,this.position=new r(a,s),this.type=i,this.facing=l,this.offset=[-22,-12],this.identifier=n,this.healthPoint=3,this.underTree={state:!1,treeIndex:-1}}return n(e,[{key:"tick",value:function(){this.queue.tick()}},{key:"reset",value:function(){}},{key:"canMoveThrough",value:function(){return!1}},{key:"canPlaceBlock",value:function(){return!1}},{key:"canTriggerPressurePlates",value:function(){return!1}},{key:"shouldUpdateSelectionIndicator",value:function(){return!1}},{key:"setMovePosition",value:function(e){this.position=e}},{key:"getSortOrderOffset",value:function(){return 5}},{key:"addCommand",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.queue.addCommand(e,t),this.queue.begin()}},{key:"getWalkAnimation",value:function(){return"walk"+this.controller.levelView.getDirectionName(this.facing)}},{key:"getIdleAnimation",value:function(){return"idle"+this.controller.levelView.getDirectionName(this.facing)}},{key:"playMoveForwardAnimation",value:function(e,t,i,n){var o,r=this,s=this.controller.levelView,l=e[1]+(t===a.North?1:0);this.sprite.sortOrder=this.controller.levelView.yToIndex(l)+1,s.playBlockSound(n),s.playScaledSpeed(this.sprite.animations,this.getWalkAnimation()),setTimeout(function(){(o=r.controller.levelView.addResettableTween(r.sprite).to({x:r.offset[0]+40*e[0],y:r.offset[1]+40*e[1]},300,Phaser.Easing.Linear.None)).onComplete.add(function(){s.playScaledSpeed(r.sprite.animations,r.getIdleAnimation()),i.succeeded()}),o.start()},50/this.controller.tweenTimeScale)}},{key:"walkableCheck",value:function(){}},{key:"updateHidingTree",value:function(){var e=this.controller.levelView;if(this.underTree.state){var t=this.underTree.treeIndex,i=this.controller.levelEntity.entityMap;e.isUnderTree(t,this.position)||(function(e,t,i){var n=!0,o=!1,a=void 0;try{for(var r,s=t[Symbol.iterator]();!(n=(r=s.next()).done);n=!0){var l=r.value[1];if(l!==e&&l.underTree.treeIndex===i)return!0}}catch(e){o=!0,a=e}finally{try{!n&&s.return&&s.return()}finally{if(o)throw a}}return!1}(this,i,t)||e.changeTreeAlpha(t,1),this.underTree={state:!1,treeIndex:-1})}else for(var n=e.trees,o=0;o<n.length;o++)if(e.isUnderTree(o,this.position)){e.changeTreeAlpha(o,.8),this.underTree={state:!0,treeIndex:o};break}}},{key:"updateHidingBlock",value:function(e){var t=this.controller.levelView,i=this.controller.levelModel.actionPlane;this.isOnBlock||function(e,n){var o=r.south(n),a=i.getBlockAt(o);if(a&&!a.isTransparent){var s=t.actionPlaneBlocks[t.coordinatesToIndex(o)];null!==s&&e.controller.levelView.addResettableTween(s).to({alpha:.8},300,Phaser.Easing.Linear.None).start()}}(this,this.position),void 0!==e&&function(e,i){var n=r.south(i);if(n.y<10){var o=t.actionPlaneBlocks[t.coordinatesToIndex(n)];null!==o&&e.controller.levelView.addResettableTween(o).to({alpha:1},300,Phaser.Easing.Linear.None).start()}}(this,e)}},{key:"doMoveForward",value:function(e,t){var i=this.controller.levelModel,n=this.position;this.position=t;var o=i.groundPlane.getBlockAt(this.position).blockType;this.playMoveForwardAnimation(t,this.facing,e,o,function(){}),this.updateHidingTree(),this.updateHidingBlock(n)}},{key:"bump",value:function(e){var t=this,i=this.controller.levelView.getDirectionName(this.facing);this.controller.levelView.playScaledSpeed(this.sprite.animations,"bump"+i);var n=this.controller.levelModel.getMoveForwardPosition(this),o=this.controller.levelEntity.getEntityAt(n);null!==o&&(this.queue.startPushHighPriorityCommands(),this.controller.events.forEach(function(e){return e({eventType:s.WhenTouched,targetType:t.type,targetIdentifier:t.identifier,eventSenderIdentifier:o.identifier})}),this.queue.endPushHighPriorityCommands()),this.controller.delayPlayerMoveBy(400,800,function(){e.succeeded()})}},{key:"callBumpEvents",value:function(e){for(var t=this,i=1;i<e.length;i++)"frontEntity"===e[i]&&(this.controller.events.forEach(function(n){return n({eventType:s.WhenTouched,targetType:e[i+1].type,eventSenderIdentifier:t.identifier,targetIdentifier:e[i+1].identifier})}),i++)}},{key:"moveDirection",value:function(e,t){this.controller.levelModel.turnToDirection(this,t),this.moveForward(e,!1)}},{key:"moveForward",value:function(e){(!(arguments.length>1&&void 0!==arguments[1])||arguments[1])&&this.controller.addCommandRecord("moveForward",this.type,e.repeat);var t=this.controller.levelModel.getMoveForwardPosition(this),i=this.controller.levelModel.canMoveForward(this);if(i[0]){var n=r.directionToOffsetPosition(this.facing),o=r.directionToOffsetPosition(a.opposite(this.facing)),s=this.handleMoveOnPressurePlate(n);this.doMoveForward(e,t),s||this.handleMoveOffPressurePlate(o),this.handleMoveOffIronDoor(o),this.handleMoveAwayFromPiston(o)}else this.bump(e),this.callBumpEvents(i)}},{key:"moveBackward",value:function(e){(!(arguments.length>1&&void 0!==arguments[1])||arguments[1])&&this.controller.addCommandRecord("moveBackward",this.type,e.repeat);var t=this.controller.levelModel.getMoveDirectionPosition(this,2),i=this.controller.levelModel.canMoveBackward(this);if(i[0]){var n=r.directionToOffsetPosition(a.opposite(this.facing)),o=r.directionToOffsetPosition(this.facing),s=this.handleMoveOnPressurePlate(n);this.doMoveBackward(e,t),s||this.handleMoveOffPressurePlate(o),this.handleMoveOffIronDoor(o),this.handleMoveAwayFromPiston(o)}else this.bump(e),this.callBumpEvents(i)}},{key:"canPlaceBlockOver",value:function(){return{canPlace:!1,plane:""}}},{key:"moveAway",value:function(e,t){this.controller.addCommandRecord("moveAway",this.type,e.repeat);var i=t.position,n=[],o=function(e,t,i){return r.absoluteDistanceSquare(t[1],e)<r.absoluteDistanceSquare(i[1],e)?i:t},s=r.absoluteDistanceSquare(i,this.position);i.x<=this.position.x&&this.controller.levelModel.canMoveDirection(this,a.East)[0]&&(n=[a.East,r.east(this.position)]),i.x>=this.position.x&&this.controller.levelModel.canMoveDirection(this,a.West)[0]&&(n=n.length>0?o(i,n,[a.West,r.west(this.position)]):[a.West,r.west(this.position)]),i.y>=this.position.y&&this.controller.levelModel.canMoveDirection(this,a.North)[0]&&(n=n.length>0?o(i,n,[a.North,r.north(this.position)]):[a.North,r.north(this.position)]),i.y<=this.position.y&&this.controller.levelModel.canMoveDirection(this,a.South)[0]&&(n=n.length>0?o(i,n,[a.South,r.south(this.position)]):[a.South,r.south(this.position)]),0===n.length||s>=r.absoluteDistanceSquare(i,n[1])?e.succeeded():this.moveDirection(e,n[0])}},{key:"moveToward",value:function(e,t){this.controller.addCommandRecord("moveToward",this.type,e.repeat);var i=t.position,n=[],o=function(e,t,i){return r.absoluteDistanceSquare(t[1],e)>r.absoluteDistanceSquare(i[1],e)?i:t};return i.x>=this.position.x&&this.controller.levelModel.canMoveDirection(this,a.East)[0]&&(n=[a.East,r.east(this.position)]),i.x<=this.position.x&&this.controller.levelModel.canMoveDirection(this,a.West)[0]&&(n=n.length>0?o(i,n,[a.West,r.west(this.position)]):[a.West,r.west(this.position)]),i.y<=this.position.y&&this.controller.levelModel.canMoveDirection(this,a.North)[0]&&(n=n.length>0?o(i,n,[a.North,r.north(this.position)]):[a.North,r.north(this.position)]),i.y>=this.position.y&&this.controller.levelModel.canMoveDirection(this,a.South)[0]&&(n=n.length>0?o(i,n,[a.South,r.south(this.position)]):[a.South,r.south(this.position)]),1===r.absoluteDistanceSquare(this.position,i)?(this.position.x<i.x?this.facing=a.East:this.position.x>i.x?this.facing=a.West:this.position.y<i.y?this.facing=a.South:this.position.y>i.y&&(this.facing=a.North),this.updateAnimationDirection(),this.bump(e),!1):0===n.length?(e.succeeded(),!1):(this.moveDirection(e,n[0]),!0)}},{key:"moveTo",value:function(e,t){var i=this;if(1===r.absoluteDistanceSquare(t.position,this.position))t.position.y-this.position.y==-1?this.moveDirection(e,a.North):t.position.y-this.position.y==1?this.moveDirection(e,a.South):t.position.x-this.position.x==1?this.moveDirection(e,a.East):this.moveDirection(e,a.West);else if(this.moveToward(e,t)){var n=new l(this.controller,function(){},function(){i.moveTo(n,t)},this.identifier);this.addCommand(n)}else this.bump(e)}},{key:"turn",value:function(e,t){(!(arguments.length>2&&void 0!==arguments[2])||arguments[2])&&this.controller.addCommandRecord("turn",this.type,e.repeat),-1===t&&this.controller.levelModel.turnLeft(this),1===t&&this.controller.levelModel.turnRight(this),this.updateAnimationDirection(),this.controller.delayPlayerMoveBy(200,800,function(){e.succeeded()})}},{key:"turnRandom",value:function(e){this.controller.addCommandRecord("turnRandom",this.type,e.repeat);var t=0===function(e,t){return Math.floor(Math.random()*(t-e+1))+e}(0,1)?1:-1;this.turn(e,t,!1)}},{key:"use",value:function(e,t){var i=this,n="lookAtCam"+this.controller.levelView.getDirectionName(this.facing);this.controller.levelView.playScaledSpeed(this.sprite.animations,n),this.queue.startPushHighPriorityCommands(),this.controller.events.forEach(function(e){return e({eventType:s.WhenUsed,targetType:i.type,eventSenderIdentifier:t.identifier,targetIdentifier:i.identifier})}),this.queue.endPushHighPriorityCommands(),e.succeeded()}},{key:"drop",value:function(e,t){var i=this;this.controller.addCommandRecord("drop",this.type,e.repeat),this.controller.levelView.playItemDropAnimation(this.position,t,function(){if(e.succeeded(),i.controller.levelModel.usePlayer){var t=i.controller.levelModel.player.queue.currentCommand;t&&t.waitForOtherQueue&&t.succeeded()}})}},{key:"attack",value:function(e){var t=this;this.controller.addCommandRecord("attack",this.type,e.repeat);var i=this.controller.levelView.getDirectionName(this.facing);this.controller.levelView.playScaledSpeed(this.sprite.animations,"attack"+i),setTimeout(function(i){var n=i.controller.levelEntity.getEntityAt(i.controller.levelModel.getMoveForwardPosition(i));if(n){var o=new l(i.controller,function(){},function(){n.takeDamage(o)},n);n.addCommand(o)}setTimeout(function(t,i,o){null!==i&&(n.queue.startPushHighPriorityCommands(),t.events.forEach(function(e){return e({eventType:s.WhenAttacked,targetType:i.type,eventSenderIdentifier:o.identifier,targetIdentifier:i.identifier})}),n.queue.endPushHighPriorityCommands()),e.succeeded()},300/t.controller.tweenTimeScale,i.controller,n,i)},200/this.controller.tweenTimeScale,this)}},{key:"pushBack",value:function(e,t,i,n){var o=this,a=this.controller.levelModel,s=r.forward(this.position,t);if(a.isPositionEmpty(s)[0]){this.updateHidingBlock(this.position),this.position=s,this.updateHidingTree();var l=this.controller.levelView.addResettableTween(this.sprite).to({x:this.offset[0]+40*this.position[0],y:this.offset[1]+40*this.position[1]},i,Phaser.Easing.Linear.None);l.onComplete.add(function(){setTimeout(function(){e.succeeded(),void 0!==n&&n(o)},i/o.controller.tweenTimeScale)}),l.start()}else e.succeeded(),void 0!==n&&n(this)}},{key:"takeDamage",value:function(e){var t=this,i=this.controller.levelView,n=i.getDirectionName(this.facing);this.healthPoint>1?(i.playScaledSpeed(this.sprite.animations,"hurt"+n),setTimeout(function(){t.healthPoint--,e.succeeded()},1500/this.controller.tweenTimeScale)):(this.healthPoint--,this.sprite.animations.stop(null,!0),this.controller.levelView.playScaledSpeed(this.sprite.animations,"die"+n),setTimeout(function(){var e=t.controller.levelView.addResettableTween(t.sprite).to({alpha:0},300,Phaser.Easing.Linear.None);e.onComplete.add(function(){t.controller.levelEntity.destroyEntity(t.identifier)}),e.start()},1500/this.controller.tweenTimeScale))}},{key:"playRandomIdle",value:function(e){var t,i="";switch(t=this.controller.levelView.getDirectionName(e),Math.trunc(5*Math.random())+1){case 1:i+="idle";break;case 2:i+="lookLeft";break;case 3:i+="lookRight";break;case 4:i+="lookAtCam";break;case 5:i+="lookDown"}i+=t,this.controller.levelView.playScaledSpeed(this.sprite.animations,i)}},{key:"updateAnimationDirection",value:function(){var e=this.controller.levelView.getDirectionName(this.facing);this.controller.levelView.playScaledSpeed(this.sprite.animations,"idle"+e)}},{key:"getDistance",value:function(e){return r.absoluteDistanceSquare(this.position,e.position)}},{key:"blowUp",value:function(e,t){var i=a.South;t[0]>this.position[0]?(i=a.West,this.facing=a.East,this.updateAnimationDirection()):t[0]<this.position[0]?(i=a.East,this.facing=a.West,this.updateAnimationDirection()):t[1]>this.position[1]?(i=a.North,this.facing=a.South,this.updateAnimationDirection()):t[1]<this.position[1]&&(i=a.South,this.facing=a.North,this.updateAnimationDirection()),this.pushBack(e,i,150,function(t){var i=new l(t.controller,function(){},function(){t.controller.destroyEntity(i,t.identifier)},t.identifier);t.queue.startPushHighPriorityCommands(),t.addCommand(i,e.repeat),t.queue.endPushHighPriorityCommands()})}},{key:"hasPermissionToWalk",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return(e.isWalkable||void 0!==t&&t.isOnBlock&&!e.isEmpty)&&(void 0===t||t.canMoveThrough())&&"water"!==i.blockType&&"lava"!==i.blockType}},{key:"handleMoveOffPressurePlate",value:function(e){var t=this,i=r.add(this.position,e),n="pressurePlateDown"===this.controller.levelModel.actionPlane.getBlockAt(i).blockType,o=this.controller.levelModel.actionPlane.getBlockAt(this.position),a=!1;if(void 0!==o&&o.isWalkable||(a=!0),this.controller.levelEntity.entityMap.forEach(function(e){e.identifier!==t.identifier&&e.canTriggerPressurePlates()&&t.controller.positionEquivalence(e.position,i)&&(a=!0)}),n&&!a){this.controller.audioPlayer.play("pressurePlateClick");var s=new c("pressurePlateUp");this.controller.levelModel.actionPlane.setBlockAt(i,s,e[0],e[1])}}},{key:"handleMoveOnPressurePlate",value:function(e){var t=r.add(this.position,e);if("pressurePlateUp"===this.controller.levelModel.actionPlane.getBlockAt(t).blockType){this.controller.audioPlayer.play("pressurePlateClick");var i=new c("pressurePlateDown");return this.controller.levelModel.actionPlane.setBlockAt(t,i),!0}return!1}},{key:"handleMoveOffIronDoor",value:function(e){var t=r.add(this.position,e);if(this.controller.levelModel.inBounds(t)){var i="doorIron"===this.controller.levelModel.actionPlane.getBlockAt(t).blockType,n="doorIron"===this.controller.levelModel.actionPlane.getBlockAt(this.position).blockType;i&&!n&&this.controller.levelModel.actionPlane.findDoorToAnimate(new r(-1,-1))}}},{key:"handleMoveAwayFromPiston",value:function(e){var t=this,i=r.add(this.position,e);r.getOrthogonalPositions(i).forEach(function(e){if(t.controller.levelModel.actionPlane.inBounds(e)){var i=t.controller.levelModel.actionPlane.getBlockAt(e);i.blockType.startsWith("piston")&&i.isPowered&&t.controller.levelModel.actionPlane.activatePiston(e)}})}},{key:"handleGetOnRails",value:function(e){this.getOffTrack=!1,this.handleMoveOffPressurePlate(new r(0,0)),this.controller.levelView.playTrack(this.position,e,!0,this,null)}}]),e}()},function(e,t,i){"use strict";var n=Object.freeze({North:0,East:1,South:2,West:3,opposite:function(e){switch(e){case n.North:return n.South;case n.South:return n.North;case n.East:return n.West;case n.West:return n.East}},left:function(e){return this.turn(e,"left")},right:function(e){return this.turn(e,"right")},turnDirection:function(e,t){switch(e){case n.North:return t===n.East?"right":"left";case n.South:return t===n.West?"right":"left";case n.East:return t===n.South?"right":"left";case n.West:return t===n.North?"right":"left"}},turn:function(e,t){return(e+4+("right"===t?1:-1))%4},directionToOffset:function(e){switch(e){case n.North:return[0,-1];case n.South:return[0,1];case n.East:return[1,0];case n.West:return[-1,0]}},directionToRelative:function(e){switch(e){case n.North:return"Up";case n.South:return"Down";case n.East:return"Right";case n.West:return"Left"}}});e.exports=n},function(e,t,i){"use strict";var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();var o=i(2),a=[o.North,o.East,o.South,o.West];e.exports=function(){function e(t,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.x=t,this.y=i,this[0]=t,this[1]=i}return n(e,null,[{key:"add",value:function(t,i){return new e(t[0]+i[0],t[1]+i[1])}},{key:"subtract",value:function(t,i){return new e(t[0]-i[0],t[1]-i[1])}},{key:"equals",value:function(e,t){return e[0]===t[0]&&e[1]===t[1]}},{key:"directionToOffsetPosition",value:function(t){var i=o.directionToOffset(t);if(i)return e.fromArray(i)}},{key:"isAdjacent",value:function(t,i){return a.map(e.directionToOffsetPosition).some(function(n){return e.equals(e.add(t,n),i)})}},{key:"forward",value:function(t,i){return e.add(t,e.directionToOffsetPosition(i))}},{key:"north",value:function(t){return e.forward(t,o.North)}},{key:"east",value:function(t){return e.forward(t,o.East)}},{key:"south",value:function(t){return e.forward(t,o.South)}},{key:"west",value:function(t){return e.forward(t,o.West)}},{key:"getOrthogonalPositions",value:function(t){return a.map(function(i){return e.forward(t,i)})}},{key:"manhattanDistance",value:function(e,t){return Math.abs(t.x-e.x)+Math.abs(t.y-e.y)}},{key:"absoluteDistanceSquare",value:function(e,t){return Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2)}},{key:"getSurroundingPositions",value:function(t){return e.getOrthogonalPositions(t).concat([e.north(e.east(t)),e.north(e.west(t)),e.south(e.east(t)),e.south(e.west(t))])}},{key:"fromArray",value:function(t){return new e(t[0],t[1])}}]),e}()},function(e,t,i){"use strict";var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();var o=i(0);e.exports=function(e){function t(e,i,n,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var a=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i,o));return a.actionCallback=n,a}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o),n(t,[{key:"tick",value:function(){}},{key:"begin",value:function(){(function e(t,i,n){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,i);if(void 0===o){var a=Object.getPrototypeOf(t);return null===a?void 0:e(a,i,n)}if("value"in o)return o.value;var r=o.get;return void 0!==r?r.call(n):void 0})(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"begin",this).call(this),this.actionCallback()}}]),t}()},function(e,t,i){"use strict";var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();var o=i(6);e.exports=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.gameController=t,this.game=t.game,this.reset(),this.repeatCommands=[],this.setUnshiftState=!1,this.highPriorityCommands=[]}return n(e,[{key:"addCommand",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e.repeat=t,this.whileCommandQueue?this.whileCommandQueue.addCommand(e):this.setUnshiftState?this.highPriorityCommands.push(e):this.commandList_.push(e)}},{key:"setWhileCommandInsertState",value:function(e){this.whileCommandQueue=e}},{key:"begin",value:function(){this.state=o.WORKING}},{key:"reset",value:function(){this.state=o.NOT_STARTED,this.currentCommand=null,this.commandList_=[],this.highPriorityCommands=[],this.whileCommandQueue&&this.whileCommandQueue.reset(),this.repeatCommands=[],this.whileCommandQueue=null}},{key:"startPushHighPriorityCommands",value:function(){this.setUnshiftState=!0,this.highPriorityCommands=[]}},{key:"endPushHighPriorityCommands",value:function(){for(var e=this.highPriorityCommands.length-1;e>=0;e--)this.commandList_.unshift(this.highPriorityCommands[e]);this.setUnshiftState=!1}},{key:"tick",value:function(){if(this.state===o.WORKING){if(!this.currentCommand){if(0===this.commandList_.length){0===this.repeatCommands.length&&(this.state=o.SUCCESS),this.gameController.startPushRepeatCommand();for(var e=0;e<this.repeatCommands.length;e++)this.repeatCommands[e][1]>0?(this.repeatCommands[e][0](),this.repeatCommands[e][1]--):-1===this.repeatCommands[e][1]?this.repeatCommands[e][0]():this.repeatCommands.splice(e,1);return void this.gameController.endPushRepeatCommand()}this.currentCommand=this.commandList_.shift()}this.currentCommand.isStarted()?this.currentCommand.tick():this.currentCommand.begin(),this.currentCommand.isSucceeded()?this.currentCommand=null:this.currentCommand.isFailed()&&(this.state=o.FAILURE)}}},{key:"getLength",value:function(){return this.commandList_?this.commandList_.length:0}},{key:"isStarted",value:function(){return this.state!==o.NOT_STARTED}},{key:"isFinished",value:function(){return this.isSucceeded()||this.isFailed()}},{key:"isSucceeded",value:function(){return this.state===o.SUCCESS}},{key:"isFailed",value:function(){return this.state===o.FAILURE}},{key:"addRepeatCommands",value:function(e,t){if(-1===t)for(var i=0;i<this.repeatCommands.length;i++)if(-1===this.repeatCommands[i][1]){this.repeatCommands.splice(i,1);break}this.repeatCommands.push([e,t]),this.begin()}}]),e}()},function(e,t,i){"use strict";e.exports=Object.freeze({NOT_STARTED:0,WORKING:1,SUCCESS:2,FAILURE:3})},function(e,t,i){"use strict";e.exports=Object.freeze({WhenTouched:0,WhenUsed:1,WhenSpawned:2,WhenAttacked:3,WhenNight:4,WhenDay:5,WhenNightGlobal:6,WhenDayGlobal:7,WhenRun:8})},function(e,t,i){"use strict";var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();var o=i(2),a=o.North,r=o.South,s=o.East,l=o.West;e.exports=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.blockType=t,this.isEntity=!1,this.isWalkable=!1,this.isPlacable=!1,this.isDestroyable=!0,this.isUsable=!0,this.isEmpty=!1,this.isEmissive=!1,this.isTransparent=!1,this.isRedstone=!1,this.isPowered=!1,this.isConnectedToRedstone=!1,this.isRedstoneBattery=!1,this.isOpen=!1,this.isRail=!1,this.isSolid=!0,this.isWeaklyPowerable=!0,this.isStickable=!0,""===t&&(this.isWalkable=!0,this.isDestroyable=!1,this.isEmpty=!0,this.isPlacable=!0,this.isUsable=!1,this.isWeaklyPowerable=!1),this.getIsMiniblock()&&(this.isEntity=!0,this.isWalkable=!0,this.isDestroyable=!1,this.isPlacable=!0,this.isUsable=!1,this.isTransparent=!0),t.match("torch")&&(this.isWalkable=!0,this.isPlacable=!0,this.isStickable=!1),"rails"===t.substring(0,5)&&(this.isWeaklyPowerable="railsRedstoneTorch"===t,this.isStickable="railsRedstoneTorch"!==t,this.isEntity=!0,this.isWalkable=!0,this.isUsable=!0,this.isDestroyable=!0,this.isTransparent=!0,this.isRail="railsRedstoneTorch"!==t,this.isConnectedToRedstone=/^rails(RedstoneTorch|Unpowered|Powered)/.test(t),this.isRedstoneBattery="railsRedstoneTorch"===t,this.connectionA=void 0,this.connectionB=void 0),"sheep"===t&&(this.isEntity=!0,this.isDestroyable=!1,this.isUsable=!0),"invisible"===t&&(this.isDestroyable=!1,this.isUsable=!1,this.isWeaklyPowerable=!1,this.isEmissive=!0),t.startsWith("glass")&&(this.isSolid=!1),t.startsWith("ice")&&(this.isSolid=!1),"creeper"===t&&(this.isEntity=!0),"bedrock"===t&&(this.isDestroyable=!1),"lava"===t&&(this.isEmissive=!0,this.isWalkable=!0,this.isPlacable=!0),"water"===t&&(this.isPlacable=!0),"torch"===t&&(this.isEmissive=!0,this.isEntity=!0,this.isWalkable=!0,this.isUsable=!0,this.isDestroyable=!1,this.isTransparent=!0),"cropWheat"===t&&(this.isEmissive=!1,this.isEntity=!0,this.isWalkable=!0,this.isUsable=!0,this.isDestroyable=!1,this.isTransparent=!0),"tnt"===t&&(this.isUsable=!0,this.isDestroyable=!0),"door"===t&&(this.isWeaklyPowerable=!1,this.isSolid=!1,this.isEntity=!0,this.isWalkable=!1,this.isUsable=!0,this.isDestroyable=!1,this.isTransparent=!0,this.isStickable=!1),"doorIron"===t&&(this.isWeaklyPowerable=!1,this.isSolid=!1,this.isEntity=!0,this.isWalkable=!1,this.isDestroyable=!1,this.isTransparent=!0,this.isConnectedToRedstone=!0,this.isStickable=!1),t.startsWith("redstoneWire")&&(this.isEntity=!0,this.isWalkable=!0,this.isUsable=!0,this.isDestroyable=!0,this.isTransparent=!0,this.isRedstone=!0,this.isStickable=!1),t.startsWith("pressurePlate")&&(this.isWeaklyPowerable="pressurePlateUp"!==t,this.isEntity=!0,this.isWalkable=!0,this.isDestroyable=!1,this.isTransparent=!0,this.isConnectedToRedstone=!0,this.isRedstoneBattery="pressurePlateUp"!==t,this.isStickable=!1),"glowstone"===t&&(this.isEntity=!0),"bedFoot"!==t&&"bedHead"!==t||(this.isEntity=!0),t.startsWith("piston")&&(this.isWeaklyPowerable=!1,this.isSolid=!1,this.isDestroyable=!1,this.isConnectedToRedstone=!t.startsWith("pistonArm"),("On"===t.substring(t.length-2,t.length)||t.startsWith("pistonArm")||"OnSticky"===t.substring(t.length-8,t.length))&&(this.isEntity=!0)),t.startsWith("flower")&&(this.isWalkable=!0)}return n(e,[{key:"isFlat",value:function(){return this.isRail||this.isRedstone||this.blockType.startsWith("pressurePlate")}},{key:"notValidOnGroundPlane",value:function(){return this.blockType.startsWith("rails")||this.blockType.startsWith("redstone")}},{key:"skipsDestructionOverlay",value:function(){return this.isRedstone||"torch"===this.blockType||"railsRedstoneTorch"===this.blockType}},{key:"shouldRenderOnGroundPlane",value:function(){return this.isFlat()}},{key:"getIsPowerableRail",value:function(){return this.isRail&&this.isConnectedToRedstone}},{key:"getIsHorizontal",value:function(){return this.blockType.match("East|West")}},{key:"getIsVertical",value:function(){return this.blockType.match("North|South")}},{key:"getIsStickyPiston",value:function(){return"Sticky"===this.blockType.substring(this.blockType.length-6,this.blockType.length)}},{key:"canHoldCharge",value:function(){return this.isSolid}},{key:"getIsMiniblock",value:function(){return e.isMiniblock(this.blockType)}},{key:"getIsTree",value:function(){return!!this.blockType.match(/^tree/)}},{key:"getIsDoor",value:function(){return this.blockType.startsWith("door")}},{key:"getIsLiquid",value:function(){return"water"===this.blockType||"lava"===this.blockType}},{key:"getCanFall",value:function(){return"sand"===this.blockType||"gravel"===this.blockType}},{key:"getIsPlaceableInLiquid",value:function(){return!(this.isRedstone||this.getIsPiston()||this.isRail||"torch"===this.blockType||"railsRedstoneTorch"===this.blockType||"pressurePlateUp"===this.blockType)}},{key:"getIsPiston",value:function(){return this.blockType.startsWith("piston")}},{key:"getIsPistonArm",value:function(){return this.blockType.startsWith("pistonArm")}},{key:"getIsPushable",value:function(){return""!==this.blockType&&!this.isDestroyableUponPush()}},{key:"isDestroyableUponPush",value:function(){return this.blockType.startsWith("redstone")||this.blockType.startsWith("door")||this.blockType.startsWith("railsRedstone")||this.blockType.startsWith("pressure")}},{key:"needToRefreshRedstone",value:function(){return!!(this.isRedstone||""===this.blockType||this.isConnectedToRedstone&&!this.blockType.startsWith("piston"))}},{key:"getPistonDirection",value:function(){if(this.blockType.startsWith("piston"))switch(this.blockType.substring(6,7)){case"D":return r;case"U":return a;case"L":return l;case"R":return s}}},{key:"getIsEmptyOrEntity",value:function(){return this.isEmpty||this.isEntity}}],[{key:"getCanFall",value:function(t){return new e(t).getCanFall()}},{key:"getIsPlaceableInLiquid",value:function(t){return new e(t).getIsPlaceableInLiquid()}},{key:"isWalkable",value:function(t){return new e(t).isWalkable}},{key:"isMiniblock",value:function(e){return e.endsWith("Miniblock")}},{key:"isFlat",value:function(t){return new e(t).isFlat()}},{key:"skipsDestructionOverlay",value:function(t){return new e(t).skipsDestructionOverlay()}},{key:"notValidOnGroundPlane",value:function(t){return new e(t).notValidOnGroundPlane()}},{key:"getMiniblockFrame",value:function(t){if("railsRedstoneTorch"===t)return"redstoneTorch";if(t.startsWith("rails"))return"railNormal";if(!t.startsWith("glass")&&!t.startsWith("ice")){if("redstoneWire"===t.substring(0,12))return"redstoneDust";if(e.isMiniblock(t))return t.replace("Miniblock","");var i=t;switch(i){case"treeAcacia":case"treeBirch":case"treeJungle":case"treeOak":case"treeSpruce":case"treeSpruceSnowy":i="log"+i.substring(4);break;case"stone":i="cobblestone";break;case"oreCoal":i="coal";break;case"oreDiamond":i="diamond";break;case"oreIron":i="ingotIron";break;case"oreLapis":i="lapisLazuli";break;case"oreGold":i="ingotGold";break;case"oreEmerald":i="emerald";break;case"oreRedstone":i="redstoneDust";break;case"grass":i="dirt";break;case"wool_orange":i="wool";break;case"tnt":i="gunPowder"}return i}}}]),e}()},function(e,t,i){"use strict";var n=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var i=[],n=!0,o=!1,a=void 0;try{for(var r,s=e[Symbol.iterator]();!(n=(r=s.next()).done)&&(i.push(r.value),!t||i.length!==t);n=!0);}catch(e){o=!0,a=e}finally{try{!n&&s.return&&s.return()}finally{if(o)throw a}}return i}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),o=i(2);e.exports.convertActionPlaneEntitiesToConfig=function(e){var t=e.gridWidth&&e.gridHeight?[e.gridWidth,e.gridHeight]:[10,10],i=n(t,2),a=i[0],r=i[1];[e.actionPlane].forEach(function(t){for(var i=0;i<t.length;i++){var n=t[i];if(n.match(/sheep|zombie|ironGolem|creeper|cow|chicken|ghast/)){var s={Up:o.North,Down:o.South,Left:o.West,Right:o.East};e.entities=e.entities||[];var l=i%a,c=Math.floor(i/r),h=n.match(/(.*)(Right|Left|Up|Down)/),u=h?s[h[2]]:o.East,d=h?h[1]:n;e.entities.push([d,l,c,u]),t[i]=""}}})},e.exports.randomInt=function(e,t){return Math.floor(Math.random()*(t-e))+e}},function(e,t,i){"use strict";var n=i(11),o=i(2),a=i(7),r=i(9);e.exports={GameController:n,FacingDirection:o,EventType:a,utils:r}},function(e,t,i){"use strict";var n=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var i=[],n=!0,o=!1,a=void 0;try{for(var r,s=e[Symbol.iterator]();!(n=(r=s.next()).done)&&(i.push(r.value),!t||i.length!==t);n=!0);}catch(e){o=!0,a=e}finally{try{!n&&s.return&&s.return()}finally{if(o)throw a}}return i}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),o=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();function a(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var r=i(5),s=i(4),l=i(7),c=i(2),h=i(3),u=i(12),d=i(17),p=i(19),f=i(27),y=i(28),m=400,v=400,g=function(){function e(t){var i=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.DEBUG=t.debug,window.PhaserGlobal={disableAudio:!0,disableWebAudio:!0,hideBanner:!this.DEBUG},this.codeOrgAPI=y.get(this);var n=t.Phaser;this.game=new n.Game({forceSetTimeOut:t.forceSetTimeOut,width:m,height:v,renderer:n.CANVAS,parent:t.containerId,state:"earlyLoad",preserveDrawingBuffer:!0}),this.specialLevelType=null,this.queue=new r(this),this.OnCompleteCallback=null,this.assetRoot=t.assetRoot,this.audioPlayer=t.audioPlayer,this.afterAssetsLoaded=t.afterAssetsLoaded,this.assetLoader=new f(this),this.earlyLoadAssetPacks=t.earlyLoadAssetPacks||[],this.earlyLoadNiceToHaveAssetPacks=t.earlyLoadNiceToHaveAssetPacks||[],this.resettableTimers=[],this.timeouts=[],this.timeout=0,this.initializeCommandRecord(),this.score=0,this.useScore=!1,this.scoreText=null,this.onScoreUpdate=t.onScoreUpdate,this.events=[],this.assumedSlowMotion=1.5,this.initialSlowMotion=t.customSlowMotion||this.assumedSlowMotion,this.tweenTimeScale=1.5/this.initialSlowMotion,this.playerDelayFactor=1,this.dayNightCycle=!1,this.player=null,this.agent=null,this.timerSprite=null,this.game.state.add("earlyLoad",{preload:function(){i.game.load.resetLocked=!0,i.assetLoader.loadPacks(i.earlyLoadAssetPacks)},create:function(){i.assetLoader.loadPacks(i.earlyLoadNiceToHaveAssetPacks),i.game.load.start()}}),this.game.state.add("levelRunner",{preload:this.preload.bind(this),create:this.create.bind(this),update:this.update.bind(this),render:this.render.bind(this)})}return o(e,[{key:"getIsDirectPlayerControl",value:function(){return this.levelData.isEventLevel||this.levelData.isAgentLevel}},{key:"loadLevel",value:function(e){this.levelData=Object.freeze(e),this.levelEntity=new p(this),this.levelModel=new u(this.levelData,this),this.levelView=new d(this),this.specialLevelType=e.specialLevelType,this.timeout=e.levelVerificationTimeout,void 0!==e.useScore&&(this.useScore=e.useScore),this.timeoutResult=e.timeoutResult,this.onDayCallback=e.onDayCallback,this.onNightCallback=e.onNightCallback,this.game.state.start("levelRunner")}},{key:"reset",value:function(){var e=this;this.dayNightCycle=!1,this.queue.reset(),this.levelEntity.reset(),this.levelModel.reset(),this.levelView.reset(this.levelModel),this.levelEntity.loadData(this.levelData),this.player=this.levelModel.player,this.agent=this.levelModel.agent,this.resettableTimers.forEach(function(e){e.stop(!0)}),this.timeouts.forEach(function(e){clearTimeout(e)}),this.timerSprite&&this.timerSprite.kill(),this.timerSprite=null,this.timeouts=[],this.resettableTimers.length=0,this.events.length=0,this.score=0,this.useScore&&this.updateScore(),this.getIsDirectPlayerControl()||this.events.push(function(t){t.eventType===l.WhenUsed&&"sheep"===t.targetType&&e.codeOrgAPI.drop(null,"wool",t.targetIdentifier),t.eventType===l.WhenTouched&&"creeper"===t.targetType&&(e.codeOrgAPI.flashEntity(null,t.targetIdentifier),e.codeOrgAPI.explodeEntity(null,t.targetIdentifier))}),this.initializeCommandRecord()}},{key:"preload",value:function(){this.game.load.resetLocked=!0,this.game.time.advancedTiming=this.DEBUG,this.game.stage.disableVisibilityChange=!0,this.assetLoader.loadPacks(this.levelData.assetPacks.beforeLoad)}},{key:"create",value:function(){var e=this;this.levelView.create(this.levelModel),this.game.time.slowMotion=this.initialSlowMotion,this.addCheatKeys(),this.assetLoader.loadPacks(this.levelData.assetPacks.afterLoad),this.game.load.image("timer",this.assetRoot+"images/placeholderTimer.png"),this.game.load.onLoadComplete.addOnce(function(){e.afterAssetsLoaded&&e.afterAssetsLoaded()}),this.levelEntity.loadData(this.levelData),this.game.load.start()}},{key:"run",value:function(){var e=this;this.events.forEach(function(e){return e({eventType:l.WhenRun,targetIdentifier:void 0})});var t=!0,i=!1,n=void 0;try{for(var o,a=this.levelEntity.entityMap[Symbol.iterator]();!(t=(o=a.next()).done);t=!0){var r=o.value[1];this.events.forEach(function(e){return e({eventType:l.WhenSpawned,targetType:r.type,targetIdentifier:r.identifier})}),r.queue.begin()}}catch(e){i=!0,n=e}finally{try{!t&&a.return&&a.return()}finally{if(i)throw n}}if(!isNaN(this.timeout)&&this.timeout>0){this.timerSprite=this.game.add.sprite(-50,390,"timer");var s=this.levelView.addResettableTween(this.timerSprite).to({x:-450,alpha:.5},this.timeout,Phaser.Easing.Linear.None);s.onComplete.add(function(){e.endLevel(e.timeoutResult(e.levelModel))}),s.start()}}},{key:"followingPlayer",value:function(){return!!this.levelData.gridDimensions&&!this.checkMinecartLevelEndAnimation()}},{key:"update",value:function(){this.queue.tick(),this.levelEntity.tick(),this.levelModel.usePlayer&&this.player.updateMovement(),this.levelModel.usingAgent&&this.agent.updateMovement(),this.levelView.update(),(this.getIsDirectPlayerControl()||this.player.queue.state>1)&&this.checkSolution()}},{key:"addCheatKeys",value:function(){var e,t=this;if(this.levelModel.usePlayer){var i=(a(e={},Phaser.Keyboard.UP,c.North),a(e,Phaser.Keyboard.W,c.North),a(e,Phaser.Keyboard.RIGHT,c.East),a(e,Phaser.Keyboard.D,c.East),a(e,Phaser.Keyboard.DOWN,c.South),a(e,Phaser.Keyboard.S,c.South),a(e,Phaser.Keyboard.LEFT,c.West),a(e,Phaser.Keyboard.A,c.West),a(e,Phaser.Keyboard.SPACEBAR,-2),e);Object.keys(i).forEach(function(e){var n=i[e];t.game.input.keyboard.addKey(e).onDown.add(function(){t.player.movementState=n,t.player.updateMovement()}),t.game.input.keyboard.addKey(e).onUp.add(function(){t.player.movementState===n&&(t.player.movementState=-1),t.player.updateMovement()})})}}},{key:"handleEndState",value:function(e){this.OnCompleteCallback&&(this.OnCompleteCallback(e,this.levelModel),this.OnCompleteCallback=null)}},{key:"render",value:function(){this.DEBUG&&this.game.debug.text(this.game.time.fps||"--",2,14,"#00ff00"),this.levelView.render()}},{key:"scaleFromOriginal",value:function(){var e=this.levelData.gridDimensions||[10,10],t=n(e,2);return[t[0]/10,t[1]/10]}},{key:"getScreenshot",value:function(){return this.game.canvas.toDataURL("image/png")}},{key:"initializeCommandRecord",value:function(){var e=["moveAway","moveToward","moveForward","turn","turnRandom","explode","wait","flash","drop","spawn","destroy","playSound","attack","addScore"];this.commandRecord=new Map,this.repeatCommandRecord=new Map,this.isRepeat=!1;for(var t=0;t<e.length;t++)this.commandRecord.set(e[t],new Map),this.commandRecord.get(e[t]).set("count",0),this.repeatCommandRecord.set(e[t],new Map),this.repeatCommandRecord.get(e[t]).set("count",0)}},{key:"startPushRepeatCommand",value:function(){this.isRepeat=!0}},{key:"endPushRepeatCommand",value:function(){this.isRepeat=!1}},{key:"addCommandRecord",value:function(e,t,i){var n=i?this.repeatCommandRecord:this.commandRecord;if(n.has(e)){var o=n.get(e);if(o.set("count",o.get("count")+1),o.has(t)?o.set(t,o.get(t)+1):o.set(t,1),this.DEBUG){var a=i?"Repeat ":"Command :";console.log(a+e+" executed in mob type : "+t+" updated count : "+o.get(t))}}}},{key:"getCommandCount",value:function(e,t,i){var n=i?this.repeatCommandRecord:this.commandRecord;if(n.has(e)){var o=n.get(e);return void 0===t?o.get("count"):o.has(t)?o.get(t):0}return 0}},{key:"getEntity",value:function(e){void 0===e&&(e="Player");var t=this.levelEntity.entityMap.get(e);return void 0===t&&console.log("Debug GetEntity: there is no entity : "+e+"\n"),t}},{key:"getEntities",value:function(e){return this.levelEntity.getEntitiesOfType(e)}},{key:"isType",value:function(e){return"string"==typeof e&&"Player"!==e&&"PlayerAgent"!==e}},{key:"printErrorMsg",value:function(e){this.DEBUG&&this.game.debug.text(e)}},{key:"moveAway",value:function(e,t){var i=this,n=e.target;if(void 0===n){var o=this.levelEntity.entityMap,a=function(){var n=d[1],o=new s(i,function(){},function(){i.moveAway(o,t)},n.identifier);n.addCommand(o,e.repeat)},r=!0,l=!1,c=void 0;try{for(var h,u=o[Symbol.iterator]();!(r=(h=u.next()).done);r=!0){var d=h.value;a()}}catch(e){l=!0,c=e}finally{try{!r&&u.return&&u.return()}finally{if(l)throw c}}e.succeeded()}else{var p=this.isType(n),f=this.isType(t);if(n===t)return this.printErrorMsg("Debug MoveAway: Can't move away entity from itself\n"),void e.succeeded();if(p||f)if(p&&!f){var y=this.getEntities(n),m=this.getEntity(t);if(void 0!==m)for(var v=function(){if(y[g].identifier===m.identifier)return"continue";var n=new s(i,function(){},function(){i.moveAway(n,t)},y[g].identifier);y[g].addCommand(n,e.repeat)},g=0;g<y.length;g++)v();e.succeeded()}else if(!p&&f){var k=this.getEntity(n),b=this.getEntities(t);if(b.length>0){for(var w=[Number.MAX_VALUE,-1],P=0;P<b.length;P++)if(k.identifier!==b[P].identifier){var S=k.getDistance(b[P]);S<w[0]&&(w=[S,P])}-1!==w[1]&&k.moveAway(e,b[w[1]])}else e.succeeded()}else!function(){var o=i.getEntities(n),a=i.getEntities(t);if(a.length>0&&o.length>0){for(var r=function(t){for(var n=o[t],r=[Number.MAX_VALUE,-1],l=0;l<a.length;l++)if(a[t].identifier!==n.identifier){var c=n.getDistance(a[l]);c<r[0]&&(r=[c,l])}if(-1!==r){var h=new s(i,function(){},function(){i.moveAway(h,a[r[1]].identifier)},n.identifier);n.addCommand(h,e.repeat)}else e.succeeded()},l=0;l<o.length;l++)r(l);e.succeeded()}}();else{var _=this.getEntity(n),A=this.getEntity(t);if(_===A)return void e.succeeded();_.moveAway(e,A)}}}},{key:"moveToward",value:function(e,t){var i=this,n=e.target;if(void 0===n){var o=this.levelEntity.entityMap,a=function(){var n=d[1],o=new s(i,function(){},function(){i.moveToward(o,t)},n.identifier);n.addCommand(o,e.repeat)},r=!0,l=!1,c=void 0;try{for(var h,u=o[Symbol.iterator]();!(r=(h=u.next()).done);r=!0){var d=h.value;a()}}catch(e){l=!0,c=e}finally{try{!r&&u.return&&u.return()}finally{if(l)throw c}}e.succeeded()}else{var p=this.isType(n),f=this.isType(t);if(n===t)return void e.succeeded();if(p||f)if(p&&!f){var y=this.getEntities(n),m=this.getEntity(t);if(void 0!==m){for(var v=function(n){if(y[n].identifier===m.identifier)return"continue";var o=new s(i,function(){},function(){i.moveToward(o,t)},y[n].identifier);y[n].addCommand(o,e.repeat)},g=0;g<y.length;g++)v(g);e.succeeded()}}else if(!p&&f){var k=this.getEntity(n),b=this.getEntities(t);if(b.length>0){var w=[Number.MAX_VALUE,-1];for(g=0;g<b.length;g++)if(b[g].identifier!==k.identifier){var P=k.getDistance(b[g]);P<w[0]&&(w=[P,g])}-1!==w[1]?k.moveToward(e,b[w[1]]):e.succeeded()}else e.succeeded()}else!function(){var o=i.getEntities(n),a=i.getEntities(t);if(a.length>0&&o.length>0){for(var r=function(t){for(var n=o[t],r=[Number.MAX_VALUE,-1],l=0;l<a.length;l++)if(a[t].identifier!==n.identifier){var c=n.getDistance(a[l]);c<r[0]&&(r=[c,l])}if(-1!==r[1]){var h=new s(i,function(){},function(){i.moveToward(h,a[r[1]].identifier)},n.identifier);n.addCommand(h,e.repeat)}},l=0;l<o.length;l++)r(l);e.succeeded()}}();else{var S=this.getEntity(n),_=this.getEntity(t);S.moveToward(e,_)}}}},{key:"positionEquivalence",value:function(e,t){return e[0]===t[0]&&e[1]===t[1]}},{key:"execute",value:function(e,t){for(var i=arguments.length,n=Array(i>2?i-2:0),o=2;o<i;o++)n[o-2]=arguments[o];var a=this,r=e.target;if(this.isType(r)){for(var l=this.getEntities(r),c=function(i){var o=new s(a,function(){},function(){a.execute.apply(a,[o,t].concat(n))},l[i].identifier);l[i].addCommand(o,e.repeat)},h=0;h<l.length;h++)c(h);e.succeeded()}else if(void 0===r){var u=this.levelEntity.entityMap,d=function(i){var o=i[1],r=new s(a,function(){},function(){a.execute.apply(a,[r,t].concat(n))},o.identifier);o.addCommand(r,e.repeat)},p=!0,f=!1,y=void 0;try{for(var m,v=u[Symbol.iterator]();!(p=(m=v.next()).done);p=!0){d(m.value)}}catch(e){f=!0,y=e}finally{try{!p&&v.return&&v.return()}finally{if(f)throw y}}e.succeeded()}else{var g=this.getEntity(r);g[t].apply(g,[e].concat(n))}}},{key:"moveForward",value:function(e){this.execute(e,"moveForward")}},{key:"moveBackward",value:function(e){this.execute(e,"moveBackward")}},{key:"moveDirection",value:function(e,t){var i=this.levelModel.player;this.levelModel.shouldRide(t)?(i.handleGetOnRails(t),e.succeeded()):this.execute(e,"moveDirection",t)}},{key:"turn",value:function(e,t){this.execute(e,"turn",t)}},{key:"turnRandom",value:function(e){this.execute(e,"turnRandom")}},{key:"flashEntity",value:function(e){var t=this,i=e.target;if(this.isType(i)){for(var n=this.getEntities(i),o=function(i){var o=new s(t,function(){},function(){t.flashEntity(o)},n[i].identifier);n[i].addCommand(o,e.repeat)},a=0;a<n.length;a++)o(a);e.succeeded()}else if(void 0===i){var r=this.levelEntity.entityMap,l=function(i){var n=i[1],o=new s(t,function(){},function(){t.flashEntity(o)},n.identifier);n.addCommand(o,e.repeat)},c=!0,h=!1,u=void 0;try{for(var d,p=r[Symbol.iterator]();!(c=(d=p.next()).done);c=!0){l(d.value)}}catch(e){h=!0,u=e}finally{try{!c&&p.return&&p.return()}finally{if(h)throw u}}e.succeeded()}else{var f=this.getEntity(i),y=this.levelView.flashSpriteToWhite(f.sprite);this.addCommandRecord("flash",f.type,e.repeat),this.delayBy(y,function(){e.succeeded()})}}},{key:"explodeEntity",value:function(e){var t=this,i=e.target;if(this.isType(i)){for(var n=this.getEntities(i),o=function(i){var o=new s(t,function(){},function(){t.explodeEntity(o)},n[i].identifier);n[i].addCommand(o,e.repeat)},a=0;a<n.length;a++)o(a);e.succeeded()}else{if(void 0===i){var r=this.levelEntity.entityMap,l=function(i){var n=i[1],o=new s(t,function(){},function(){t.explodeEntity(o)},n.identifier);n.addCommand(o,e.repeat)},c=!0,h=!1,u=void 0;try{for(var d,p=r[Symbol.iterator]();!(c=(d=p.next()).done);c=!0){l(d.value)}}catch(e){h=!0,u=e}finally{try{!c&&p.return&&p.return()}finally{if(h)throw u}}e.succeeded()}else{var f=this.getEntity(i);this.levelView.playExplosionCloudAnimation(f.position),this.addCommandRecord("explode",f.type,e.repeat),this.levelView.audioPlayer.play("explode");var y=this.levelEntity.entityMap,m=!0,v=!1,g=void 0;try{for(var k,b=y[Symbol.iterator]();!(m=(k=b.next()).done);m=!0)for(var w=k.value[1],P=-1;P<=1;P++)for(var S=-1;S<=1;S++)if(0!==P||0!==S){var _=[f.position[0]+P,f.position[1]+S];this.destroyBlockWithoutPlayerInteraction(_),w.position[0]===f.position[0]+P&&w.position[1]===f.position[1]+S&&w.blowUp(e,f.position)}}catch(e){v=!0,g=e}finally{try{!m&&b.return&&b.return()}finally{if(v)throw g}}var A=new s(this,function(){},function(){t.destroyEntity(A,f.identifier)},f.identifier);f.queue.startPushHighPriorityCommands(),f.addCommand(A,e.repeat),f.queue.endPushHighPriorityCommands()}e.succeeded(),this.updateFowPlane(),this.updateShadingPlane()}}},{key:"wait",value:function(e,t){var i=this,n=e.target;if(this.isType(n)){for(var o=this.getEntities(n),a=function(n){var a=new s(i,function(){},function(){i.wait(a,t)},o[n].identifier);o[n].addCommand(a,e.repeat)},r=0;r<o.length;r++)a(r);e.succeeded()}else{var l=this.getEntity(n);this.addCommandRecord("wait",l.type,e.repeat),setTimeout(function(){e.succeeded()},1e3*t/this.tweenTimeScale)}}},{key:"spawnEntity",value:function(e,t,i){this.addCommandRecord("spawn",t,e.repeat);var n=this.levelEntity.spawnEntity(t,i);null!==n&&this.events.forEach(function(e){return e({eventType:l.WhenSpawned,targetType:t,targetIdentifier:n.identifier})}),e.succeeded()}},{key:"spawnEntityAt",value:function(e,t,i,n,o){var a=this.levelEntity.spawnEntityAt(t,i,n,o);null!==a&&this.events.forEach(function(e){return e({eventType:l.WhenSpawned,targetType:t,targetIdentifier:a.identifier})}),e.succeeded()}},{key:"destroyEntity",value:function(e,t){var i=this;if(this.isType(t)){for(var n=this.getEntities(t),o=function(t){var o=n[t],a=new s(i,function(){},function(){i.destroyEntity(a,o.identifier)},o.identifier);o.addCommand(a,e.repeat)},a=0;a<n.length;a++)o(a);e.succeeded()}else if(void 0===t){var r=this.levelEntity.entityMap,l=function(t){var n=t[1],o=new s(i,function(){},function(){i.destroyEntity(o,n.identifier)},n.identifier);n.addCommand(o,e.repeat)},c=!0,h=!1,u=void 0;try{for(var d,p=r[Symbol.iterator]();!(c=(d=p.next()).done);c=!0){l(d.value)}}catch(e){h=!0,u=e}finally{try{!c&&p.return&&p.return()}finally{if(h)throw u}}e.succeeded()}else{this.addCommandRecord("destroy",this.type,e.repeat);var f=this.getEntity(t);void 0!==f?(f.healthPoint=1,f.takeDamage(e)):e.succeeded()}}},{key:"drop",value:function(e,t){var i=this,n=e.target;if(this.isType(n)){for(var o=this.getEntities(n),a=function(n){var a=new s(i,function(){},function(){i.drop(a,t)},o[n].identifier);o[n].addCommand(a,e.repeat)},r=0;r<o.length;r++)a(r);e.succeeded()}else if(void 0===n){var l=this.levelEntity.entityMap,c=function(n){var o=n[1],a=new s(i,function(){},function(){i.drop(a,t)},o.identifier);o.addCommand(a,e.repeat)},h=!0,u=!1,d=void 0;try{for(var p,f=l[Symbol.iterator]();!(h=(p=f.next()).done);h=!0){c(p.value)}}catch(e){u=!0,d=e}finally{try{!h&&f.return&&f.return()}finally{if(u)throw d}}e.succeeded()}else{this.getEntity(n).drop(e,t)}}},{key:"attack",value:function(e){var t=this,i=e.target;if(this.isType(i)){for(var n=this.getEntities(i),o=function(i){var o=new s(t,function(){},function(){t.attack(o)},n[i].identifier);n[i].addCommand(o,e.repeat)},a=0;a<n.length;a++)o(a);e.succeeded()}else if(void 0===i){var r=this.levelEntity.entityMap,l=function(i){var n=i[1],o=new s(t,function(){},function(){t.attack(o)},n.identifier);n.addCommand(o,e.repeat)},c=!0,h=!1,u=void 0;try{for(var d,p=r[Symbol.iterator]();!(c=(d=p.next()).done);c=!0){l(d.value)}}catch(e){h=!0,u=e}finally{try{!c&&p.return&&p.return()}finally{if(h)throw u}}e.succeeded()}else{var f=this.getEntity(i);"Player"===f.identifier?(this.codeOrgAPI.destroyBlock(function(){},f.identifier),e.succeeded()):f.attack(e)}}},{key:"playSound",value:function(e,t){this.addCommandRecord("playSound",void 0,e.repeat),this.levelView.audioPlayer.play(t),e.succeeded()}},{key:"use",value:function(e){var t=this,i=this.levelModel.player,n=this.levelModel.getMoveForwardPosition(i),o=this.levelEntity.getEntityAt(n),a=this.levelModel.actionPlane.getBlockAt(n),r=void 0!==a&&"door"===a.blockType;null!==o&&o!==this.agent?(this.levelView.setSelectionIndicatorPosition(n[0],n[1]),this.levelView.onAnimationEnd(this.levelView.playPlayerAnimation("punch",i.position,i.facing,!1),function(){o.queue.startPushHighPriorityCommands();var n=new s(t,function(){},function(){o.use(n,i)},o.identifier);if(!t.levelEntity.isFriendlyEntity(o.type)){var a=i.facing,r=new s(t,function(){},function(){o.pushBack(r,a,150)},o.identifier);o.addCommand(r)}o.addCommand(n),o.queue.endPushHighPriorityCommands(),t.levelView.playPlayerAnimation("idle",i.position,i.facing,!1),t.getIsDirectPlayerControl()?t.delayPlayerMoveBy(0,0,function(){e.succeeded()}):e.waitForOtherQueue=!0,setTimeout(function(){t.levelView.setSelectionIndicatorPosition(i.position[0],i.position[1])},0)})):r?(this.levelView.setSelectionIndicatorPosition(n[0],n[1]),this.levelView.onAnimationEnd(this.levelView.playPlayerAnimation("punch",i.position,i.facing,!1),function(){t.audioPlayer.play("doorOpen");var o=!a.isWalkable;t.levelView.playDoorAnimation(n,o,function(){a.isWalkable=!a.isWalkable,t.levelView.playIdleAnimation(i.position,i.facing,i.isOnBlock),t.levelView.setSelectionIndicatorPosition(i.position[0],i.position[1]),e.succeeded()})})):a&&a.isRail?(this.levelView.playTrack(n,i.facing,!0,i,null),e.succeeded()):this.levelView.playPunchDestroyAirAnimation(i.position,i.facing,this.levelModel.getMoveForwardPosition(),function(){t.levelView.setSelectionIndicatorPosition(i.position[0],i.position[1]),t.levelView.playIdleAnimation(i.position,i.facing,i.isOnBlock),t.delayPlayerMoveBy(0,0,function(){e.succeeded()})})}},{key:"destroyBlock",value:function(e){var t=this,i=this.getEntity(e.target);if(this.levelModel.canDestroyBlockForward(i)){var n=this.levelModel.actionPlane.getBlockAt(this.levelModel.getMoveForwardPosition(i));if(null!==n){var o=this.levelModel.getMoveForwardPosition(i),a=n.blockType;if(n.isDestroyable){switch(a){case"logAcacia":case"treeAcacia":a="planksAcacia";break;case"logBirch":case"treeBirch":a="planksBirch";break;case"logJungle":case"treeJungle":a="planksJungle";break;case"logOak":case"treeOak":a="planksOak";break;case"logSpruce":case"treeSpruce":a="planksSpruce"}this.levelView.playDestroyBlockAnimation(i.position,i.facing,o,a,i,function(){e.succeeded()})}else if(n.isUsable)switch(a){case"sheep":this.levelView.playShearSheepAnimation(i.position,i.facing,o,a,function(){e.succeeded()});break;default:e.succeeded()}else e.succeeded()}}else this.levelView.playPunchDestroyAirAnimation(i.position,i.facing,this.levelModel.getMoveForwardPosition(i),function(){t.levelView.setSelectionIndicatorPosition(i.position[0],i.position[1]),t.levelView.playIdleAnimation(i.position,i.facing,i.isOnBlock,i),t.delayPlayerMoveBy(0,0,function(){e.succeeded()})},i)}},{key:"destroyBlockWithoutPlayerInteraction",value:function(e){if(this.levelModel.inBounds(e)){var t=this.levelModel.actionPlane.getBlockAt(e);if(null!==t&&void 0!==t){var i=e,n=t.blockType;if(t.isDestroyable){switch(n){case"logAcacia":case"treeAcacia":n="planksAcacia";break;case"logBirch":case"treeBirch":n="planksBirch";break;case"logJungle":case"treeJungle":n="planksJungle";break;case"logOak":case"treeOak":n="planksOak";break;case"logSpruce":case"treeSpruce":case"logSpruceSnowy":case"treeSpruceSnowy":n="planksSpruce"}this.levelView.destroyBlockWithoutPlayerInteraction(i),this.levelView.playExplosionAnimation(this.levelModel.player.position,this.levelModel.player.facing,e,n,function(){},!1),this.levelView.createMiniBlock(i[0],i[1],n),this.updateFowPlane(),this.updateShadingPlane()}else if(t.isUsable)switch(n){case"sheep":this.levelView.playShearAnimation(this.levelModel.player.position,this.levelModel.player.facing,e,n,function(){})}}this.levelModel.destroyBlock(e)}}},{key:"checkTntAnimation",value:function(){return"freeplay"===this.specialLevelType}},{key:"checkMinecartLevelEndAnimation",value:function(){return"minecart"===this.specialLevelType}},{key:"checkHouseBuiltEndAnimation",value:function(){return"houseBuild"===this.specialLevelType}},{key:"checkAgentSpawn",value:function(){return"agentSpawn"===this.specialLevelType}},{key:"placeBlock",value:function(e,t){var i=this,n=this.getEntity(e.target),o=n.position,a=this.levelModel.actionPlane.getBlockAt(o),r=a.blockType;if(this.levelModel.canPlaceBlock(n,a))if(""!==r&&this.levelModel.destroyBlock(o),"cropWheat"!==t||"farmlandWet"===this.levelModel.groundPlane.getBlockAt(n.position).blockType)this.levelModel.player.updateHidingBlock(n.position),this.checkMinecartLevelEndAnimation()&&"rail"===t&&(t=n.position[1]<7?"railsUnpoweredVertical":"rails"),this.levelView.playPlaceBlockAnimation(n.position,n.facing,t,r,n,function(){i.levelModel.placeBlock(t,n),i.updateFowPlane(),i.updateShadingPlane(),i.delayBy(200,function(){i.levelView.playIdleAnimation(n.position,n.facing,!1,n)}),i.delayPlayerMoveBy(200,400,function(){e.succeeded()})});else var s=this.levelView.playPlayerAnimation("jumpUp",n.position,n.facing,!1,n).onLoop.add(function(){i.levelView.playIdleAnimation(n.position,n.facing,!1,n),s.detach(),i.delayBy(800,function(){return e.succeeded()})},this);else e.succeeded()}},{key:"setPlayerActionDelayByQueueLength",value:function(){if(this.levelModel.usePlayer){var e=this.levelModel.player.queue.getLength(),t=Math.min(Math.max(e-10,0),10);this.playerDelayFactor=1-t/10}}},{key:"delayBy",value:function(e,t){var i=this.game.time.create(!0);i.add(this.originalMsToScaled(e),t,this),i.start(),this.resettableTimers.push(i)}},{key:"delayPlayerMoveBy",value:function(e,t,i){this.delayBy(Math.max(e,t*this.playerDelayFactor),i)}},{key:"originalMsToScaled",value:function(e){return e/this.assumedSlowMotion*this.game.time.slowMotion}},{key:"originalFpsToScaled",value:function(e){return e*this.assumedSlowMotion/this.game.time.slowMotion}},{key:"placeBlockForward",value:function(e,t){this.placeBlockDirection(e,t,0)}},{key:"placeBlockDirection",value:function(e,t,i){var n,o,a=this,r=this.getEntity(e.target),s=function(){};this.levelModel.canPlaceBlockDirection(t,r,i)?(n=this.levelModel.getMoveDirectionPosition(r,i),o=this.levelModel.getPlaneToPlaceOn(n,r,t),this.levelModel.isBlockOfTypeOnPlane(n,"lava",o)&&(s=function(){return a.levelView.audioPlayer.play("fizz")}),this.levelView.playPlaceBlockInFrontAnimation(r,r.position,r.facing,n,function(){a.levelModel.placeBlockDirection(t,o,r,i),a.levelView.refreshGroundGroup(),a.updateFowPlane(),a.updateShadingPlane(),s(),a.delayBy(200,function(){a.levelView.playIdleAnimation(r.position,r.facing,!1,r)}),a.delayPlayerMoveBy(200,400,function(){e.succeeded()})})):this.levelView.playPunchAirAnimation(r.position,r.facing,r.position,function(){a.levelView.playIdleAnimation(r.position,r.facing,!1,r),e.succeeded()},r)}},{key:"checkSolution",value:function(){var e=this;if(this.attemptRunning&&!this.resultReported)if(this.levelModel.isSolved()){var t=this.levelModel.player;if(this.checkHouseBuiltEndAnimation()){this.resultReported=!0;var i=this.levelModel.getHouseBottomRight(),n=new h(i.x-1,i.y+2),o=new h(i.x,i.y),a=new h(i.x-1,i.y+1);this.levelModel.moveTo(n),this.levelView.playSuccessHouseBuiltAnimation(t.position,t.facing,t.isOnBlock,this.levelModel.houseGroundToFloorBlocks(i),[o,a],function(){e.endLevel(!0)},function(){e.levelModel.destroyBlock(o),e.levelModel.destroyBlock(a),e.updateFowPlane(),e.updateShadingPlane()})}else if(this.checkMinecartLevelEndAnimation())this.resultReported=!0,this.levelView.playMinecartAnimation(t.isOnBlock,function(){e.handleEndState(!0)});else if(this.checkAgentSpawn()){this.resultReported=!0,this.levelView.playLevelEndAnimation(t.position,t.facing,t.isOnBlock).onComplete.add(function(){e.levelModel.spawnAgent(null,new h(3,4),2),e.levelView.agent=e.agent,e.levelView.resetEntity(e.agent),e.updateFowPlane(),e.updateShadingPlane(),e.delayBy(200,function(){e.endLevel(!0)})})}else if(this.checkTntAnimation()){this.resultReported=!0,this.levelView.scaleShowWholeWorld(function(){});var r=this.levelModel.getTnt(),s=t.isOnBlock;this.levelView.playDestroyTntAnimation(t.position,t.facing,t.isOnBlock,this.levelModel.getTnt(),this.levelModel.shadingPlane,function(){for(var i in r){r[i].x===e.levelModel.player.position.x&&r[i].y===e.levelModel.player.position.y&&(e.levelModel.player.isOnBlock=!1);var n=e.levelModel.getAllBorderingPositionNotOfType(r[i],"tnt");e.levelModel.destroyBlock(r[i]);for(var o=1;o<n.length;++o)n[o][0]&&e.destroyBlockWithoutPlayerInteraction(n[o][1])}!t.isOnBlock&&s&&e.levelView.playPlayerJumpDownVerticalAnimation(t.facing,t.position),e.updateFowPlane(),e.updateShadingPlane(),e.delayBy(200,function(){e.levelView.playSuccessAnimation(t.position,t.facing,t.isOnBlock,function(){e.endLevel(!0)})})})}else this.endLevel(!0)}else!this.levelModel.isFailed()&&this.getIsDirectPlayerControl()||this.endLevel(!1)}},{key:"endLevel",value:function(e){var t=this;if(!this.levelModel.usePlayer)return e?this.levelView.audioPlayer.play("success"):this.levelView.audioPlayer.play("failure"),this.resultReported=!0,void this.handleEndState(e);if(e){var i=this.levelModel.player,n=new s(this,function(){},function(){t.levelView.playSuccessAnimation(i.position,i.facing,i.isOnBlock,function(){t.handleEndState(!0)})},i.identifier);i.queue.startPushHighPriorityCommands(),i.addCommand(n,this.isRepeat),i.queue.endPushHighPriorityCommands()}else{var o=this.levelModel.player,a=new s(this,function(){},function(){t.destroyEntity(a,o.identifier)},o.identifier);o.queue.startPushHighPriorityCommands(),o.addCommand(a,this.isRepeat),o.queue.endPushHighPriorityCommands()}}},{key:"addScore",value:function(e,t){this.addCommandRecord("addScore",void 0,e.repeat),this.useScore&&(this.score+=t,this.updateScore()),e.succeeded()}},{key:"updateScore",value:function(){this.onScoreUpdate&&this.onScoreUpdate(this.score)}},{key:"isPathAhead",value:function(e){return this.levelModel.isForwardBlockOfType(e)}},{key:"addCommand",value:function(e){void 0!==e.target?this.getEntity(e.target).addCommand(e,this.isRepeat):(this.queue.addCommand(e,this.isRepeat),this.queue.begin())}},{key:"addGlobalCommand",value:function(e){var t=this.levelEntity.entityMap.get(e.target);void 0!==t?t.addCommand(e,this.isRepeat):(this.queue.addCommand(e,this.isRepeat),this.queue.begin())}},{key:"startDay",value:function(e){var t=this;if(this.levelModel.isDaytime)void 0!==e&&null!==e&&e.succeeded(),this.DEBUG&&this.game.debug.text("Impossible to start day since it's already day time\n");else{void 0!==this.onDayCallback&&this.onDayCallback(),this.levelModel.isDaytime=!0,this.levelModel.clearFow(),this.levelView.updateFowGroup(this.levelModel.fowPlane),this.events.forEach(function(e){return e({eventType:l.WhenDayGlobal})});var i=this.levelEntity.entityMap,n=function(e){var i=e[1];t.events.forEach(function(e){return e({eventType:l.WhenDay,targetIdentifier:i.identifier,targetType:i.type})})},o=!0,a=!1,r=void 0;try{for(var s,c=i[Symbol.iterator]();!(o=(s=c.next()).done);o=!0){n(s.value)}}catch(e){a=!0,r=e}finally{try{!o&&c.return&&c.return()}finally{if(a)throw r}}for(var h=this.levelEntity.getEntitiesOfType("zombie"),u=0;u<h.length;u++)h[u].setBurn(!0);void 0!==e&&null!==e&&e.succeeded()}}},{key:"startNight",value:function(e){var t=this;if(this.levelModel.isDaytime){void 0!==this.onNightCallback&&this.onNightCallback(),this.levelModel.isDaytime=!1,this.levelModel.computeFowPlane(),this.levelView.updateFowGroup(this.levelModel.fowPlane),this.events.forEach(function(e){return e({eventType:l.WhenNightGlobal})});var i=this.levelEntity.entityMap,n=function(e){var i=e[1];t.events.forEach(function(e){return e({eventType:l.WhenNight,targetIdentifier:i.identifier,targetType:i.type})})},o=!0,a=!1,r=void 0;try{for(var s,c=i[Symbol.iterator]();!(o=(s=c.next()).done);o=!0){n(s.value)}}catch(e){a=!0,r=e}finally{try{!o&&c.return&&c.return()}finally{if(a)throw r}}for(var h=this.levelEntity.getEntitiesOfType("zombie"),u=0;u<h.length;u++)h[u].setBurn(!1);void 0!==e&&null!==e&&e.succeeded()}else void 0!==e&&null!==e&&e.succeeded(),this.DEBUG&&this.game.debug.text("Impossible to start night since it's already night time\n")}},{key:"initiateDayNightCycle",value:function(e,t,i){var n=this;"day"===i||"Day"===i?this.timeouts.push(setTimeout(function(){n.startDay(null),n.setDayNightCycle(t,"night")},1e3*e)):"night"!==i&&"Night"!==i||this.timeouts.push(setTimeout(function(){n.startNight(null),n.setDayNightCycle(t,"day")},1e3*e))}},{key:"setDayNightCycle",value:function(e,t){var i=this;this.dayNightCycle&&("day"===t||"Day"===t?this.timeouts.push(setTimeout(function(){i.dayNightCycle&&(i.startDay(null),i.setDayNightCycle(e,"night"))},1e3*e)):"night"!==t&&"Night"!==t||this.timeouts.push(setTimeout(function(){i.dayNightCycle&&(i.startNight(null),i.setDayNightCycle(e,"day"))},1e3*e)))}},{key:"arrowDown",value:function(e){this.levelModel.usePlayer&&(this.player.movementState=e,this.player.updateMovement())}},{key:"arrowUp",value:function(e){this.levelModel.usePlayer&&(this.player.movementState===e&&(this.player.movementState=-1),this.player.updateMovement())}},{key:"clickDown",value:function(){this.levelModel.usePlayer&&(this.player.movementState=-2,this.player.updateMovement())}},{key:"clickUp",value:function(){this.levelModel.usePlayer&&(-2===this.player.movementState&&(this.player.movementState=-1),this.player.updateMovement())}},{key:"updateFowPlane",value:function(){this.levelModel.computeFowPlane(),this.levelView.updateFowGroup(this.levelModel.fowPlane)}},{key:"updateShadingPlane",value:function(){this.levelModel.computeShadingPlane(),this.levelView.updateShadingGroup(this.levelModel.shadingPlane)}}]),e}();window.GameController=g,e.exports=g},function(e,t,i){"use strict";var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();var o=i(13),a=i(8),r=i(2),s=i(3),l=i(15),c=i(16);e.exports=function(){function e(t,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.planeWidth=t.gridDimensions?t.gridDimensions[0]:10,this.planeHeight=t.gridDimensions?t.gridDimensions[1]:10,this.controller=i,this.player={},this.agent={},this.usingAgent=!1,this.initialLevelData=Object.create(t),this.reset(),this.initialPlayerState=Object.create(this.player),this.initialAgentState=Object.create(this.agent)}return n(e,[{key:"planeArea",value:function(){return this.planeWidth*this.planeHeight}},{key:"inBounds",value:function(e){var t=e[0],i=e[1];return t>=0&&t<this.planeWidth&&i>=0&&i<this.planeHeight}},{key:"reset",value:function(){var e=this;this.groundPlane=new o(this.initialLevelData.groundPlane,this.planeWidth,this.planeHeight,this,"groundPlane"),this.groundDecorationPlane=new o(this.initialLevelData.groundDecorationPlane,this.planeWidth,this.planeHeight,this,"decorationPlane"),this.shadingPlane=[],this.actionPlane=new o(this.initialLevelData.actionPlane,this.planeWidth,this.planeHeight,this,"actionPlane"),this.actionPlane.powerRedstone(),this.actionPlane.getAllPositions().forEach(function(t){e.actionPlane.getBlockAt(t).isRedstone&&e.actionPlane.determineRedstoneSprite(t),e.actionPlane.getBlockAt(t).isRail&&e.actionPlane.determineRailType(t)}),this.fluffPlane=new o(this.initialLevelData.fluffPlane,this.planeWidth,this.planeHeight),this.fowPlane=[],this.isDaytime=void 0===this.initialLevelData.isDaytime||this.initialLevelData.isDaytime;var t=Object.create(this.initialLevelData);if(void 0!==this.initialLevelData.usePlayer?this.usePlayer=this.initialLevelData.usePlayer:this.usePlayer=!0,this.usePlayer){var i=s.fromArray(t.playerStartPosition);this.player=new l(this.controller,"Player",i.x,i.y,this.initialLevelData.playerName||"Steve",!this.actionPlane.getBlockAt(i).getIsEmptyOrEntity(),t.playerStartDirection),this.controller.levelEntity.pushEntity(this.player),this.controller.player=this.player,t.useAgent&&this.spawnAgent(t)}!t.useAgent&&this.usingAgent&&this.destroyAgent(),this.computeShadingPlane(),this.computeFowPlane()}},{key:"spawnAgent",value:function(e,t,i){this.usingAgent=!0;var n=void 0!==t?t:s.fromArray(e.agentStartPosition),o=void 0!==i?i:e.agentStartDirection,a=this.actionPlane.getBlockAt(n);this.agent=new c(this.controller,"PlayerAgent",n.x,n.y,"Agent",!a.getIsEmptyOrEntity(),o),this.controller.levelEntity.pushEntity(this.agent),this.controller.agent=this.agent}},{key:"destroyAgent",value:function(){this.controller.agent=void 0,this.controller.levelEntity.destroyEntity(this.agent.identifier),this.agent=void 0,this.usingAgent=!1}},{key:"yToIndex",value:function(e){return e*this.planeWidth}},{key:"isSolved",value:function(){return this.initialLevelData.verificationFunction(this)}},{key:"isFailed",value:function(){return void 0!==this.initialLevelData.failureCheckFunction&&this.initialLevelData.failureCheckFunction(this)}},{key:"getHouseBottomRight",value:function(){return s.fromArray(this.initialLevelData.houseBottomRight)}},{key:"isPlayerNextTo",value:function(e){var t=this;return!!this.usePlayer&&s.getOrthogonalPositions(this.player.position).some(function(i){return t.inBounds(i)&&(t.isBlockOfType(i,e)||t.isEntityOfType(i,e)||t.groundPlane.getBlockAt(i).blockType===e)})}},{key:"isEntityNextTo",value:function(e,t){var i=this;return this.controller.levelEntity.getEntitiesOfType(e).some(function(e){return s.getOrthogonalPositions(e.position).some(function(e){return i.inBounds(e)&&(i.isBlockOfType(e,t)||i.isEntityOfType(e,t)||i.groundPlane.getBlockAt(e).blockType===t)})})}},{key:"isEntityOnBlocktype",value:function(e,t){for(var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n=this.controller.levelEntity.getEntitiesOfType(e),o=0,a=0;a<n.length;a++){var r=n[a];(this.isBlockOfType(r.position,t)||this.groundPlane.getBlockAt(r.position).blockType===t)&&o++}return o>=i}},{key:"isEntityAt",value:function(e,t){Array.isArray(t)&&(t=s.fromArray(t));for(var i=this.controller.levelEntity.getEntitiesOfType(e),n=0;n<i.length;n++){var o=i[n];if(s.equals(o.position,t))return!0}return!1}},{key:"isEntityTypeRunning",value:function(e){for(var t=this.controller.levelEntity.getEntitiesOfType(e),i=0;i<t.length;i++){var n=t[i],o=!n.queue.isStarted(),a=!n.queue.isFinished();if(o&&n.queue.commandList_.length>0||a)return!0}return!1}},{key:"isEntityDied",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=this.controller.levelEntity.entityDeathCount;return!!(i.has(e)&&i.get(e)>=t)}},{key:"getScore",value:function(){return this.controller.score}},{key:"shouldRide",value:function(e){var t=this.player,i=this.getNextRailPosition(t,e),n=this.actionPlane.getBlockAt(i);return this.isNextRailValid(n,e)}},{key:"isNextRailValid",value:function(e,t){if(e)return r.opposite(e.connectionA)===t||r.opposite(e.connectionB)===t||e.connectionA===t||e.connectionB===t}},{key:"getNextRailPosition",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.player,t=arguments[1],i=s.directionToOffsetPosition(t)||new s(0,0);return s.add(e.position,i)}},{key:"getEntityCount",value:function(e){return this.controller.levelEntity.getEntitiesOfType(e).length}},{key:"getCommandExecutedCount",value:function(e,t){return this.controller.getCommandCount(e,t,!1)}},{key:"getRepeatCommandExecutedCount",value:function(e,t){return this.controller.getCommandCount(e,t,!0)}},{key:"getTurnRandomCount",value:function(){return this.controller.turnRandomCount}},{key:"getInventoryAmount",value:function(e){if(!this.usePlayer)return 0;if("all"===e||"All"===e){var t=this.player.inventory,i=0;for(var n in t)i+=t[n];return i}return this.player.inventory[e]}},{key:"getInventoryTypes",value:function(){return this.usePlayer?Object.keys(this.player.inventory):[]}},{key:"countOfTypeOnMap",value:function(e){var t=this;return this.actionPlane.getAllPositions().filter(function(i){return t.actionPlane.getBlockAt(i).blockType===e}).length}},{key:"isPlayerAt",value:function(e){return!!this.usePlayer&&(Array.isArray(e)&&(e=s.fromArray(e)),s.equals(this.player.position,e))}},{key:"spritePositionToIndex",value:function(e,t){var i=s.subtract(t,e);return new s(i.x/40,i.y/40)}},{key:"solutionMapMatchesResultMap",value:function(e){for(var t=0;t<this.planeArea();t++){var i=e[t],n=this.actionPlane.indexToCoordinates(t);if(""!==i)if("empty"===i){if(!this.actionPlane.getBlockAt(n).isEmpty)return!1}else if("any"===i){if(this.actionPlane.getBlockAt(n).isEmpty)return!1}else if(this.actionPlane.getBlockAt(n).blockType!==i)return!1}return!0}},{key:"getTnt",value:function(){var e=this;return this.actionPlane.getAllPositions().filter(function(t){var i=e.actionPlane.getBlockAt(t);return i&&"tnt"===i.blockType})}},{key:"getMoveForwardPosition",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.player;return s.forward(e.position,e.facing)}},{key:"getMoveDirectionPosition",value:function(e,t){for(var i=e.facing,n=0;n<t;++n)i=r.turn(i,"right");return s.forward(e.position,i)}},{key:"isForwardBlockOfType",value:function(e){var t=this.getMoveForwardPosition(),i=this.isBlockOfTypeOnPlane(t,"empty",this.actionPlane);return!(""!==e||!i)||(i?this.isBlockOfTypeOnPlane(t,e,this.groundPlane):this.isBlockOfTypeOnPlane(t,e,this.actionPlane))}},{key:"getForwardBlockType",value:function(){return this.getForwardBlock().blockType}},{key:"getForwardBlock",value:function(){var e=this.getMoveForwardPosition();return this.actionPlane.getBlockAt(e)}},{key:"isBlockOfType",value:function(e,t){return this.isBlockOfTypeOnPlane(e,t,this.actionPlane)}},{key:"isEntityOfType",value:function(e,t){return this.controller.levelEntity.getEntitiesOfType(t).some(function(t){return s.equals(e,t.position)})}},{key:"isBlockOfTypeOnPlane",value:function(e,t,i){var n=!1;return this.inBounds(e)&&(n="empty"===t?i.getBlockAt(e).isEmpty:"tree"===t?i.getBlockAt(e).getIsTree():t===i.getBlockAt(e).blockType),n}},{key:"isPlayerStandingInWater",value:function(){return"water"===this.groundPlane.getBlockAt(this.player.position).blockType}},{key:"isPlayerStandingInLava",value:function(){return"lava"===this.groundPlane.getBlockAt(this.player.position).blockType}},{key:"coordinatesToIndex",value:function(e){return this.yToIndex(e[1])+e[0]}},{key:"checkPositionForTypeAndPush",value:function(e,t,i){return!e&&""!==this.actionPlane.getBlockAt(t).blockType||this.isBlockOfType(t,e)?(i.push([!0,t]),!0):(i.push([!1,null]),!1)}},{key:"houseGroundToFloorHelper",value:function(e,t,i){var n,o,a,r,s,l=0,c=i,h=this.yToIndex(e[2])+e[1];44===h&&(h=44),(o=[0,e[1],e[2]+1])[0]=this.yToIndex(o[2])+o[1],(a=[0,e[1],e[2]-1])[0]=this.yToIndex(a[2])+a[1],(r=[0,e[1]+1,e[2]])[0]=this.yToIndex(r[2])+r[1],s=[0,e[1]-1,e[2]],r[0]=this.yToIndex(r[2])+r[1],n=this.actionPlane.getBlockAt(this.actionPlane.indexToCoordinates(h));for(var u=0;u<c.length;++u)if(c[u][0]===h){l=-1;break}return""!==n.blockType?{}:c.length>0&&-1===l?{}:(c.push(e),c.concat(this.houseGroundToFloorHelper(o,t,c)),c.concat(this.houseGroundToFloorHelper(a,t,c)),c.concat(this.houseGroundToFloorHelper(r,t,c)),c.concat(this.houseGroundToFloorHelper(s,t,c)),c)}},{key:"houseGroundToFloorBlocks",value:function(e){var t=[0,e[0],e[1]];return this.houseGroundToFloorHelper(t,"wool_orange",[])}},{key:"getEntityAt",value:function(e){var t=!0,i=!1,n=void 0;try{for(var o,a=this.controller.levelEntity.entityMap[Symbol.iterator]();!(t=(o=a.next()).done);t=!0){var r=o.value;if(s.equals(r[1].position,e))return r[1]}}catch(e){i=!0,n=e}finally{try{!t&&a.return&&a.return()}finally{if(i)throw n}}}},{key:"getAllBorderingPositionNotOfType",value:function(e,t){for(var i=this.getAllBorderingPosition(e,null),n=1;n<i.length;++n)i[n][0]&&this.actionPlane.getBlockAt(i[n][1]).blockType===t&&(i[n][0]=!1);return i}},{key:"getAllBorderingPosition",value:function(e,t){var i=this,n=[!1];return s.getSurroundingPositions(e).forEach(function(e){i.checkPositionForTypeAndPush(t,e,n)&&(n[0]=!0)}),n}},{key:"canMoveForward",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.player,t=this.getMoveForwardPosition(e);return!(!this.controller.followingPlayer()&&(t.x>9||t.y>9))&&this.isPositionEmpty(t,e)}},{key:"canMoveBackward",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.player,t=this.getMoveDirectionPosition(e,2);return this.isPositionEmpty(t,e)}},{key:"isPositionEmpty",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.player,i=[!1];if(this.inBounds(e)){if(this.actionPlane.getBlockAt(e).isWalkable||i.push("notWalkable"),!this.actionPlane.getBlockAt(e).isEmpty){if(this.player.isOnBlock)return[!0];i.push("notEmpty")}if("water"===this.groundPlane.getBlockAt(e).blockType){if(!this.controller.getIsDirectPlayerControl())return[!0];i.push("water")}else if("lava"===this.groundPlane.getBlockAt(e).blockType){if(!this.controller.getIsDirectPlayerControl())return[!0];i.push("lava")}var n=this.getEntityAt(e);void 0!==n&&(i.push("frontEntity"),i.push(n));var o=this.groundPlane.getBlockAt(e),a=this.actionPlane.getBlockAt(e);i[0]=t.hasPermissionToWalk(a,n,o)}else i.push("outBound");return i}},{key:"canMoveDirection",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.player,t=arguments[1],i=e.facing;this.turnToDirection(e,t);var n=this.canMoveForward(e);return this.turnToDirection(e,i),n}},{key:"canPlaceBlock",value:function(e,t){return e.canPlaceBlock(t)}},{key:"canPlaceBlockDirection",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments[1],i=arguments[2];return!t.isOnBlock&&((this.getPlaneToPlaceOn(this.getMoveDirectionPosition(t,i),t,e)!==this.groundPlane||!a.notValidOnGroundPlane(e)||!this.groundPlane.getBlockAt(this.getMoveDirectionPosition(t,i)))&&(!this.checkEntityConflict(this.getMoveDirectionPosition(t,i))&&null!==this.getPlaneToPlaceOn(this.getMoveDirectionPosition(t,i),t,e)))}},{key:"checkEntityConflict",value:function(e){var t=!1;return this.controller.levelEntity.entityMap.forEach(function(i){s.equals(i.position,e)&&(t=!0)}),t}},{key:"canPlaceBlockForward",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.player;return this.canPlaceBlockDirection(e,t,0)}},{key:"getPlaneToPlaceOn",value:function(e,t,i){if(this.inBounds(e)){var n=this.actionPlane.getBlockAt(e);if(t===this.agent&&n.isEmpty){if(this.groundPlane.getBlockAt(e).getIsLiquid()){if(a.getCanFall(i))return this.groundPlane;if(!a.getIsPlaceableInLiquid(i))return null}return this.actionPlane}if(n.isPlacable)return this.groundPlane.getBlockAt(e).isPlacable?this.groundPlane:this.actionPlane}return null}},{key:"canDestroyBlockForward",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.player,t=!1;if(!e.isOnBlock){var i=this.getMoveForwardPosition(e);if(this.inBounds(i)){var n=this.actionPlane.getBlockAt(i);t=!n.isEmpty&&(n.isDestroyable||n.isUsable)}}return t}},{key:"moveForward",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.player,t=this.getMoveForwardPosition(e);this.moveTo(t,e)}},{key:"moveBackward",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.player,t=this.getMoveDirectionPosition(e,2);this.moveTo(t,e)}},{key:"moveTo",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.player;t.setMovePosition(e),this.actionPlane.getBlockAt(e).isEmpty&&(t.isOnBlock=!1)}},{key:"turnLeft",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.player;e.facing=r.turn(e.facing,"left")}},{key:"turnRight",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.player;e.facing=r.turn(e.facing,"right")}},{key:"turnToDirection",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.player,t=arguments[1];e.facing=t}},{key:"moveDirection",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.player,t=arguments[1];this.turnToDirection(e,t),this.moveForward()}},{key:"placeBlock",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.player,i=t.position,n=null,o=this.groundPlane.getBlockAt(i),r=this.actionPlane.getBlockAt(i),s=new a(e),l=t.canPlaceBlockOver(s,o);if(l.canPlace&&!r.getIsMiniblock())switch(l.plane){case"actionPlane":n=this.actionPlane.setBlockAt(i,s),t.walkableCheck(s);break;case"groundPlane":this.groundPlane.setBlockAt(i,s)}return n}},{key:"placeBlockForward",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.player;return this.placeBlockDirection(e,t,i,0)}},{key:"placeBlockDirection",value:function(e,t,i,n){var o=this.getMoveDirectionPosition(i,n);return"watering"===e&&(e="farmlandWet",t=this.groundPlane),t.setBlockAt(o,new a(e))}},{key:"destroyBlock",value:function(e){var t=null;return this.inBounds(e)&&null!==(t=this.actionPlane.getBlockAt(e))&&(t.position=e,t.isDestroyable&&this.actionPlane.setBlockAt(e,new a(""))),t}},{key:"destroyBlockForward",value:function(e){var t=null,i=this.getMoveForwardPosition(e);return this.inBounds(i)&&null!==(t=this.actionPlane.getBlockAt(i))&&t.isDestroyable&&this.actionPlane.setBlockAt(i,new a("")),t}},{key:"solveFOWTypeForMap",value:function(){var e,t;for(var i in e=this.getAllEmissives(),t=this.findBlocksAffectedByEmissives(e))t.hasOwnProperty(i)&&this.solveFOWTypeFor(t[i],e)}},{key:"solveFOWTypeFor",value:function(e,t){var i,n,o,a=!1,r=!1,s=!1,l=!1,c=!1,h=!1,u=!1,d=!1,p=0,f=this.coordinatesToIndex(e);for(var y in i=this.findEmissivesThatTouch(e,t)){var m=i[y];o=e[1],n=e[0],(p=-(p=Math.atan2(m[1]-e[1],m[0]-e[0])))<0&&(p+=2*Math.PI),p*=360/(2*Math.PI),!h&&p>32.5&&p<=57.5&&(l=!0,this.pushIfHigherPrecedence(f,{x:n,y:o,type:"FogOfWar_InCorner_TopRight",precedence:0})),!s&&p>122.5&&p<=147.5&&(a=!0,this.pushIfHigherPrecedence(f,{x:n,y:o,type:"FogOfWar_InCorner_TopLeft",precedence:0})),!s&&p>212.5&&p<=237.5&&(r=!0,this.pushIfHigherPrecedence(f,{x:n,y:o,type:"FogOfWar_InCorner_BottomLeft",precedence:0})),!h&&p>302.5&&p<=317.5&&(c=!0,this.pushIfHigherPrecedence(f,{x:n,y:o,type:"FogOfWar_InCorner_BottomRight",precedence:0})),(p>=327.5||p<=32.5)&&(h=!0,this.pushIfHigherPrecedence(f,{x:n,y:o,type:"FogOfWar_Right",precedence:1})),p>237.5&&p<=302.5&&(d=!0,this.pushIfHigherPrecedence(f,{x:n,y:o,type:"FogOfWar_Bottom",precedence:1})),p>147.5&&p<=212.5&&(s=!0,this.pushIfHigherPrecedence(f,{x:n,y:o,type:"FogOfWar_Left",precedence:1})),p>57.5&&p<=122.5&&(u=!0,this.pushIfHigherPrecedence(f,{x:n,y:o,type:"FogOfWar_Top",precedence:1}))}a&&r&&this.pushIfHigherPrecedence(f,{x:n,y:o,type:"FogOfWar_Left",precedence:1}),l&&c&&this.pushIfHigherPrecedence(f,{x:n,y:o,type:"FogOfWar_Right",precedence:1}),a&&l&&this.pushIfHigherPrecedence(f,{x:n,y:o,type:"FogOfWar_Top",precedence:1}),c&&r&&this.pushIfHigherPrecedence(f,{x:n,y:o,type:"FogOfWar_Bottom",precedence:1}),c&&a||r&&l||s&&h||u&&d||h&&d&&a||d&&l&&a||u&&c&&r||s&&l&&c||s&&d&&l?this.fowPlane[f]="":d&&s||d&&a||s&&c?this.pushIfHigherPrecedence(f,{x:n,y:o,type:"FogOfWar_Bottom_Left",precedence:2}):d&&h||d&&l||h&&r?this.pushIfHigherPrecedence(f,{x:n,y:o,type:"FogOfWar_Bottom_Right",precedence:2}):u&&h||u&&c||h&&a?this.pushIfHigherPrecedence(f,{x:n,y:o,type:"FogOfWar_Top_Right",precedence:2}):(u&&s||u&&r||s&&l)&&this.pushIfHigherPrecedence(f,{x:n,y:o,type:"FogOfWar_Top_Left",precedence:2})}},{key:"pushIfHigherPrecedence",value:function(e,t){if(""!==t){var i=this.fowPlane[e];i&&i.precedence>t.precedence||(this.fowPlane[e]=t)}else this.fowPlane[e]=""}},{key:"getAllEmissives",value:function(){for(var e=[],t=0;t<this.planeHeight;++t)for(var i=0;i<this.planeWidth;++i){var n=new s(i,t);(!this.actionPlane.getBlockAt(n).isEmpty&&this.actionPlane.getBlockAt(n).isEmissive||this.groundPlane.getBlockAt(n).isEmissive&&this.actionPlane.getBlockAt(n).isEmpty)&&e.push(n)}return e}},{key:"findBlocksAffectedByEmissives",value:function(e){var t={};for(var i in e)for(var n=e[i],o=n.x,a=n.y,r=n.y-2;r<=a+2;++r)for(var l=n.x-2;l<=o+2;++l){var c=new s(l,r);this.inBounds(c)&&(r>=a-1&&r<=a+1&&l>=o-1&&l<=o+1||(t[r.toString()+l.toString()]=c))}return t}},{key:"findEmissivesThatTouch",value:function(e,t){for(var i=[],n=e.y,o=e.x,a=n-2;a<=n+2;++a)for(var r=o-2;r<=o+2;++r){var l=new s(r,a);if(this.inBounds(l)&&!(a>=n-1&&a<=n+1&&r>=o-1&&r<=o+1))for(var c in t)s.equals(t[c],l)&&i.push(t[c])}return i}},{key:"computeFowPlane",value:function(){var e,t;if(this.fowPlane=[],!this.isDaytime){for(t=0;t<this.planeHeight;++t)for(e=0;e<this.planeWidth;++e)this.fowPlane.push({x:e,y:t,type:"FogOfWar_Center"});for(this.solveFOWTypeForMap(),t=0;t<this.planeHeight;++t)for(e=0;e<this.planeWidth;++e){var i=new s(e,t),n=this.groundPlane.getBlockAt(i),o=this.actionPlane.getBlockAt(i);(n.isEmissive&&o.isEmpty||!o.isEmpty&&o.isEmissive)&&this.clearFowAround(e,t)}}}},{key:"clearFowAround",value:function(e,t){var i,n;for(n=-1;n<=1;++n)for(i=-1;i<=1;++i)this.clearFowAt(e+i,t+n)}},{key:"clearFowAt",value:function(e,t){if(e>=0&&e<this.planeWidth&&t>=0&&t<this.planeHeight){var i=this.yToIndex(t)+e;this.fowPlane[i]=""}}},{key:"clearFow",value:function(){for(var e=0;e<this.planeWidth;e++)for(var t=0;t<this.planeHeight;t++){var i=this.yToIndex(t)+e;this.fowPlane[i]=""}}},{key:"computeShadingPlane",value:function(){this.shadingPlane=[],this.computeShading(this.actionPlane),this.computeShading(this.groundPlane)}},{key:"occludedBy",value:function(e){return e&&!e.getIsEmptyOrEntity()&&!e.getIsLiquid()}},{key:"computeShading",value:function(e){var t,i,n,o;for(n=0;n<this.planeArea();++n){t=n%this.planeWidth,i=Math.floor(n/this.planeWidth);var a=new s(t,i);o=!1;var r=e.getBlockAt(a),l=this.groundPlane.getBlockAt(a);if(r.isEmpty||r.isTransparent||r.getIsLiquid()){var c="AO";"lava"===r.blockType?c="LavaGlow":"water"===r.blockType&&(c="WaterAO"),r!==l&&l.getIsLiquid()||(0===i&&this.shadingPlane.push({x:t,y:i,atlas:c,type:"AOeffect_Bottom"}),i===this.planeHeight-1&&this.shadingPlane.push({x:t,y:i,atlas:c,type:"AOeffect_Top"}),0===t&&this.shadingPlane.push({x:t,y:i,atlas:c,type:"AOeffect_Right"}),t===this.planeWidth-1&&this.shadingPlane.push({x:t,y:i,atlas:c,type:"AOeffect_Left"}));var h=e.getSurroundingBlocks(a);t<this.planeWidth-1&&this.occludedBy(h.east)&&this.shadingPlane.push({x:t,y:i,atlas:c,type:"AOeffect_Left"}),t>0&&this.occludedBy(h.west)&&(this.shadingPlane.push({x:t,y:i,atlas:c,type:"AOeffect_Right"}),r.getIsLiquid()||(this.shadingPlane.push({x:t,y:i,atlas:"blockShadows",type:"Shadow_Parts_Fade_base.png"}),i>0&&t>0&&e.getBlockAt(s.north(s.west(a))).getIsEmptyOrEntity()&&this.shadingPlane.push({x:t,y:i,atlas:"blockShadows",type:"Shadow_Parts_Fade_top.png"})),o=!0),i>0&&this.occludedBy(h.north)?this.shadingPlane.push({x:t,y:i,atlas:c,type:"AOeffect_Bottom"}):i>0&&(t<this.planeWidth-1&&this.occludedBy(h.northEast)&&!this.occludedBy(h.east)&&this.shadingPlane.push({x:t,y:i,atlas:c,type:"AOeffect_BottomLeft"}),!o&&t>0&&this.occludedBy(h.northWest)&&this.shadingPlane.push({x:t,y:i,atlas:c,type:"AOeffect_BottomRight"})),i<this.planeHeight-1&&this.occludedBy(h.south)?this.shadingPlane.push({x:t,y:i,atlas:c,type:"AOeffect_Top"}):i<this.planeHeight-1&&(t<this.planeWidth-1&&this.occludedBy(h.southEast)&&!this.occludedBy(h.east)&&this.shadingPlane.push({x:t,y:i,atlas:c,type:"AOeffect_TopLeft"}),!o&&t>0&&this.occludedBy(h.southWest)&&this.shadingPlane.push({x:t,y:i,atlas:c,type:"AOeffect_TopRight"}))}}}}]),e}()},function(e,t,i){"use strict";var n=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var i=[],n=!0,o=!1,a=void 0;try{for(var r,s=e[Symbol.iterator]();!(n=(r=s.next()).done)&&(i.push(r.value),!t||i.length!==t);n=!0);}catch(e){o=!0,a=e}finally{try{!n&&s.return&&s.return()}finally{if(o)throw a}}return i}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),o=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();var a=i(8),r=i(2),s=r.North,l=r.South,c=r.East,h=r.West,u=r.opposite,d=r.turnDirection,p=r.turn,f=r.directionToRelative,y=i(3),m=i(14),v=function(e){switch(e){case s:return"North";case l:return"South";case c:return"East";case h:return"West";default:return""}},g=["","Vertical","Vertical","Vertical","Horizontal","UpRight","DownRight","TRight","Horizontal","UpLeft","DownLeft","TLeft","Horizontal","TUp","TDown","Cross"],k=[[],[s],[l],[s,l],[c],[s,c],[l,c],[l,c],[h],[s,h],[l,h],[l,h],[c,h],[s,c],[l,c],[s,c]],b=[[],[s],[l],[s,l],[c],[c,h],[c,h],[c,h],[h],[c,h],[c,h],[c,h],[c,h],[c,h],[c,h],[c,h]];e.exports=function(){function e(t,i,n,o,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._data=[],this.width=i,this.height=n,this.levelModel=o,this.planeType=r,this.playPistonOn=!1,this.playPistonOff=!1;for(var s=0;s<t.length;++s){var l=new a(t[s]);this._data.push(l)}this.isActionPlane()&&(this.redstoneAdjacencySet=this.createRedstoneAdjacencySet())}return o(e,[{key:"inBounds",value:function(e){return e.x>=0&&e.x<this.width&&e.y>=0&&e.y<this.height}},{key:"coordinatesToIndex",value:function(e){return e.y*this.width+e.x}},{key:"indexToCoordinates",value:function(e){var t=Math.floor(e/this.width),i=e-t*this.width;return new y(i,t)}},{key:"getAllPositions",value:function(){var e=this;return this._data.map(function(t,i){return e.indexToCoordinates(i)})}},{key:"getBlockAt",value:function(e){if(e=y.fromArray(e),this.inBounds(e))return this._data[this.coordinatesToIndex(e)]}},{key:"isActionPlane",value:function(){return"actionPlane"===this.planeType}},{key:"isDecorationPlane",value:function(){return"decorationPlane"===this.planeType}},{key:"isGroundPlane",value:function(){return"groundPlane"===this.planeType}},{key:"setBlockAt",value:function(e,t){var i=this;if(e=y.fromArray(e),this.inBounds(e)){if(this._data[this.coordinatesToIndex(e)]=t,this.isActionPlane()){t.isRedstone||t.isRedstoneBattery?this.redstoneAdjacencySet.add(e):this.redstoneAdjacencySet.remove(e);var n=[];if(t.needToRefreshRedstone()&&(n=this.refreshRedstone()),this.updateWeakCharge(e,t),t.isEmpty&&[s,l,c,h].forEach(function(t){var n=y.directionToOffsetPosition(t),o=i.getBlockAt(y.add(e,n));o&&o.isRail&&(o.connectionA===u(t)&&(o.connectionA=void 0),o.connectionB===u(t)&&(o.connectionB=void 0))}),this.determineRailType(e,!0),this.levelModel&&this.levelModel.controller.levelView){var o=y.north(y.east(e)),a=y.south(y.west(e)),r=y.getOrthogonalPositions(e).concat([e,o,a]);this.levelModel.controller.levelView.refreshActionGroup(r),this.levelModel.controller.levelView.refreshActionGroup(n)}}else this.isGroundPlane()&&this.levelModel.controller.levelView.refreshGroundGroup();return t}}},{key:"getOrthogonalBlocks",value:function(e){return{north:{block:this.getBlockAt(y.north(e)),relative:l},south:{block:this.getBlockAt(y.south(e)),relative:s},east:{block:this.getBlockAt(y.east(e)),relative:h},west:{block:this.getBlockAt(y.west(e)),relative:c}}}},{key:"getSurroundingBlocks",value:function(e){return{north:this.getBlockAt(y.north(e)),northEast:this.getBlockAt(y.north(y.east(e))),east:this.getBlockAt(y.east(e)),southEast:this.getBlockAt(y.south(y.east(e))),south:this.getBlockAt(y.south(e)),southWest:this.getBlockAt(y.south(y.west(e))),west:this.getBlockAt(y.west(e)),northWest:this.getBlockAt(y.north(y.west(e)))}}},{key:"getOrthogonalMask",value:function(e,t){var i=this.getOrthogonalBlocks(e);return(t(i.north)<<0)+(t(i.south)<<1)+(t(i.east)<<2)+(t(i.west)<<3)}},{key:"getMinecartTrack",value:function(e,t){var i=this.getBlockAt(e);if(i.isRail){if(i.connectionA===t||i.connectionB===t)return["",y.forward(e,t),t,300];var n=u(t);if(i.connectionA===n&&void 0!==i.connectionB){var o=d(t,i.connectionB);return["turn_"+o,e,p(t,o),300]}if(i.connectionB===n&&void 0!==i.connectionA){var a=d(t,i.connectionA);return["turn_"+a,e,p(t,a),300]}}}},{key:"getPoweredRailsConnected",value:function(e,t){if(!y.isAdjacent(e,t))return!1;var i=this.getBlockAt(e),n=this.getBlockAt(t);return!(!i.getIsPowerableRail()||!n.getIsPowerableRail())&&(i.getIsHorizontal()&&n.getIsHorizontal()?y.equals(y.forward(e,c),t)||y.equals(y.forward(e,h),t):!(!i.getIsVertical()||!n.getIsVertical())&&(y.equals(y.forward(e,s),t)||y.equals(y.forward(e,l),t)))}},{key:"powerRedstone",value:function(){var e=this;return this.redstoneAdjacencySet.sets.forEach(function(t){var i=t.some(function(t){return e.getBlockAt(t).isRedstoneBattery});t.forEach(function(t){e.getBlockAt(t).isPowered=i,e.determineRedstoneSprite(t)})}),this.redstoneAdjacencySet.flattenSets()}},{key:"createRedstoneAdjacencySet",value:function(){var e=this,t=this.getAllPositions().filter(function(t){var i=e.getBlockAt(t);return i.isRedstone||i.isRedstoneBattery});return new m(t)}},{key:"powerRails",value:function(){var e=this,t=this.getAllPositions().filter(function(t){return e.getBlockAt(t).getIsPowerableRail()});return t.forEach(function(t){e.determineRailType(t)}),new m(t,this.getPoweredRailsConnected.bind(this)).sets.forEach(function(t){t.some(function(t){return e.getBlockAt(t).isPowered})&&t.forEach(function(t){e.getBlockAt(t).isPowered=!0})}),t.forEach(function(t){e.determineRailType(t)}),t}},{key:"determineRailType",value:function(e){var t=this,i=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=this.getBlockAt(e);if(o&&o.isRail){var a="",r=k;if(o.getIsPowerableRail()&&(a=o.isPowered?"Powered":"Unpowered",r=b),void 0===o.connectionA||void 0===o.connectionB){var s=this.getOrthogonalMask(e,function(e){var t=e.block,i=e.relative;if(!t||!t.isRail)return!1;var n=void 0===t.connectionA||t.connectionA===i,o=void 0===t.connectionB||t.connectionB===i;return n||o}),l=n(r[s],2);o.connectionA=l[0],o.connectionB=l[1]}var c=v(o.connectionA)+v(o.connectionB);o.blockType="rails"+a+c,i&&y.getOrthogonalPositions(e).forEach(function(e){t.determineRailType(e)})}}},{key:"determineRedstoneSprite",value:function(e){var t=this.getBlockAt(e);if(t&&t.isRedstone){var i=this.getOrthogonalMask(e,function(e){var t=e.block;return t&&(t.isRedstone||t.isConnectedToRedstone)}),n=g[i],o=t.isPowered?"On":"";return t.blockType="redstoneWire"+n+o,"redstoneWire"+n}}},{key:"refreshRedstone",value:function(){var e=this,t=this.powerRedstone();this.powerAllBlocks();var i=this.powerRails(),n=t.concat(i);return this.getAllPositions().forEach(function(t){e.getIronDoors(t),e.getPistonState(t)}),this.playPistonSound(),n}},{key:"playPistonSound",value:function(){this.levelModel&&(this.playPistonOn?this.levelModel.controller.audioPlayer.play("pistonOut"):this.playPistonOff&&this.levelModel.controller.audioPlayer.play("pistonIn"),this.playPistonOn=!1,this.playPistonOff=!1)}},{key:"checkEntityConflict",value:function(e){var t=this;if(this.levelModel){var i=!1;return this.levelModel.controller.levelEntity.entityMap.forEach(function(n){t.levelModel.controller.positionEquivalence(e,n.position)&&(i=!0)}),i}}},{key:"getIronDoors",value:function(e){e=y.fromArray(e);var t=this.getBlockAt(e),i=this.coordinatesToIndex(e);"doorIron"===t.blockType&&(t.isPowered=this.powerCheck(e,!0),t.isPowered&&!t.isOpen?(t.isOpen=!0,this.levelModel&&this.levelModel.controller.levelView.animateDoor(i,!0)):!t.isPowered&&t.isOpen&&this.levelModel&&(this.checkEntityConflict(e)||(t.isOpen=!1,this.levelModel.controller.levelView.animateDoor(i,!1))))}},{key:"getPistonState",value:function(e){var t=this.getBlockAt(e);t.getIsPiston()&&!t.getIsPistonArm()&&(t.isPowered=this.powerCheck(e,!0),t.isPowered?this.activatePiston(e):t.isPowered||this.deactivatePiston(e),this.levelModel&&(this.levelModel.controller.updateFowPlane(),this.levelModel.controller.updateShadingPlane()))}},{key:"findDoorToAnimate",value:function(e){var t=this;this.getAllPositions().forEach(function(i){var n=t.getBlockAt(i),o=t.coordinatesToIndex(i);"doorIron"===n.blockType&&i!==e&&(n.isPowered=t.powerCheck(i,!0),n.isPowered&&!n.isOpen?(n.isOpen=!0,t.levelModel&&t.levelModel.controller.levelView.animateDoor(o,!0)):n.isPowered||!n.isOpen||t.checkEntityConflict(i)||(n.isOpen=!1,t.levelModel&&t.levelModel.controller.levelView.animateDoor(o,!1)))})}},{key:"activatePiston",value:function(e){var t=this.getBlockAt(e),i=t.blockType;t.getIsStickyPiston()&&(i=i.substring(0,i.length-6)),"On"===i.substring(i.length-2,i.length)&&(i=i.substring(0,i.length-2));var n=t.getPistonDirection(),o="pistonArm"+f(n),r=y.directionToOffsetPosition(n),s=y.forward(e,n),l=this.getBlockAt(s);if(!this.pistonArmBlocked(e,r))if(l.isDestroyableUponPush())this.setBlockAt(s,new a("")),this.playPistonOn=!0,this.levelModel&&this.levelModel.controller.levelView.playExplosionAnimation(s,2,s,l.blockType,null,null,this.player);else if(""===l.blockType||l.getIsPistonArm()){if(""===l.blockType){var c="On";t.getIsStickyPiston()&&(c+="Sticky",o+="Sticky");var h=new a(o),u=new a(i+=c);this.setBlockAt(s,h),this.setBlockAt(e,u),this.playPistonOn=!0}}else{var d=this.getBlocksToPush(s,r),p="On";t.getIsStickyPiston()&&(p+="Sticky");var m=new a(i+=p);this.setBlockAt(e,m),this.pushBlocks(d,r),this.playPistonOn=!0}}},{key:"pistonArmBlocked",value:function(e,t){var i=y.add(e,t);return this.checkEntityConflict(i)}},{key:"deactivatePiston",value:function(e){var t=this.getBlockAt(e);if(t.getIsPiston()&&t.blockType.match("On")){var i=t.getPistonDirection();void 0!==i&&this.retractArm(y.forward(e,i),e)}}},{key:"retractArm",value:function(e,t){var i=new a(""),n=this.getBlockAt(t),o="",r="";this.getBlockAt(t).getIsStickyPiston()?(o="Sticky",r=n.blockType.substring(0,n.blockType.length-8)):r=n.blockType.substring(0,n.blockType.length-2);var s=new a(r+o);if(this.getBlockAt(e).getIsPistonArm())if(this.getBlockAt(t).getIsStickyPiston()){var l=y.directionToOffsetPosition(n.getPistonDirection()),c=y.add(e,l);this.inBounds(c)&&this.getBlockAt(c).isStickable?(this.setBlockAt(e,this.getBlockAt(c)),this.setBlockAt(c,i)):(this.setBlockAt(e,i),this.playPistonOff=!0)}else this.setBlockAt(e,i),this.playPistonOff=!0;this.setBlockAt(t,s)}},{key:"pushBlocks",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0],i="",n=!1;1===t[0]?i="pistonArmRight":-1===t[0]?i="pistonArmLeft":1===t[1]?i="pistonArmDown":-1===t[1]&&(i="pistonArmUp");for(var o=new a(i),r=e.length-1;r>=0;--r){var s=y.add(e[r],y.fromArray(t)),l=this.getBlockAt(e[r]);this.inBounds(s)&&this.getBlockAt(s).isDestroyableUponPush()&&(this.levelModel&&this.levelModel.controller.levelView.playExplosionAnimation(s,2,s,l.blockType,null,null,this.player),n=!0),this.setBlockAt(s,this.getBlockAt(e[r])),0===r&&this.setBlockAt(e[r],o)}n&&this.refreshRedstone()}},{key:"getBlocksToPush",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0],i=[],n=e;this.inBounds(n)&&this.getBlockAt(n).getIsPushable();)i.push(n),n=y.add(n,y.fromArray(t));return i}},{key:"powerCheck",value:function(e){var t=this,i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return y.getOrthogonalPositions(e).some(function(n){var o=t.getBlockAt(n);if(o){if(!o.isWeaklyPowerable)return!1;if(t.getBlockAt(e).getIsPiston()){var a=t.getBlockAt(e),r=y.directionToOffsetPosition(a.getPistonDirection())||new y(0,0),s=y.add(e,r);if(y.equals(n,s))return!1}return i?o.isPowered||o.isRedstoneBattery:o.isRedstone&&o.isPowered||o.isRedstoneBattery}})}},{key:"powerAllBlocks",value:function(){var e=this;this.getAllPositions().forEach(function(t){var i=e.getBlockAt(t);""!==i.blockType&&i.canHoldCharge()&&(i.isPowered=e.powerCheck(t))})}},{key:"updateWeakCharge",value:function(e,t){var i=this;t.isWeaklyPowerable&&(t.isPowered=this.powerCheck(e)),t.isPowered&&y.getOrthogonalPositions(e).forEach(function(e){i.inBounds(e)&&(i.getIronDoors(e),i.getPistonState(e))})}}]),e}()},function(e,t,i){"use strict";var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();function o(e){if(Array.isArray(e)){for(var t=0,i=Array(e.length);t<e.length;t++)i[t]=e[t];return i}return Array.from(e)}var a=i(3);e.exports=function(){function e(t,i){var n=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.comparisonFunction=i||a.isAdjacent,this.sets=[],t&&t.forEach(function(e){n.add(e)})}return n(e,[{key:"flattenSets",value:function(){return this.sets.reduce(function(e,t){return e.concat(t)},[])}},{key:"add",value:function(e){var t=this;if(this.find(e))return!1;var i=this.sets.filter(function(i){return i.some(function(i){return t.comparisonFunction(e,i)})});if(1===i.length)i[0].push(e);else if(i.length>1){var n=[];i.forEach(function(e){t.sets.splice(t.sets.indexOf(e),1),n.push.apply(n,o(e))}),n.push(e),this.sets.push(n)}else this.sets.push([e]);return!0}},{key:"find",value:function(e){return this.sets.find(function(t){return t.some(function(t){return a.equals(e,t)})})}},{key:"remove",value:function(t){var i=this.find(t);if(!i)return!1;this.sets.splice(this.sets.indexOf(i),1);var n=i.filter(function(e){return!a.equals(t,e)});if(n.length){var r,s=new e(n,this.comparisonFunction).sets;(r=this.sets).push.apply(r,o(s))}return!0}}]),e}()},function(e,t,i){"use strict";var n=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var i=[],n=!0,o=!1,a=void 0;try{for(var r,s=e[Symbol.iterator]();!(n=(r=s.next()).done)&&(i.push(r.value),!t||i.length!==t);n=!0);}catch(e){o=!0,a=e}finally{try{!n&&s.return&&s.return()}finally{if(o)throw a}}return i}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),o=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();var a=i(1),r=i(4),s=i(3);e.exports=function(e){function t(e,i,n,o,a,r,s){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var l=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i,"Player",n,o,s));return l.offset=[-18,-32],l.name=a,l.isOnBlock=r,l.inventory={},l.movementState=-1,l.onTracks=!1,l.getOffTrack=!1,e.getIsDirectPlayerControl()?(l.moveDelayMin=0,l.moveDelayMax=0):(l.moveDelayMin=30,l.moveDelayMax=200),l}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a),o(t,[{key:"canPlaceBlockOver",value:function(e,t){var i={canPlace:!1,plane:""};return t.getIsLiquid()?(i.canPlace=!0,i.plane="groundPlane"):(i.canPlace=!0,i.plane="actionPlane"),"cropWheat"===e.blockType&&(i.canPlace="farmlandWet"===t.blockType),i}},{key:"canPlaceBlock",value:function(e){return e.isEmpty}},{key:"shouldUpdateSelectionIndicator",value:function(){return!0}},{key:"setMovePosition",value:function(e){(function e(t,i,n){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,i);if(void 0===o){var a=Object.getPrototypeOf(t);return null===a?void 0:e(a,i,n)}if("value"in o)return o.value;var r=o.get;return void 0!==r?r.call(n):void 0})(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"setMovePosition",this).call(this,e),this.collectItems(this.position)}},{key:"walkableCheck",value:function(e){this.isOnBlock=!e.isWalkable}},{key:"updateMovement",value:function(){var e=this;if(this.controller.attemptRunning&&this.controller.getIsDirectPlayerControl()&&(this.onTracks&&this.collectItems(this.position),this.canUpdateMovement()))if(this.movementState>=0){var t=this.movementState,i=new r(this,function(){},function(){e.lastMovement=+new Date,e.controller.moveDirection(i,t)},this.identifier);this.addCommand(i)}else{var n=new r(this,function(){},function(){e.lastMovement=+new Date,e.controller.use(n)},this.identifier);this.addCommand(n)}}},{key:"canUpdateMovement",value:function(){var e=this.queue.isFinished()||!this.queue.isStarted(),t=-1!==this.movementState,i=this.queue.currentCommand&&0===this.queue.getLength(),n=+new Date-this.lastMovement,o=n>300;return t&&n>800&&(this.getOffTrack=!0),!this.onTracks&&(e||i&&o)&&t}},{key:"doMoveForward",value:function(e){var t,i,n=this,o=this,a=this.controller.levelModel,r=this.controller.levelView,s=o.isOnBlock,l=this.position;a.moveForward(),i=s&&s!==o.isOnBlock,t=o.isOnBlock||i?a.actionPlane.getBlockAt(o.position).blockType:a.groundPlane.getBlockAt(o.position).blockType,r.playMoveForwardAnimation(o,l,o.facing,i,o.isOnBlock,t,function(){r.playIdleAnimation(o.position,o.facing,o.isOnBlock),a.isPlayerStandingInWater()?r.playDrownFailureAnimation(o.position,o.facing,o.isOnBlock,function(){n.controller.handleEndState(!1)}):a.isPlayerStandingInLava()?r.playBurnInLavaAnimation(o.position,o.facing,o.isOnBlock,function(){n.controller.handleEndState(!1)}):n.controller.delayPlayerMoveBy(n.moveDelayMin,n.moveDelayMax,function(){e.succeeded()})}),this.updateHidingTree(),this.updateHidingBlock(l)}},{key:"doMoveBackward",value:function(e){var t,i,n=this,o=this,a=this.controller.levelModel,r=this.controller.levelView,s=o.isOnBlock,l=this.position;a.moveBackward(this),i=s&&s!==o.isOnBlock,t=(o.isOnBlock,a.actionPlane.getBlockAt(o.position).blockType),r.playMoveBackwardAnimation(o,l,o.facing,i,o.isOnBlock,t,function(){r.playIdleAnimation(o.position,o.facing,o.isOnBlock,o),a.isPlayerStandingInWater()?r.playDrownFailureAnimation(o.position,o.facing,o.isOnBlock,function(){n.controller.handleEndState(!1)}):a.isPlayerStandingInLava()?r.playBurnInLavaAnimation(o.position,o.facing,o.isOnBlock,function(){n.controller.handleEndState(!1)}):n.controller.delayPlayerMoveBy(n.moveDelayMin,n.moveDelayMax,function(){e.succeeded()})}),this.updateHidingTree(),this.updateHidingBlock(l)}},{key:"bump",value:function(e){var t=this.controller.levelView,i=this.controller.levelModel;t.playBumpAnimation(this.position,this.facing,!1);var n=this.controller.levelEntity.getEntityAt(i.getMoveForwardPosition(this));if(null!==n&&this.controller.levelEntity.isFriendlyEntity(n.type)){var o=this.facing,a=new r(this,function(){},function(){n.pushBack(a,o,250)},n.identifier);n.queue.startPushHighPriorityCommands(),n.addCommand(a),n.queue.endPushHighPriorityCommands()}this.controller.delayPlayerMoveBy(200,400,function(){e.succeeded()})}},{key:"collectItems",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.position,t=this.controller.levelView.collectibleItems,i=0;i<t.length;i++){var o=n(t[i],4),a=o[0],r=o[1],l=o[2],c=o[3];if(null===a)t.splice(i,1);else{var h=this.controller.levelModel.spritePositionToIndex(r,new s(a.x,a.y));s.absoluteDistanceSquare(e,h)<c&&(this.controller.levelView.playItemAcquireAnimation(this.position,this.facing,a,function(){},l),t.splice(i,1))}}}},{key:"takeDamage",value:function(e){var t=this,i=this.controller.levelView.getDirectionName(this.facing);this.healthPoint--,this.healthPoint>0?(this.controller.levelView.playScaledSpeed(this.sprite.animations,"hurt"+i),e.succeeded()):(this.sprite.animations.stop(null,!0),this.controller.levelView.playFailureAnimation(this.position,this.facing,this.isOnBlock,function(){e.failed(),t.controller.handleEndState(!1)}))}},{key:"canTriggerPressurePlates",value:function(){return!0}}]),t}()},function(e,t,i){"use strict";var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();var o=i(1),a=i(4);e.exports=function(e){function t(e,i,n,o,a,r,s){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var l=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i,"PlayerAgent",n,o,s));return l.offset=[-16,-15],l.name=a,l.isOnBlock=r,l.inventory={},l.movementState=-1,l.moveDelayMin=20,l.moveDelayMax=150,l}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o),n(t,[{key:"canPlaceBlockOver",value:function(e,t){var i={canPlace:!1,plane:""};return t.getIsLiquid()?e.getIsPlaceableInLiquid()&&(i.canPlace=!0,i.plane="groundPlane"):e.isWalkable&&(i.canPlace=!0,i.plane="actionPlane"),i}},{key:"canPlaceBlock",value:function(e){return e.isEmpty}},{key:"canMoveThrough",value:function(){return!0}},{key:"getSortOrderOffset",value:function(){return function e(t,i,n){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,i);if(void 0===o){var a=Object.getPrototypeOf(t);return null===a?void 0:e(a,i,n)}if("value"in o)return o.value;var r=o.get;return void 0!==r?r.call(n):void 0}(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"getSortOrderOffset",this).call(this)-1}},{key:"updateMovement",value:function(){var e=this;if(this.controller.attemptRunning&&this.controller.getIsDirectPlayerControl()){var t=this.queue.isFinished()||!this.queue.isStarted(),i=-1!==this.movementState,n=this.queue.currentCommand&&0===this.queue.getLength(),o=+new Date-this.lastMovement;if((t||n&&o>300)&&i)if(this.movementState>=0){var r=this.movementState,s=new a(this,function(){},function(){e.lastMovement=+new Date,e.controller.moveDirection(s,r)},this.identifier);this.addCommand(s)}else{var l=new a(this,function(){},function(){e.lastMovement=+new Date,e.controller.use(l)},this.identifier);this.addCommand(l)}}}},{key:"doMove",value:function(e,t){var i=this,n=void 0,o=this.controller.levelModel,a=this.controller.levelView,r=this.isOnBlock,s=this.position;o["move"+t](this);var l=r&&r!==this.isOnBlock;n=this.isOnBlock||l?o.actionPlane.getBlockAt(this.position).blockType:o.groundPlane.getBlockAt(this.position).blockType,a["playMove"+t+"Animation"](this,s,this.facing,l,this.isOnBlock,n,function(){a.playIdleAnimation(i.position,i.facing,i.isOnBlock,i),i.controller.delayPlayerMoveBy(i.moveDelayMin,i.moveDelayMax,function(){e.succeeded()})}),this.updateHidingTree(),this.updateHidingBlock(s)}},{key:"doMoveForward",value:function(e){this.doMove(e,"Forward")}},{key:"doMoveBackward",value:function(e){this.doMove(e,"Backward")}},{key:"bump",value:function(e){var t=this.controller.levelView,i=this.controller.levelModel;t.playBumpAnimation(this.position,this.facing,!1,this);var n=this.controller.levelEntity.getEntityAt(i.getMoveForwardPosition(this));if(null!==n&&this.controller.levelEntity.isFriendlyEntity(n.type)){var o=this.facing,r=new a(this,function(){},function(){n.pushBack(r,o,250)},n.identifier);n.queue.startPushHighPriorityCommands(),n.addCommand(r),n.queue.endPushHighPriorityCommands()}this.controller.delayPlayerMoveBy(200,400,function(){e.succeeded()})}},{key:"takeDamage",value:function(e){var t=this,i=this.controller.levelView.getDirectionName(this.facing);this.healthPoint--,this.healthPoint>0?(this.controller.levelView.playScaledSpeed(this.sprite.animations,"hurt"+i),e.succeeded()):(this.sprite.animations.stop(null,!0),this.controller.levelView.playFailureAnimation(this.position,this.facing,this.isOnBlock,function(){e.failed(),t.controller.handleEndState(!1)}))}},{key:"hasPermissionToWalk",value:function(e){return e.isWalkable}},{key:"canTriggerPressurePlates",value:function(){return!0}}]),t}()},function(e,t,i){"use strict";var n=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var i=[],n=!0,o=!1,a=void 0;try{for(var r,s=e[Symbol.iterator]();!(n=(r=s.next()).done)&&(i.push(r.value),!t||i.length!==t);n=!0);}catch(e){o=!0,a=e}finally{try{!n&&s.return&&s.return()}finally{if(o)throw a}}return i}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),o=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();var a=i(8),r=i(2),s=i(3),l=i(18).createEvent,c=i(9).randomInt;e.exports=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.controller=t,this.audioPlayer=t.audioPlayer,this.game=t.game,this.baseShading=null,this.player=null,this.agent=null,this.selectionIndicator=null,this.groundGroup=null,this.shadingGroup=null,this.actionGroup=null,this.fluffGroup=null,this.fowGroup=null,this.collectibleItems=[],this.trees=[],this.miniBlocks={dirt:["Miniblocks",0,5],dirtCoarse:["Miniblocks",6,11],sand:["Miniblocks",12,17],gravel:["Miniblocks",18,23],bricks:["Miniblocks",24,29],logAcacia:["Miniblocks",30,35],logBirch:["Miniblocks",36,41],logJungle:["Miniblocks",42,47],logOak:["Miniblocks",48,53],logSpruce:["Miniblocks",54,59],logSpruceSnowy:["Miniblocks",54,59],planksAcacia:["Miniblocks",60,65],planksBirch:["Miniblocks",66,71],planksJungle:["Miniblocks",72,77],planksOak:["Miniblocks",78,83],planksSpruce:["Miniblocks",84,89],cobblestone:["Miniblocks",90,95],sandstone:["Miniblocks",96,101],wool:["Miniblocks",102,107],redstoneDust:["Miniblocks",108,113],lapisLazuli:["Miniblocks",114,119],ingotIron:["Miniblocks",120,125],ingotGold:["Miniblocks",126,131],emerald:["Miniblocks",132,137],diamond:["Miniblocks",138,143],coal:["Miniblocks",144,149],bucketWater:["Miniblocks",150,155],bucketLava:["Miniblocks",156,161],gunPowder:["Miniblocks",162,167],wheat:["Miniblocks",168,173],potato:["Miniblocks",174,179],carrots:["Miniblocks",180,185],milk:["Miniblocks",186,191],egg:["Miniblocks",192,197],poppy:["Miniblocks",198,203],daisy:["Miniblocks",204,209],dandelion:["Miniblocks",210,215],bed:["Miniblocks",216,221],cactus:["Miniblocks",222,227],clay:["Miniblocks",228,233],deadbush:["Miniblocks",234,239],doorIron:["Miniblocks",240,245],doorOak:["Miniblocks",246,251],glowstoneDust:["Miniblocks",252,257],hardenedClay:["Miniblocks",258,263],hardenedClayBlack:["Miniblocks",264,269],hardenedClayBlue:["Miniblocks",270,275],hardenedClayBrown:["Miniblocks",276,281],hardenedClayCyan:["Miniblocks",282,287],hardenedClayGray:["Miniblocks",288,293],hardenedClayGreen:["Miniblocks",294,299],hardenedClayLightBlue:["Miniblocks",300,305],hardenedClayLime:["Miniblocks",306,311],hardenedClayMagenta:["Miniblocks",312,317],hardenedClayOrange:["Miniblocks",318,323],hardenedClayPink:["Miniblocks",324,329],hardenedClayPurple:["Miniblocks",330,335],hardenedClayRed:["Miniblocks",336,341],hardenedClaySilver:["Miniblocks",342,347],hardenedClayWhite:["Miniblocks",348,353],hardenedClayYellow:["Miniblocks",354,359],netherbrick:["Miniblocks",360,365],netherrack:["Miniblocks",366,371],obsidian:["Miniblocks",372,377],piston:["Miniblocks",378,383],pressurePlateOak:["Miniblocks",384,389],netherQuartz:["Miniblocks",390,395],railGolden:["Miniblocks",396,401],railNormal:["Miniblocks",402,407],redstoneTorch:["Miniblocks",408,413],reeds:["Miniblocks",414,419],seedsWheat:["Miniblocks",420,425],snow:["Miniblocks",426,431],snowBall:["Miniblocks",432,437],woolBlack:["Miniblocks",438,443],woolBlue:["Miniblocks",444,449],woolBrown:["Miniblocks",450,455],woolCyan:["Miniblocks",456,461],woolGray:["Miniblocks",462,467],woolGreen:["Miniblocks",468,473],woolLightBlue:["Miniblocks",474,479],woolLime:["Miniblocks",480,485],woolMagenta:["Miniblocks",486,491],woolOrange:["Miniblocks",492,497],woolPink:["Miniblocks",498,503],woolLPurple:["Miniblocks",504,509],woolRed:["Miniblocks",510,515],woolSilver:["Miniblocks",516,521],woolYellow:["Miniblocks",522,527],bookEnchanted:["Miniblocks",528,533],bucketEmpty:["Miniblocks",534,539],chest:["Miniblocks",540,545],compass:["Miniblocks",546,551],axeDiamond:["Miniblocks",552,557],pickaxeDiamond:["Miniblocks",558,563],shovelDiamond:["Miniblocks",564,569],flintAndSteel:["Miniblocks",570,575],flint:["Miniblocks",576,581],mapEmpty:["Miniblocks",582,587],minecart:["Miniblocks",588,593],potionBottleDrinkable:["Miniblocks",594,599]},this.blocks={bedrock:["blocks","Bedrock",-13,0],bricks:["blocks","Bricks",-13,0],oreCoal:["blocks","Coal_Ore",-13,0],dirtCoarse:["blocks","Coarse_Dirt",-13,0],cobblestone:["blocks","Cobblestone",-13,0],oreDiamond:["blocks","Diamond_Ore",-13,0],dirt:["blocks","Dirt",-13,0],oreEmerald:["blocks","Emerald_Ore",-13,0],farmlandWet:["blocks","Farmland_Wet",-13,0],flowerDandelion:["blocks","Flower_Dandelion",-13,0],flowerOxeeye:["blocks","Flower_Oxeeye",-13,0],flowerRose:["blocks","Flower_Rose",-13,0],glass:["blocks","Glass",-13,0],oreGold:["blocks","Gold_Ore",-13,0],grass:["blocks","Grass",-13,0],gravel:["blocks","Gravel",-13,0],oreIron:["blocks","Iron_Ore",-13,0],oreLapis:["blocks","Lapis_Ore",-13,0],lava:["blocks","Lava_0",-13,0],logAcacia:["blocks","Log_Acacia",-13,0],logBirch:["blocks","Log_Birch",-13,0],logJungle:["blocks","Log_Jungle",-13,0],logOak:["blocks","Log_Oak",-13,0],logSpruce:["blocks","Log_Spruce",-13,0],logSpruceSnowy:["blocks","Log_Spruce",-13,0],obsidian:["blocks","Obsidian",-13,0],planksAcacia:["blocks","Planks_Acacia",-13,0],planksBirch:["blocks","Planks_Birch",-13,0],planksJungle:["blocks","Planks_Jungle",-13,0],planksOak:["blocks","Planks_Oak",-13,0],planksSpruce:["blocks","Planks_Spruce",-13,0],oreRedstone:["blocks","Redstone_Ore",-13,0],sand:["blocks","Sand",-13,0],sandstone:["blocks","Sandstone",-13,0],stone:["blocks","Stone",-13,0],tnt:["tnt","TNTexplosion0",-80,-58],water:["blocks","Water_0",-13,0],wool:["blocks","Wool_White",-13,0],wool_orange:["blocks","Wool_Orange",-13,0],wool_black:["blocks","Wool_Black",-13,0],wool_blue:["blocks","Wool_Blue",-13,0],wool_brown:["blocks","Wool_Brown",-13,0],wool_cyan:["blocks","Wool_Cyan",-13,0],wool_gray:["blocks","Wool_Gray",-13,0],wool_green:["blocks","Wool_Green",-13,0],wool_light_blue:["blocks","Wool_LightBlue",-13,0],wool_lime:["blocks","Wool_Lime",-13,0],wool_magenta:["blocks","Wool_Magenta",-13,0],wool_pink:["blocks","Wool_Pink",-13,0],wool_purple:["blocks","Wool_Purple",-13,0],wool_red:["blocks","Wool_Red",-13,0],wool_silver:["blocks","Wool_Silver",-13,0],wool_yellow:["blocks","Wool_Yellow",-13,0],leavesAcacia:["leavesAcacia","Leaves_Acacia0.png",-100,0],leavesBirch:["leavesBirch","Leaves_Birch0.png",-100,0],leavesJungle:["leavesJungle","Leaves_Jungle0.png",-100,0],leavesOak:["leavesOak","Leaves_Oak0.png",-100,0],leavesSpruce:["leavesSpruce","Leaves_Spruce0.png",-100,0],leavesSpruceSnowy:["leavesSpruceSnowy","Leaves_SpruceSnowy0.png",-100,36],watering:["blocks","Water_0",-13,0],cropWheat:["blocks","Wheat0",-13,0],torch:["torch","Torch0",-13,0],tallGrass:["tallGrass","",-13,0],lavaPop:["lavaPop","LavaPop01",-13,0],redstoneSparkle:["redstoneSparkle","redstone_sparkle1.png",7,23],fire:["fire","",-11,135],bubbles:["bubbles","",-11,135],explosion:["explosion","",-70,60],door:["door","",-12,-15],doorIron:["doorIron","",-12,-15],rails:["blocks","Rails_Vertical",-13,-0],railsNorthEast:["blocks","Rails_BottomLeft",-13,0],railsNorthWest:["blocks","Rails_BottomRight",-13,0],railsEast:["blocks","Rails_Horizontal",-13,0],railsWest:["blocks","Rails_Horizontal",-13,0],railsEastWest:["blocks","Rails_Horizontal",-13,0],railsSouthEast:["blocks","Rails_TopLeft",-13,0],railsSouthWest:["blocks","Rails_TopRight",-13,0],railsNorth:["blocks","Rails_Vertical",-13,-0],railsSouth:["blocks","Rails_Vertical",-13,-0],railsNorthSouth:["blocks","Rails_Vertical",-13,-0],railsUnpowered:["blocks","Rails_UnpoweredVertical",-13,0],railsUnpoweredNorth:["blocks","Rails_UnpoweredVertical",-13,0],railsUnpoweredSouth:["blocks","Rails_UnpoweredVertical",-13,0],railsUnpoweredNorthSouth:["blocks","Rails_UnpoweredVertical",-13,0],railsUnpoweredEast:["blocks","Rails_UnpoweredHorizontal",-13,0],railsUnpoweredWest:["blocks","Rails_UnpoweredHorizontal",-13,0],railsUnpoweredEastWest:["blocks","Rails_UnpoweredHorizontal",-13,0],railsPowered:["blocks","Rails_PoweredVertical",-13,0],railsPoweredNorth:["blocks","Rails_PoweredVertical",-13,0],railsPoweredSouth:["blocks","Rails_PoweredVertical",-13,0],railsPoweredNorthSouth:["blocks","Rails_PoweredVertical",-13,0],railsPoweredEast:["blocks","Rails_PoweredHorizontal",-13,0],railsPoweredWest:["blocks","Rails_PoweredHorizontal",-13,0],railsPoweredEastWest:["blocks","Rails_PoweredHorizontal",-13,0],railsRedstoneTorch:["blocks","Rails_RedstoneTorch",-12,9],redstoneWire:["blocks","redstone_dust_dot_off",-13,0],redstoneWireHorizontal:["blocks","redstone_dust_line_h_off",-13,0],redstoneWireVertical:["blocks","redstone_dust_line_v_off",-13,0],redstoneWireUpRight:["blocks","redstone_dust_corner_BottomLeft_off",-13,0],redstoneWireUpLeft:["blocks","redstone_dust_corner_BottomRight_off",-13,0],redstoneWireDownRight:["blocks","redstone_dust_corner_TopLeft_off",-13,0],redstoneWireDownLeft:["blocks","redstone_dust_corner_TopRight_off",-13,0],redstoneWireTUp:["blocks","redstone_dust_cross_up_off",-13,0],redstoneWireTDown:["blocks","redstone_dust_cross_down_off",-13,0],redstoneWireTLeft:["blocks","redstone_dust_cross_left_off",-13,0],redstoneWireTRight:["blocks","redstone_dust_cross_right_off",-13,0],redstoneWireCross:["blocks","redstone_dust_cross_off",-13,0],redstoneWireOn:["blocks","redstone_dust_dot",-13,0],redstoneWireHorizontalOn:["blocks","redstone_dust_line_h",-13,0],redstoneWireVerticalOn:["blocks","redstone_dust_line_v",-13,0],redstoneWireUpRightOn:["blocks","redstone_dust_corner_BottomLeft",-13,0],redstoneWireUpLeftOn:["blocks","redstone_dust_corner_BottomRight",-13,0],redstoneWireDownRightOn:["blocks","redstone_dust_corner_TopLeft",-13,0],redstoneWireDownLeftOn:["blocks","redstone_dust_corner_TopRight",-13,0],redstoneWireTUpOn:["blocks","redstone_dust_cross_up",-13,0],redstoneWireTDownOn:["blocks","redstone_dust_cross_down",-13,0],redstoneWireTLeftOn:["blocks","redstone_dust_cross_left",-13,0],redstoneWireTRightOn:["blocks","redstone_dust_cross_right",-13,0],redstoneWireCrossOn:["blocks","redstone_dust_cross",-13,0],pressurePlateUp:["blocks","PressurePlate_Up",-13,0],pressurePlateDown:["blocks","PressurePlate_Down",-13,0],pistonUp:["blocks","piston_up",-13,0],pistonDown:["blocks","piston_down",-13,0],pistonLeft:["blocks","piston_left",-13,0],pistonRight:["blocks","piston_right",-13,0],pistonUpOn:["blocks","piston_base_up",-26,-13],pistonDownOn:["blocks","piston_base_down",-26,-13],pistonLeftOn:["blocks","piston_base_left",-26,-13],pistonRightOn:["blocks","piston_base_right",-26,-13],pistonArmLeft:["blocks","piston_arm_left",-26,-13],pistonArmRight:["blocks","piston_arm_right",-26,-13],pistonArmUp:["blocks","piston_arm_up",-26,-13],pistonArmDown:["blocks","piston_arm_down",-26,-13],pistonUpSticky:["blocks","piston_up",-13,0],pistonDownSticky:["blocks","piston_down_sticky",-13,0],pistonLeftSticky:["blocks","piston_left",-13,0],pistonRightSticky:["blocks","piston_right",-13,0],pistonUpOnSticky:["blocks","piston_base_up",-26,-13],pistonDownOnSticky:["blocks","piston_base_down_sticky",-26,-13],pistonLeftOnSticky:["blocks","piston_base_left",-26,-13],pistonRightOnSticky:["blocks","piston_base_right",-26,-13],pistonArmLeftSticky:["blocks","piston_arm_left",-26,-13],pistonArmRightSticky:["blocks","piston_arm_right",-26,-13],pistonArmUpSticky:["blocks","piston_arm_up",-26,-13],pistonArmDownSticky:["blocks","piston_arm_down_sticky",-26,-13],cactus:["blocks","cactus",-13,0],deadBush:["blocks","dead_bush",-13,0],glowstone:["blocks","glowstone",-13,0],grassPath:["blocks","grass_path",-13,0],ice:["blocks","ice",-13,0],netherrack:["blocks","netherrack",-13,0],netherBrick:["blocks","nether_brick",-13,0],quartzOre:["blocks","quartz_ore",-13,0],snow:["blocks","snow",-13,0],snowyGrass:["blocks","snowy_grass",-13,0],topSnow:["blocks","top_snow",-13,0],Nether_Portal:["blocks","Nether_Portal0",0,-58],bedFoot:["blocks","Bed_Foot",-13,0],bedHead:["blocks","Bed_Head",-13,10],clay:["blocks","Clay",-13,0],glassBlack:["blocks","Glass_Black",-13,0],glassBlue:["blocks","Glass_Blue",-13,0],glassBrown:["blocks","Glass_Brown",-13,0],glassCyan:["blocks","Glass_Cyan",-13,0],glassGray:["blocks","Glass_Gray",-13,0],glassGreen:["blocks","Glass_Green",-13,0],glassLightBlue:["blocks","Glass_LightBlue",-13,0],glassLime:["blocks","Glass_Lime",-13,0],glassMagenta:["blocks","Glass_Magenta",-13,0],glassOrange:["blocks","Glass_Orange",-13,0],glassPink:["blocks","Glass_Pink",-13,0],glassPurple:["blocks","Glass_Purple",-13,0],glassRed:["blocks","Glass_Red",-13,0],glassSilver:["blocks","Glass_Silver",-13,0],glassWhite:["blocks","Glass_White",-13,0],glassYellow:["blocks","Glass_Yellow",-13,0],terracotta:["blocks","Terracotta",-13,0],terracottaBlack:["blocks","Terracotta_Black",-13,0],terracottaBlue:["blocks","Terracotta_Blue",-13,0],terracottaBrown:["blocks","Terracotta_Brown",-13,0],terracottaCyan:["blocks","Terracotta_Cyan",-13,0],terracottaGray:["blocks","Terracotta_Gray",-13,0],terracottaGreen:["blocks","Terracotta_Green",-13,0],terracottaLightBlue:["blocks","Terracotta_LightBlue",-13,0],terracottaLime:["blocks","Terracotta_Lime",-13,0],terracottaMagenta:["blocks","Terracotta_Magenta",-13,0],terracottaOrange:["blocks","Terracotta_Orange",-13,0],terracottaPink:["blocks","Terracotta_Pink",-13,0],terracottaPurple:["blocks","Terracotta_Purple",-13,0],terracottaRed:["blocks","Terracotta_Red",-13,0],terracottaSilver:["blocks","Terracotta_Silver",-13,0],terracottaWhite:["blocks","Terracotta_White",-13,0],terracottaYellow:["blocks","Terracotta_Yellow",-13,0],invisible:["blocks","Invisible",0,0]},this.actionPlaneBlocks=[],this.toDestroy=[],this.resettableTweens=[],this.treeFluffTypes={treeAcacia:[[0,0],[-1,0],[1,0],[-1,-1],[0,-1],[1,-1],[-1,-2],[0,-2],[1,-2]],treeBirch:[[0,0],[-1,0],[1,0],[-1,-1],[0,-1],[1,-1],[-1,-2],[0,-2],[1,-2],[0,-3]],treeJungle:[[0,0],[-1,0],[1,0],[-1,-1],[0,-1],[1,-1],[-1,-2],[0,-2],[1,-2],[0,-3],[1,-3]],treeOak:[[0,0],[-1,0],[1,0],[-1,-1],[0,-1],[1,-1],[-1,-2],[0,-2],[0,-3]],treeSpruce:[[0,0],[-1,0],[1,0],[-1,-1],[0,-1],[1,-1],[-1,-2],[0,-2],[1,-2],[0,-3]],treeSpruceSnowy:[[0,0],[-1,0],[1,0],[-1,-1],[0,-1],[1,-1],[-1,-2],[0,-2],[1,-2],[0,-3]]}}return o(e,[{key:"yToIndex",value:function(e){return this.controller.levelModel.yToIndex(e)}},{key:"create",value:function(e){this.createGroups(),this.reset(e)}},{key:"resetEntity",value:function(e){this.preparePlayerSprite(e.name,e),e.sprite.animations.stop(),this.setPlayerPosition(e.position,e.isOnBlock,e),e.shouldUpdateSelectionIndicator()&&(this.setSelectionIndicatorPosition(e.position[0],e.position[1]),this.selectionIndicator.visible=!0),this.playIdleAnimation(e.position,e.facing,e.isOnBlock,e)}},{key:"reset",value:function(e){this.player=e.player,this.agent=e.agent,this.resettableTweens.forEach(function(e){e.stop(!1)}),this.resettableTweens.length=0,this.collectibleItems=[],this.trees=[],this.resetGroups(e),e.usePlayer&&(this.resetEntity(this.player),e.usingAgent&&this.resetEntity(this.agent)),this.updateShadingGroup(e.shadingPlane),this.updateFowGroup(e.fowPlane),this.controller.followingPlayer()?(this.game.world.setBounds(0,0,40*e.planeWidth,40*e.planeHeight),this.game.camera.follow(this.player.sprite),this.game.world.scale.x=1,this.game.world.scale.y=1):this.game.world.setBounds(0,0,400,400)}},{key:"update",value:function(){var e;for(e=0;e<this.toDestroy.length;++e)this.toDestroy[e].destroy();this.toDestroy=[]}},{key:"render",value:function(){this.actionGroup.sort("sortOrder"),this.fluffGroup.sort("z")}},{key:"scaleShowWholeWorld",value:function(e){var t=this.controller.scaleFromOriginal(),i=n(t,2),o=i[0],a=i[1],r=this.addResettableTween(this.game.world.scale).to({x:1/o,y:1/a},1e3,Phaser.Easing.Exponential.Out);this.game.camera.unfollow();var s=this.addResettableTween(this.game.camera).to({x:0,y:0},1e3,Phaser.Easing.Exponential.Out);r.onComplete.addOnce(function(){e()}),s.start(),r.start()}},{key:"getDirectionName",value:function(e){return"_"+r.directionToRelative(e).toLowerCase()}},{key:"updatePlayerDirection",value:function(e,t){var i=this.getDirectionName(t);this.setSelectionIndicatorPosition(e[0],e[1]),this.playScaledSpeed(this.player.sprite.animations,"idle"+i)}},{key:"playDoorAnimation",value:function(e,t,i){var n=this.yToIndex(e[1])+e[0],o=this.actionPlaneBlocks[n],a=t?"open":"close",r=this.playScaledSpeed(o.animations,a);this.onAnimationEnd(r,function(){r.updateCurrentFrame(),i()})}},{key:"playPlayerAnimation",value:function(e,t,i){arguments.length>3&&void 0!==arguments[3]&&arguments[3];var n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.player,o=this.getDirectionName(i);n.sprite.sortOrder=this.yToIndex(t[1])+n.getSortOrderOffset();var a=e+o;return this.playScaledSpeed(n.sprite.animations,a)}},{key:"playIdleAnimation",value:function(e,t,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.player;this.playPlayerAnimation("idle",e,t,i,n)}},{key:"playSuccessAnimation",value:function(e,t,i,n){var o=this,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.player;this.controller.delayBy(250,function(){o.audioPlayer.play("success"),o.onAnimationEnd(o.playPlayerAnimation("celebrate",e,t,i,a),function(){n()})})}},{key:"playFailureAnimation",value:function(e,t,i,n){var o=this,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.player;this.controller.delayBy(500,function(){o.audioPlayer.play("failure"),o.onAnimationEnd(o.playPlayerAnimation("fail",e,t,i,a),function(){o.controller.delayBy(800,n)})})}},{key:"playBumpAnimation",value:function(e,t,i){var n=this,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.player,a=this.playPlayerAnimation("bump",e,t,i,o);return a.onComplete.add(function(){n.playIdleAnimation(e,t,i,o)}),a}},{key:"playDrownFailureAnimation",value:function(e,t,i,o){var a,r;this.playPlayerAnimation("fail",e,t,i),this.createBlock(this.fluffGroup,e[0],e[1],"bubbles"),a=this.fluffGroup.create(0,0,"finishOverlay");var s=this.controller.scaleFromOriginal(),l=n(s,2),c=l[0],h=l[1];a.scale.x=c,a.scale.y=h,a.alpha=0,a.tint=3296255,(r=this.addResettableTween(a).to({alpha:.5},200,Phaser.Easing.Linear.None)).onComplete.add(function(){o()}),r.start()}},{key:"playBurnInLavaAnimation",value:function(e,t,i,o){var a,r;this.playPlayerAnimation("jumpUp",e,t,i),this.createBlock(this.fluffGroup,e[0],e[1],"fire"),a=this.fluffGroup.create(0,0,"finishOverlay");var s=this.controller.scaleFromOriginal(),l=n(s,2),c=l[0],h=l[1];a.scale.x=c,a.scale.y=h,a.alpha=0,a.tint=13719565,(r=this.addResettableTween(a).to({alpha:.5},200,Phaser.Easing.Linear.None)).onComplete.add(function(){o()}),r.start()}},{key:"playDestroyTntAnimation",value:function(e,t,i,n,o,a){var r,s,l=this;if(0!==n.length){for(var c in this.audioPlayer.play("fuse"),n)r=this.actionPlaneBlocks[this.coordinatesToIndex(n[c])],s=this.playScaledSpeed(r.animations,"explode");this.onAnimationEnd(s,function(){l.audioPlayer.play("explode"),a()})}else a()}},{key:"playCreeperExplodeAnimation",value:function(e,t,i,n,o){var a=this;this.controller.delayBy(180,function(){a.playPlayerAnimation("bump",e,t,!1).onComplete.add(function(){a.audioPlayer.play("fuse"),a.playExplodingCreeperAnimation(e,t,i,n,o,a),a.controller.delayBy(200,function(){a.onAnimationLoopOnce(a.playPlayerAnimation("jumpUp",e,t,!1),function(){a.playIdleAnimation(e,t,n)})})})})}},{key:"flashEntity",value:function(e){return this.flashSpriteToWhite(e.sprite)}},{key:"flashBlock",value:function(e){var t=this.yToIndex(e[1])+e[0],i=this.actionPlaneBlocks[t];return this.flashSpriteToWhite(i)}},{key:"flashSpriteToWhite",value:function(e){var t=this.game.add.bitmapData(e.width,e.height);t.fill(255,255,255,255);var i=this.game.add.bitmapData(e.width,e.height),n={x:0,y:0,width:e.width,height:e.height},o={x:0,y:0,width:e.texture.crop.width,height:e.texture.crop.height};i.alphaMask(t,e,n,o);var a=e.addChild(this.game.make.sprite(0,0,i.texture));a.alpha=0;var r=0,s={alpha:1},l={alpha:0},c=this.game.add.tween(a).to(s,60,Phaser.Easing.Linear.None),h=this.game.add.tween(a).to(l,60,Phaser.Easing.Linear.None);r=120,c.chain(h);for(var u=h,d=0;d<2;d++){var p=this.game.add.tween(a).to(l,240,Phaser.Easing.Linear.None),f=this.game.add.tween(a).to(s,60,Phaser.Easing.Linear.None),y=this.game.add.tween(a).to(l,60,Phaser.Easing.Linear.None);r+=360,u.chain(p),p.chain(f),f.chain(y),u=y}return u.onComplete.add(function(){a.destroy()}),c.start(),2*r}},{key:"playExplodingCreeperAnimation",value:function(e,t,i,n,o){var a=this,r=this.yToIndex(i[1])+i[0],s=this.actionPlaneBlocks[r],l=s.animations.getAnimation("explode");l.onComplete.add(function(){s.kill(),a.playExplosionAnimation(e,t,i,n,function(){a.controller.delayBy(100,function(){a.playFailureAnimation(e,t,!1,o)})},!1),a.audioPlayer.play("explode"),a.playExplosionCloudAnimation(i)}),l.play()}},{key:"playExplosionCloudAnimation",value:function(e){this.createBlock(this.fluffGroup,e[0],e[1],"explosion")}},{key:"coordinatesToIndex",value:function(e){return this.yToIndex(e[1])+e[0]}},{key:"playMinecartTurnAnimation",value:function(e,t,i,n,o){var a=t?r.North:r.South;return this.playPlayerAnimation("mineCart_turn"+o,e,a,!1)}},{key:"playMinecartMoveForwardAnimation",value:function(e,t,i,n,o,a){var r;return this.audioPlayer.play("minecart"),this.playPlayerAnimation("mineCart",e,t,!1),(r=this.addResettableTween(this.player.sprite).to(this.positionToScreen(o),a,Phaser.Easing.Linear.None)).start(),this.player.sprite.sortOrder=this.yToIndex(o[1])+10,r}},{key:"playMinecartAnimation",value:function(e,t){var i=this,n=new s(3,2);this.setPlayerPosition(n,e),this.player.facing=2;var o=this.playLevelEndAnimation(n,this.player.facing,e,t,!1);this.game.world.setBounds(0,0,440,400),this.game.camera.follow(this.player.sprite),o.onComplete.add(function(){i.playTrack(n,i.player.facing,e,i.player,t)})}},{key:"playTrack",value:function(e,t,i){var o=this,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.player,l=arguments[4];a.onTracks=!0;var c=this.controller.levelModel.actionPlane.getMinecartTrack(e,t),h=s.forward(a.position,t);if(a.getOffTrack||!c&&!this.isFirstTimeOnRails(e,h))return a.getOffTrack=!1,a.onTracks=!1,void(l&&l());if(void 0===c&&void 0===(c=this.controller.levelModel.actionPlane.getMinecartTrack(h,t)))return a.getOffTrack=!1,a.onTracks=!1,void(l&&l());var u=void 0,d=n(c,4),p=d[0],f=d[1],y=d[2],m=d[3];if(this.player.position=f,"turn"===p.substring(0,4)){u=p.substring(5);var v=t===r.North||y===r.North;this.onAnimationEnd(this.playMinecartTurnAnimation(e,v,i,l,u),function(){o.playTrack(f,y,i,a,l)})}else this.onAnimationEnd(this.playMinecartMoveForwardAnimation(e,t,i,l,f,m),function(){o.playTrack(f,y,i,a,l)})}},{key:"isFirstTimeOnRails",value:function(e,t){var i=this.controller.levelModel.actionPlane.getBlockAt(t),n=this.controller.levelModel.actionPlane.getBlockAt(e);return!(!i||!n||n.isRail||!i.isRail)}},{key:"addHouseBed",value:function(e){var t=e[1]-1;this.actionGroup.create(38*e[0],35*t,"bed").sortOrder=this.yToIndex(e[1])}},{key:"addDoor",value:function(e){var t,i=this.actionPlaneBlocks[this.coordinatesToIndex(e)];this.createActionPlaneBlock(e,"door"),t=this.createBlock(this.groundGroup,e[0],e[1],"wool_orange"),i.kill(),t.sortOrder=this.yToIndex(6)}},{key:"playSuccessHouseBuiltAnimation",value:function(e,t,i,n,o,a,r){var s=this;this.playLevelEndAnimation(e,t,i,function(){s.controller.delayBy(4e3,a)},!0).onComplete.add(function(){var e,t;s.audioPlayer.play("houseSuccess");for(var i=0;i<n.length;++i)e=n[i][1],t=n[i][2],s.createBlock(s.groundGroup,e,t,"wool_orange").sortOrder=s.yToIndex(t);s.addHouseBed(o[0]),s.addDoor(o[1]),s.groundGroup.sort("sortOrder"),r()})}},{key:"playLevelEndAnimation",value:function(e,t,i,o,a){var r,s,l,c=this;r=this.fluffGroup.create(0,0,"finishOverlay");var h=this.controller.scaleFromOriginal(),u=n(h,2),d=u[0],p=u[1];return r.scale.x=d,r.scale.y=p,r.alpha=0,s=this.tweenToWhite(r),l=this.tweenFromWhiteToClear(r),s.onComplete.add(function(){c.selectionIndicator.visible=!1,c.setPlayerPosition(e,i),l.start()}),a&&l.onComplete.add(function(){c.playSuccessAnimation(e,t,i,o)}),s.start(),s}},{key:"tweenFromWhiteToClear",value:function(e){return this.addResettableTween(e).to({alpha:0},700,Phaser.Easing.Linear.None)}},{key:"tweenToWhite",value:function(e){var t;return t=this.addResettableTween(e).to({alpha:1},300,Phaser.Easing.Linear.None),t}},{key:"playBlockSound",value:function(e){var t=e.substring(0,3);"water"!==e&&"lava"!==e&&("stone"===e||"cobblestone"===e||"bedrock"===e||"ore"===t||"bricks"===e?this.audioPlayer.play("stepStone"):"grass"===e||"dirt"===e||"dirtCoarse"===e||"wool_orange"===e||"wool"===e?this.audioPlayer.play("stepGrass"):"gravel"===e?this.audioPlayer.play("stepGravel"):"farmlandWet"===e?this.audioPlayer.play("stepFarmland"):this.audioPlayer.play("stepWood"))}},{key:"playMoveForwardAnimation",value:function(e,t,i,n,o,a,s){var l=e.position[1]+(i===r.North?1:0);this.playWalkAnimation(e,t,i,n,o,a,l,s)}},{key:"playMoveBackwardAnimation",value:function(e,t,i,n,o,a,s){var l=e.position[1]+(i===r.South?1:0);this.playWalkAnimation(e,t,i,n,o,a,l,s)}},{key:"playWalkAnimation",value:function(e,t,i,n,o,a,r,s){var l=this,c=void 0,h=e.position;if(this.playBlockSound(a),e.shouldUpdateSelectionIndicator()&&this.setSelectionIndicatorPosition(h[0],h[1]),n)c=this.playPlayerJumpDownVerticalAnimation(i,h,t);else{var u="walk"+this.getDirectionName(i);this.playScaledSpeed(e.sprite.animations,u),c=this.addResettableTween(e.sprite).to(this.positionToScreen(h,o,e),180,Phaser.Easing.Linear.None)}c.onUpdateCallback(function(t,i){i>=.75&&(e.sprite.sortOrder=l.yToIndex(r)+e.getSortOrderOffset(),t.onUpdateCallback(null))}),c.onComplete.add(function(){s()}),c.start()}},{key:"playPlayerJumpDownVerticalAnimation",value:function(e,t){var i=this,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t,o="jumpDown"+this.getDirectionName(e);this.playScaledSpeed(this.player.sprite.animations,o);var a=this.positionToScreen(n),r=this.positionToScreen(t),s=this.addResettableTween(this.player.sprite).to({x:[a.x,r.x,r.x],y:[a.y,r.y-50,r.y]},300,Phaser.Easing.Linear.None).interpolation(function(e,t){return Phaser.Math.bezierInterpolation(e,t)});return s.onComplete.addOnce(function(){i.audioPlayer.play("fall")}),s.start(),s}},{key:"playPlaceBlockAnimation",value:function(e,t,i,n,o,r){var s,l=this,c=this.yToIndex(e[1])+e[0];if(o.shouldUpdateSelectionIndicator()&&this.setSelectionIndicatorPosition(e[0],e[1]),o===this.agent||a.isWalkable(i))var h=this.playPlayerAnimation("punch",e,t,!1,o).onComplete.add(function(){h.detach(),r()});else{this.audioPlayer.play("placeBlock"),s="jumpUp"+this.getDirectionName(t),""!==n&&this.playExplosionAnimation(e,t,e,n,function(){},!1),this.playScaledSpeed(this.player.sprite.animations,s);var u=this.addResettableTween(this.player.sprite).to({y:40*e[1]-55},125,Phaser.Easing.Cubic.EaseOut);u.onComplete.addOnce(function(){u=null,""!==n&&l.actionPlaneBlocks[c].kill(),r()}),u.start()}}},{key:"playPlaceBlockInFrontAnimation",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.player,t=arguments[1],i=arguments[2],n=arguments[3],o=arguments[4];this.setSelectionIndicatorPosition(n[0],n[1]),this.playPlayerAnimation("punch",t,i,!1,e).onComplete.addOnce(function(){o()})}},{key:"correctForShadowOverlay",value:function(e,t){e.startsWith("piston")&&(t.sortOrder-=.1)}},{key:"createActionPlaneBlock",value:function(e,t){var i=new a(t),n=this.yToIndex(e[1])+e[0];if(this.actionGroup.remove(this.actionPlaneBlocks[n]),this.groundGroup.remove(this.actionPlaneBlocks[n]),i.isEmpty)this.actionPlaneBlocks[n]=null;else{var o=void 0;if(i.getIsMiniblock())o=this.createMiniBlock(e[0],e[1],t,{collectibleDistance:1,xOffsetRange:10,yOffsetRange:10});else{var r=i.shouldRenderOnGroundPlane()?this.groundGroup:this.actionGroup,s=i.shouldRenderOnGroundPlane()?-.5:0;o=this.createBlock(r,e[0],e[1]+s,t)}o&&(o.sortOrder=this.yToIndex(e[1]),this.correctForShadowOverlay(t,o)),this.actionPlaneBlocks[n]=o}}},{key:"playShearAnimation",value:function(e,t,i,n,o){var a=this,r=this.yToIndex(i[1])+i[0],s=this.actionPlaneBlocks[r];s.animations.stop(null,!0),this.onAnimationLoopOnce(this.playScaledSpeed(s.animations,"used"),function(){a.playScaledSpeed(s.animations,"face")}),this.playExplosionAnimation(e,t,i,n,o,!0)}},{key:"playShearSheepAnimation",value:function(e,t,i,n,o){var a=this;this.setSelectionIndicatorPosition(i[0],i[1]),this.onAnimationEnd(this.playPlayerAnimation("punch",e,t,!1),function(){var r=a.yToIndex(i[1])+i[0],s=a.actionPlaneBlocks[r];s.animations.stop(null,!0),a.onAnimationLoopOnce(a.playScaledSpeed(s.animations,"used"),function(){a.playScaledSpeed(s.animations,"face")}),a.playExplosionAnimation(e,t,i,n,o,!0)})}},{key:"destroyBlockWithoutPlayerInteraction",value:function(e){var t=this,i=this.yToIndex(e[1])+e[0],n=this.actionPlaneBlocks[i],o=this.actionGroup.create(40*e[0]-12,40*e[1]-22,"destroyOverlay","destroy1");o.sortOrder=this.yToIndex(e[1])+2,this.onAnimationEnd(o.animations.add("destroy",Phaser.Animation.generateFrameNames("destroy",1,12,"",0),30,!1),function(){t.actionPlaneBlocks[i]=null,n.hasOwnProperty("onBlockDestroy")&&n.onBlockDestroy(n),n.kill(),o.kill(),t.toDestroy.push(n),t.toDestroy.push(o),t.audioPlayer.play("dig_wood1")}),this.playScaledSpeed(o.animations,"destroy")}},{key:"playDestroyBlockAnimation",value:function(e,t,i,n,o,a){o.shouldUpdateSelectionIndicator()&&this.setSelectionIndicatorPosition(i[0],i[1]);var r=void 0;r=o===this.agent?"punchDestroy":n.match(/(ore|stone|clay|bricks|bedrock)/)?"mine":"punchDestroy",this.playPlayerAnimation(r,e,t,!1,o),this.playMiningParticlesAnimation(t,i),this.playBlockDestroyOverlayAnimation(e,t,i,n,o,a)}},{key:"playPunchDestroyAirAnimation",value:function(e,t,i,n){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.player;this.playPunchAnimation(e,t,i,"punchDestroy",n,o)}},{key:"playPunchAirAnimation",value:function(e,t,i,n){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.player;this.playPunchAnimation(e,t,i,"punch",n,o)}},{key:"playPunchAnimation",value:function(e,t,i,n,o){var a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:this.player;a.shouldUpdateSelectionIndicator()&&this.setSelectionIndicatorPosition(i[0],i[1]),this.onAnimationEnd(this.playPlayerAnimation(n,e,t,!1,a),function(){o()})}},{key:"playBlockDestroyOverlayAnimation",value:function(e,t,i,n,o,r){var s=this,l=this.yToIndex(i[1])+i[0],c=this.actionPlaneBlocks[l],h=function(){c.hasOwnProperty("onBlockDestroy")&&c.onBlockDestroy(c),s.controller.levelModel.destroyBlockForward(o),s.controller.updateShadingPlane(),s.controller.updateFowPlane(),o.shouldUpdateSelectionIndicator()&&s.setSelectionIndicatorPosition(e[0],e[1]),s.audioPlayer.play("dig_wood1"),s.playExplosionAnimation(e,t,i,n,r,!0,o)};if(a.skipsDestructionOverlay(n))h();else{var u=this.actionGroup.create(40*i[0]-12,40*i[1]-22,"destroyOverlay","destroy1");if(a.isFlat(n)){var d=new Phaser.Rectangle(0,0,60,40);u.position.y+=20,u.crop(d)}u.sortOrder=this.yToIndex(i[1])+2,this.onAnimationEnd(u.animations.add("destroy",Phaser.Animation.generateFrameNames("destroy",1,12,"",0),30,!1),function(){u.kill(),s.toDestroy.push(u),h()}),this.playScaledSpeed(u.animations,"destroy")}}},{key:"playMiningParticlesAnimation",value:function(e,t){var i=this,n=[[24,-100,-80],[12,-120,-80],[0,-60,-80],[36,-80,-60]],o=this.getDirectionName(e),a="_left"===o?0:"_bottom"===o?1:"_right"===o?2:3,r=n[a][0],s=n[a][1],l=n[a][2],c=this.actionGroup.create(s+40*t[0],l+40*t[1],"miningParticles","MiningParticles"+r);c.sortOrder=this.yToIndex(t[1])+2,this.onAnimationEnd(c.animations.add("miningParticles",Phaser.Animation.generateFrameNames("MiningParticles",r,r+11,"",0),30,!1),function(){c.kill(),i.toDestroy.push(c)}),this.playScaledSpeed(c.animations,"miningParticles")}},{key:"playExplosionAnimation",value:function(e,t,i,n,o,a){var r=this,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:this.player,l=this.actionGroup.create(40*i[0]-36,40*i[1]-30,"blockExplode","BlockBreakParticle0");switch(n){case"treeAcacia":case"logAcacia":l.tint=7103834;break;case"treeBirch":case"logBirch":l.tint=14341836;break;case"treeJungle":case"logJungle":l.tint=6967089;break;case"treeOak":case"logOak":l.tint=6771249;break;case"treeSpruce":case"logSpruce":l.tint=4929827;break;case"planksAcacia":l.tint=12215095;break;case"planksBirch":l.tint=14142349;break;case"planksJungle":l.tint=12093284;break;case"planksOak":l.tint=11833434;break;case"planksSpruce":l.tint=8412726;break;case"stone":case"oreCoal":case"oreDiamond":case"oreIron":case"oreGold":case"oreEmerald":case"oreRedstone":l.tint=13027014;break;case"grass":case"cropWheat":l.tint=6131491;break;case"dirt":l.tint=9068083;break;case"redstoneWireOn":case"redstoneWireHorizontalOn":case"redstoneWireVerticalOn":case"redstoneWireUpRightOn":case"redstoneWireUpLeftOn":case"redstoneWireDownRightOn":case"redstoneWireDownLeftOn":case"redstoneWireTUpOn":case"redstoneWireTDownOn":case"redstoneWireTLeftOn":case"redstoneWireTRightOn":case"redstoneWireCrossOn":l.tint=10028807;break;case"redstoneWire":case"redstoneWireHorizontal":case"redstoneWireVertical":case"redstoneWireUpRight":case"redstoneWireUpLeft":case"redstoneWireDownRight":case"redstoneWireDownLeft":case"redstoneWireTUp":case"redstoneWireTDown":case"redstoneWireTLeft":case"redstoneWireTRight":case"redstoneWireCross":l.tint=2687490}l.sortOrder=this.yToIndex(i[1])+2,this.onAnimationEnd(l.animations.add("explode",Phaser.Animation.generateFrameNames("BlockBreakParticle",0,7,"",0),30,!1),function(){l.kill(),r.toDestroy.push(l),a&&(r.controller.getIsDirectPlayerControl()||r.playPlayerAnimation("idle",e,t,!1,s),null!==o&&r.playItemDropAnimation(i,n,o))}),this.playScaledSpeed(l.animations,"explode"),this.controller.getIsDirectPlayerControl()^!a&&o&&o()}},{key:"playItemDropAnimation",value:function(e,t,i){var n=this,o=this.createMiniBlock(e[0],e[1],t);o&&(o.sortOrder=this.yToIndex(e[1])+2),this.controller.getIsDirectPlayerControl()?i&&i():this.onAnimationEnd(this.playScaledSpeed(o.animations,"animate"),function(){var e=n.controller.levelModel.player;n.playItemAcquireAnimation(e.position,e.facing,o,i,t)})}},{key:"playScaledSpeed",value:function(e,t){var i=e.getAnimation(t);if(null!==i){i.originalFps||(i.originalFps=1e3/i.delay);var n=this.controller.originalFpsToScaled(i.originalFps);return e.play(t,n)}console.log("can't find animation name : "+t)}},{key:"playItemAcquireAnimation",value:function(e,t,i,n,o){var a,r=this;(a=this.addResettableTween(i).to(this.positionToScreen(e),200,Phaser.Easing.Linear.None)).onComplete.add(function(){var t=s.equals(r.player.position,e);if(i.alive&&t){r.audioPlayer.play("collectedBlock"),r.player.inventory[o]=(r.player.inventory[o]||0)+1,i.kill(),r.toDestroy.push(i);var a=l("craftCollectibleCollected");a.blockType=o,window.dispatchEvent(a),n&&n()}else r.playItemAcquireAnimation(r.player.position,r.player.facing,i,n,o)}),a.start()}},{key:"positionToScreen",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.player,n=e[0],o=e[1];return{x:i.offset[0]+40*n,y:i.offset[1]+(t?-23:0)+40*o}}},{key:"setPlayerPosition",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.player,n=this.positionToScreen(e,t,i);i.sprite.x=n.x,i.sprite.y=n.y,i.sprite.sortOrder=this.yToIndex(n.y)+i.getSortOrderOffset()}},{key:"setSelectionIndicatorPosition",value:function(e,t){this.selectionIndicator.x=40*e-12,this.selectionIndicator.y=40*t-12}},{key:"drawHintPath",value:function(e){this.hintGroup.removeAll(!0);var t=this.game.world.bounds,i=this.game.add.bitmapData(t.width,t.height),o=i.context;o.setLineDash([10,10]),o.lineDashOffset=5,o.lineWidth=2,o.strokeStyle="#fff",o.shadowColor="#000",o.shadowOffsetY=7,o.shadowBlur=4,o.beginPath(),e.forEach(function(e){var t=n(e,2),i=t[0],a=t[1];o.lineTo(40*i+19,40*a+19)}),o.stroke();var a=this.hintGroup.create(0,0,i);a.alpha=0,this.addResettableTween(a).to({alpha:1},830,Phaser.Easing.Quadratic.Out).to({alpha:.4},500,Phaser.Easing.Quadratic.InOut,!0,0,-1,!0)}},{key:"createGroups",value:function(){this.groundGroup=this.game.add.group(),this.groundGroup.yOffset=-2,this.shadingGroup=this.game.add.group(),this.shadingGroup.yOffset=-2,this.hintGroup=this.game.add.group(),this.actionGroup=this.game.add.group(),this.actionGroup.yOffset=-22,this.fluffGroup=this.game.add.group(),this.fluffGroup.yOffset=-160,this.fowGroup=this.game.add.group(),this.fowGroup.yOffset=0}},{key:"resetGroups",value:function(e){var t,i,n;for(this.groundGroup.removeAll(!0),this.actionGroup.removeAll(!0),this.hintGroup.removeAll(!0),this.fluffGroup.removeAll(!0),this.shadingGroup.removeAll(!0),this.fowGroup.removeAll(!0),this.baseShading=this.game.add.group(),this.actionPlaneBlocks=[],this.refreshGroundGroup(),n=0;n<this.controller.levelModel.planeHeight;++n)for(i=0;i<this.controller.levelModel.planeWidth;++i){var o=new s(i,n);t=null;var a=e.groundDecorationPlane.getBlockAt(o);a.isEmpty||(t=this.createBlock(this.actionGroup,i,n,a.blockType))&&(t.sortOrder=this.yToIndex(n));var r=e.actionPlane.getBlockAt(o);r.shouldRenderOnGroundPlane()||this.createActionPlaneBlock(o,r.blockType)}for(n=0;n<this.controller.levelModel.planeHeight;++n)for(i=0;i<this.controller.levelModel.planeWidth;++i){var l=new s(i,n);e.fluffPlane.getBlockAt(l).isEmpty||(t=this.createBlock(this.fluffGroup,i,n,e.fluffPlane.getBlockAt(l).blockType))}}},{key:"refreshGroundGroup",value:function(){this.groundGroup.removeAll(!0);for(var e=0;e<this.controller.levelModel.planeHeight;++e)for(var t=0;t<this.controller.levelModel.planeWidth;++t){var i=new s(t,e),n=this.controller.levelModel.groundPlane.getBlockAt(i),o=this.createBlock(this.groundGroup,t,e,n.blockType);o&&(o.sortOrder=this.yToIndex(e));var a=this.controller.levelModel.actionPlane.getBlockAt(i);a&&a.shouldRenderOnGroundPlane()&&this.createActionPlaneBlock(i,a.blockType)}}},{key:"refreshActionGroup",value:function(e){for(var t=this,i=0;i<e.length;++i){var n=s.south(e[i]);if(this.controller.levelModel.actionPlane.inBounds(n))""===this.controller.levelModel.actionPlane.getBlockAt(n).blockType||e.push(n)}e.forEach(function(e){if(e){var i=t.controller.levelModel.actionPlane.getBlockAt(e);if(i&&i.getIsDoor())return;if(i&&i.getIsMiniblock()||i&&i.getIsTree())return;if(i&&i.blockType)t.createActionPlaneBlock(e,i.blockType);else if(i){var n=t.coordinatesToIndex(e);t.actionGroup.remove(t.actionPlaneBlocks[n]),t.groundGroup.remove(t.actionPlaneBlocks[n])}}})}},{key:"updateShadingGroup",value:function(e){var t,i,n,o,a;for(this.shadingGroup.removeAll(),this.shadingGroup.add(this.baseShading),this.selectionIndicator&&this.shadingGroup.add(this.selectionIndicator),t=0;t<e.length;++t){a=(i=e[t]).atlas,n=40*i.x,o=40*i.y;var r=this.shadingGroup.create(n,o,a,i.type);"WaterAO"===a&&(r.tint=5592405)}}},{key:"updateFowGroup",value:function(e){var t,i,n,o;for(this.fowGroup.removeAll(),t=0;t<e.length;++t){var a=e[t];if(""!==a)o="undergroundFow",i=40*a.x-40,n=40*a.y-40,a.type,this.fowGroup.create(i,n,o,a.type).alpha=.8}}},{key:"playRandomPlayerIdle",value:function(e){var t,i,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.player;switch(t=this.getDirectionName(e),Math.trunc(4*Math.random())+1){case 1:i="idle";break;case 2:i="lookLeft";break;case 3:i="lookRight";break;case 4:i="lookAtCam"}i+=t,this.playScaledSpeed(n.sprite.animations,i)}},{key:"generatePlayerCelebrateFrames",value:function(){for(var e=[],t=0;t<6;++t)e.push("Player_001");return(e=(e=e.concat("Player_259")).concat("Player_260")).push("Player_261"),e.push("Player_297"),e.push("Player_298"),e.push("Player_297"),e.push("Player_261"),e.push("Player_261"),e.push("Player_297"),e.push("Player_298"),e.push("Player_297"),e.push("Player_261"),e.push("Player_001"),e.push("Player_001"),e.push("Player_001"),e.push("Player_001"),e.push("Player_001"),e.push("Player_261"),e.push("Player_297"),e.push("Player_298"),e.push("Player_297"),e.push("Player_261"),e.push("Player_261"),e.push("Player_297"),e.push("Player_298"),e.push("Player_297"),e.push("Player_261"),e}},{key:"generateFramesWithEndDelay",value:function(e,t,i,n,o,a){for(var r=Phaser.Animation.generateFrameNames(e,t,i,"",o),s=0;s<a;++s)r.push(n);return r}},{key:"generateReverseFrames",value:function(e,t,i,n,o){return Phaser.Animation.generateFrameNames(e,t,i,n,o).concat(Phaser.Animation.generateFrameNames(e,i-1,t,n,o))}},{key:"preparePlayerSprite",value:function(e){var t=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.player;i.sprite=this.actionGroup.create(0,0,"player"+e,"Player_121"),this.controller.followingPlayer()&&i===this.player&&this.game.camera.follow(i.sprite),i.shouldUpdateSelectionIndicator()&&(this.selectionIndicator=this.shadingGroup.create(24,44,"selectionIndicator")),this.generateAnimations(r.South,0,i),this.generateAnimations(r.East,60,i),this.generateAnimations(r.North,120,i),this.generateAnimations(r.West,180,i);var n=void 0;(n=this.generateFramesWithEndDelay("Player_",263,262,"Player_262",3,5)).push("Player_263"),i.sprite.animations.add("lookAtCam_down",n,10,!1).onComplete.add(function(){t.playScaledSpeed(i.sprite.animations,"idlePause_down")}),(n=this.generateFramesWithEndDelay("Player_",270,269,"Player_269",3,5)).push("Player_270"),i.sprite.animations.add("lookAtCam_right",n,10,!1).onComplete.add(function(){t.playScaledSpeed(i.sprite.animations,"idlePause_right")}),(n=this.generateFramesWithEndDelay("Player_",277,276,"Player_276",3,5)).push("Player_277"),i.sprite.animations.add("lookAtCam_up",n,10,!1).onComplete.add(function(){t.playScaledSpeed(i.sprite.animations,"idlePause_up")}),(n=this.generateFramesWithEndDelay("Player_",284,283,"Player_283",3,5)).push("Player_284"),i.sprite.animations.add("lookAtCam_left",n,10,!1).onComplete.add(function(){t.playScaledSpeed(i.sprite.animations,"idlePause_left")}),i.sprite.animations.add("mine_down",Phaser.Animation.generateFrameNames("Player_",241,244,"",3),20,!0),i.sprite.animations.add("mine_right",Phaser.Animation.generateFrameNames("Player_",245,248,"",3),20,!0),i.sprite.animations.add("mine_up",Phaser.Animation.generateFrameNames("Player_",249,252,"",3),20,!0),i.sprite.animations.add("mine_left",Phaser.Animation.generateFrameNames("Player_",253,256,"",3),20,!0),i.sprite.animations.add("mineCart_down",Phaser.Animation.generateFrameNames("Minecart_",5,5,"",2),20,!1),i.sprite.animations.add("mineCart_turnleft_down",Phaser.Animation.generateFrameNames("Minecart_",6,6,"",2),20,!1),i.sprite.animations.add("mineCart_turnright_down",Phaser.Animation.generateFrameNames("Minecart_",12,12,"",2),20,!1),i.sprite.animations.add("mineCart_right",Phaser.Animation.generateFrameNames("Minecart_",7,7,"",2),20,!1),i.sprite.animations.add("mineCart_left",Phaser.Animation.generateFrameNames("Minecart_",11,11,"",2),20,!1),i.sprite.animations.add("mineCart_up",Phaser.Animation.generateFrameNames("Minecart_",9,9,"",2),20,!1),i.sprite.animations.add("mineCart_turnleft_up",Phaser.Animation.generateFrameNames("Minecart_",10,10,"",2),20,!1),i.sprite.animations.add("mineCart_turnright_up",Phaser.Animation.generateFrameNames("Minecart_",8,8,"",2),20,!1)}},{key:"playerFrameName",value:function(e){return Phaser.Animation.generateFrameNames("Player_",e,e,"",3)}},{key:"generateAnimations",value:function(e,t){var i=this,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.player,o=this.getDirectionName(e),a=[];a.push(this.playerFrameName(t+1)),a.push(this.playerFrameName(t+3)),a.push(this.playerFrameName(t+1)),a.push(this.playerFrameName(t+7)),a.push(this.playerFrameName(t+9)),a.push(this.playerFrameName(t+7));for(var r=0;r<5;++r)a.push(this.playerFrameName(t+1));n.sprite.animations.add("idle"+o,a,20/3,!1).onComplete.add(function(){i.playRandomPlayerIdle(e,n)}),(a=this.generateFramesWithEndDelay("Player_",t+6,t+5,this.playerFrameName(t+5),3,5)).push(this.playerFrameName(t+6)),n.sprite.animations.add("lookLeft"+o,a,10,!1).onComplete.add(function(){i.playScaledSpeed(n.sprite.animations,"idlePause"+o)}),(a=this.generateFramesWithEndDelay("Player_",t+12,t+11,this.playerFrameName(t+11),3,5)).push(this.playerFrameName(t+12)),n.sprite.animations.add("lookRight"+o,a,10,!1).onComplete.add(function(){i.playScaledSpeed(n.sprite.animations,"idlePause"+o)}),a=[];for(var s=0;s<13;++s)a.push(this.playerFrameName(t+1));n.sprite.animations.add("idlePause"+o,a,20/3,!1).onComplete.add(function(){i.playRandomPlayerIdle(e,n)}),n.sprite.animations.add("walk"+o,Phaser.Animation.generateFrameNames("Player_",t+13,t+20,"",3),20,!0);var l=Phaser.Animation.generateFrameNames("Player_",t+21,t+24,"",3);n.sprite.animations.add("punch"+o,l,20,!1).onComplete.add(function(){i.audioPlayer.play("punch")}),n.sprite.animations.add("punchDestroy"+o,l.concat(l).concat(l),20,!1),n.sprite.animations.add("hurt"+o,Phaser.Animation.generateFrameNames("Player_",t+25,t+28,"",3),20,!1).onComplete.add(function(){i.playScaledSpeed(n.sprite.animations,"idlePause"+o)}),n.sprite.animations.add("crouch"+o,Phaser.Animation.generateFrameNames("Player_",t+29,t+32,"",3),20,!0),n.sprite.animations.add("jumpUp"+o,Phaser.Animation.generateFrameNames("Player_",t+33,t+36,"",3),10,!0),n.sprite.animations.add("fail"+o,Phaser.Animation.generateFrameNames("Player_",t+45,t+48,"",3),20,!1),n.sprite.animations.add("celebrate"+o,this.generatePlayerCelebrateFrames(),10,!1),n.sprite.animations.add("bump"+o,Phaser.Animation.generateFrameNames("Player_",t+49,t+54,"",3),20,!1).onStart.add(function(){i.audioPlayer.play("bump")}),n.sprite.animations.add("jumpDown"+o,Phaser.Animation.generateFrameNames("Player_",t+55,t+60,"",3),20,!0)}},{key:"createMiniBlock",value:function(e,t,i){var n,o=this,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},l=null,c=r.collectibleDistance||2,h=r.xOffsetRange||40,u=r.yOffsetRange||40,d=a.getMiniblockFrame(i);if(!d||!this.miniBlocks[d])return l;var p=this.miniBlocks[d][0],f=this.miniBlocks[d][1],y=this.miniBlocks[d][2],m=-10-h/2+Math.random()*h,v=0-u/2+Math.random()*u+this.actionGroup.yOffset,g=new s(m,v);n=Phaser.Animation.generateFrameNames(p,f,y,".png",3);var k=(l=this.actionGroup.create(m+40*e,v+40*t,"miniBlocks","")).animations.add("animate",n,10,!1);if(this.controller.getIsDirectPlayerControl()){var b=this.controller.levelModel.spritePositionToIndex(g,new s(l.x,l.y));this.collectibleItems.push([l,g,i,c]),k.onComplete.add(function(){o.controller.levelModel.usePlayer&&function(e,t){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))}(o.player.position,b)<c&&o.player.collectItems(new s(e,t))})}return this.playScaledSpeed(l.animations,"animate"),l}},{key:"playAnimationWithOffset",value:function(e,t,i,n){var o=Math.trunc(Math.random()*i)+n;this.playScaledSpeed(e.animations,t).setFrame(o,!0)}},{key:"psuedoRandomTint",value:function(e,t,i,n){var o=Math.pow(10*i+n,5)%251/12;e===this.groundGroup?o+=24:o*=.75;var a=Math.floor(255-o).toString(16);t.tint="0x"+a+a+a}},{key:"createBlock",value:function(e,t,i,n){var o,r,l,c,h,u,d=this,p=new s(t,i),f=null,y=function(o,a){var r=n.substring(4);(f=o.createBlock(e,t,i,"log"+r)).fluff=o.createBlock(o.fluffGroup,t,i,"leaves"+r),f.onBlockDestroy=function(e){e.fluff.animations.add("despawn",Phaser.Animation.generateFrameNames("Leaves_"+r,a[0],a[1],".png",0),10,!1).onComplete.add(function(){o.toDestroy.push(e.fluff),e.fluff.kill()}),o.playScaledSpeed(e.fluff.animations,"despawn")},o.trees.push({sprite:f,type:n,position:p})},m=function(o,a){l=d.blocks[n][0],c=d.blocks[n][1],h=d.blocks[n][2],u=d.blocks[n][3],f=e.create(h+40*t,u+e.yOffset+40*i,l,c),r=[];for(var s=Phaser.Animation.generateFrameNames(a,0,3,"",1),p=0;p<5;++p)r.push(a+"0");r=r.concat(s),f.animations.add("open",r),r=[],s=Phaser.Animation.generateFrameNames(a,3,0,"",1);for(var y=0;y<5;++y)r.push(a+"3");return r=r.concat(s),f.animations.add("close",r),f};switch(n){case"treeAcacia":y(this,[0,7]);break;case"treeBirch":y(this,[0,8]);break;case"treeJungle":y(this,[0,9]);break;case"treeOak":y(this,[0,6]);break;case"treeSpruce":case"treeSpruceSnowy":y(this,[0,8]);break;case"cropWheat":l=this.blocks[n][0],c=this.blocks[n][1],h=this.blocks[n][2],u=this.blocks[n][3],f=e.create(h+40*t,u+e.yOffset+40*i,l,c),r=Phaser.Animation.generateFrameNames("Wheat",0,2,"",0),f.animations.add("idle",r,.4,!1),this.playScaledSpeed(f.animations,"idle");break;case"torch":l=this.blocks[n][0],c=this.blocks[n][1],h=this.blocks[n][2],u=this.blocks[n][3],f=e.create(h+40*t,u+e.yOffset+40*i,l,c),r=Phaser.Animation.generateFrameNames("Torch",0,23,"",0),f.animations.add("idle",r,15,!0),this.playScaledSpeed(f.animations,"idle");break;case"water":l=this.blocks[n][0],c=this.blocks[n][1],h=this.blocks[n][2],u=this.blocks[n][3],f=e.create(h+40*t,u+e.yOffset+40*i,l,c),r=Phaser.Animation.generateFrameNames("Water_",0,5,"",0),f.animations.add("idle",r,5,!0),this.playScaledSpeed(f.animations,"idle");break;case"watering":l=this.blocks[n][0],c=this.blocks[n][1],h=this.blocks[n][2],u=this.blocks[n][3],(f=e.create(h+40*t,u+e.yOffset+40*i,l,c)).kill(),this.toDestroy.push(f),this.createBlock(this.groundGroup,t,i,"farmlandWet"),this.refreshGroundGroup();break;case"lava":l=this.blocks[n][0],c=this.blocks[n][1],h=this.blocks[n][2],u=this.blocks[n][3],f=e.create(h+40*t,u+e.yOffset+40*i,l,c),r=Phaser.Animation.generateFrameNames("Lava_",0,5,"",0),f.animations.add("idle",r,5,!0),this.playScaledSpeed(f.animations,"idle");break;case"Nether_Portal":l=this.blocks[n][0],c=this.blocks[n][1],h=this.blocks[n][2],u=this.blocks[n][3],f=e.create(h+40*t,u+e.yOffset+40*i,l,c),r=Phaser.Animation.generateFrameNames("Nether_Portal",0,5,"",0),f.animations.add("idle",r,5,!0),this.playScaledSpeed(f.animations,"idle");break;case"lavaPop":for(l=this.blocks[n][0],c=this.blocks[n][1],h=this.blocks[n][2],u=this.blocks[n][3],f=e.create(h+40*t,u+e.yOffset+40*i,l,c),r=Phaser.Animation.generateFrameNames("LavaPop",1,7,"",2),o=0;o<4;++o)r.push("LavaPop07");for(r=r.concat(Phaser.Animation.generateFrameNames("LavaPop",8,13,"",2)),o=0;o<3;++o)r.push("LavaPop13");for(r=r.concat(Phaser.Animation.generateFrameNames("LavaPop",14,30,"",2)),o=0;o<8;++o)r.push("LavaPop01");f.animations.add("idle",r,5,!0),this.playAnimationWithOffset(f,"idle",29,1);break;case"fire":l=this.blocks[n][0],c=this.blocks[n][1],h=this.blocks[n][2],u=this.blocks[n][3],f=e.create(h+40*t,u+e.yOffset+40*i,l,c),r=Phaser.Animation.generateFrameNames("Fire",0,14,"",2),f.animations.add("idle",r,5,!0),this.playScaledSpeed(f.animations,"idle");break;case"bubbles":l=this.blocks[n][0],c=this.blocks[n][1],h=this.blocks[n][2],u=this.blocks[n][3],f=e.create(h+40*t,u+e.yOffset+40*i,l,c),r=Phaser.Animation.generateFrameNames("Bubbles",0,14,"",2),f.animations.add("idle",r,5,!0),this.playScaledSpeed(f.animations,"idle");break;case"explosion":l=this.blocks[n][0],c=this.blocks[n][1],h=this.blocks[n][2],u=this.blocks[n][3],f=e.create(h+40*t,u+e.yOffset+40*i,l,c),r=Phaser.Animation.generateFrameNames("Explosion",0,16,"",1),f.animations.add("idle",r,15,!1).onComplete.add(function(){d.toDestroy.push(f),f.kill()}),this.playScaledSpeed(f.animations,"idle");break;case"door":f=m(0,"Door");break;case"doorIron":f=m(0,"DoorIron"),this.blockReceivesCornerShadow(t,i)&&f.addChild(this.game.make.sprite(-40,55,"blockShadows","Shadow_Parts_Fade_overlap.png"));break;case"tnt":l=this.blocks[n][0],c=this.blocks[n][1],h=this.blocks[n][2],u=this.blocks[n][3],f=e.create(h+40*t,u+e.yOffset+40*i,l,c),r=Phaser.Animation.generateFrameNames("TNTexplosion",0,8,"",0),f.animations.add("explode",r,7,!1).onComplete.add(function(){d.playExplosionCloudAnimation(p),f.kill(),d.toDestroy.push(f),d.actionPlaneBlocks[d.coordinatesToIndex(p)]=null});break;default:if(l=this.blocks[n][0],c=this.blocks[n][1],h=this.blocks[n][2],u=this.blocks[n][3],f=e.create(h+40*t,u+e.yOffset+40*i,l,c),e!==this.actionGroup&&e!==this.groundGroup||a.isWalkable(n)||this.psuedoRandomTint(e,f,t,i),e===this.actionGroup&&!a.isWalkable(n)&&this.blockReceivesCornerShadow(t,i)){var v=-39,g=40;n.startsWith("pistonArm")&&(v=-26,g=53),f.addChild(this.game.make.sprite(v,g,"blockShadows","Shadow_Parts_Fade_overlap.png"))}n.startsWith("redstoneWire")&&n.endsWith("On")&&f.addChild(this.addRedstoneSparkle())}return f}},{key:"addRedstoneSparkle",value:function(){for(var e=this,t="redstone_sparkle99.png",i=this.game.make.sprite(20,25,"redstoneSparkle",t),n=0;n<3;n++){var o=8*n,a=[t].concat(Phaser.Animation.generateFrameNames("redstone_sparkle",o,o+7,".png"),t);i.animations.add("fizz_"+n,a,7)}return function t(){setTimeout(function(){if(i.alive){var n=Math.floor(3*Math.random());e.onAnimationEnd(e.playScaledSpeed(i.animations,"fizz_"+n),t),i.position.x=Math.random()>.5?20:40,i.position.y=Math.random()>.5?25:45}},c(500,7e3)/e.controller.tweenTimeScale)}(),i}},{key:"blockReceivesCornerShadow",value:function(e,t){var i=this.controller.levelModel.actionPlane.getBlockAt([e,t+1]);if(!i||i.blockType&&!i.isWalkable)return!1;var n=this.controller.levelModel.actionPlane.getBlockAt([e-1,t+1]);return n&&n.blockType&&!n.isWalkable}},{key:"isUnderTree",value:function(e,t){if(e>=this.trees.length||e<0)return!1;for(var i=this.treeFluffTypes[this.trees[e].type],n=0;n<i.length;n++)if(this.trees[e].position[0]+i[n][0]===t[0]&&this.trees[e].position[1]+i[n][1]===t[1])return!0;return!1}},{key:"changeTreeAlpha",value:function(e,t){this.controller.levelView.addResettableTween(this.trees[e].sprite.fluff).to({alpha:t},300,Phaser.Easing.Linear.None).start()}},{key:"onAnimationEnd",value:function(e,t){var i=e.onComplete.add(function(){i.detach(),t()})}},{key:"onAnimationStart",value:function(e,t){var i=e.onStart.add(function(){i.detach(),t()})}},{key:"onAnimationLoopOnce",value:function(e,t){var i=e.onLoop.add(function(){i.detach(),t()})}},{key:"addResettableTween",value:function(e){var t=this.game.add.tween(e);return t.timeScale=this.controller.tweenTimeScale,this.resettableTweens.push(t),t}},{key:"animateDoor",value:function(e,t){var i=this,n=this.controller.levelModel.player;this.setSelectionIndicatorPosition(this.controller.levelModel.actionPlane.indexToCoordinates(e)[0],this.controller.levelModel.actionPlane.indexToCoordinates(e)[1]),this.controller.audioPlayer.play("doorOpen");var o=this.controller.levelModel.actionPlane.indexToCoordinates(e);this.playDoorAnimation(o,t,function(){var e=i.controller.levelModel.actionPlane.getBlockAt(o);e.isWalkable=e.isOpen,"doorIron"!==e.blockType&&i.playIdleAnimation(n.position,n.facing,n.isOnBlock,n),i.setSelectionIndicatorPosition(n.position[0],n.position[1])})}}]),e}()},function(e,t,i){"use strict";e.exports={},e.exports.createEvent=function(e){var t,i=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];try{t=new Event(e,{bubbles:i,cancelable:n})}catch(o){(t=document.createEvent("Event")).initEvent(e,i,n)}return t},e.exports.bisect=function(e,t){return[e.filter(function(e){return t(e)}),e.filter(function(e){return!t(e)})]}},function(e,t,i){"use strict";var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();var o=i(1),a=i(20),r=i(21),s=i(22),l=i(23),c=i(24),h=i(25),u=i(26),d=i(3);e.exports=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.controller=t,this.game=t.game,this.entityMap=new Map,this.entityDeathCount=new Map,this.sprite=null,this.id=0}return n(e,[{key:"loadData",value:function(e){if(void 0!==e.entities)for(var t=0;t<e.entities.length;t++){var i=e.entities[t],n=this.createEntity(i[0],this.id++,i[1],i[2],i[3],i[4]);n.updateHidingTree(),n.updateHidingBlock()}}},{key:"tick",value:function(){this.entityMap.forEach(function(e){e.tick()})}},{key:"pushEntity",value:function(e){this.entityMap.has(e.identifier)?this.controller.DEBUG&&this.game.debug.text("Duplicate entity name : "+e.identifier+"\n"):this.entityMap.set(e.identifier,e)}},{key:"isFriendlyEntity",value:function(e){for(var t=["sheep","ironGolem","cow","chicken"],i=0;i<t.length;i++)if(e===t[i])return!0;return!1}},{key:"createEntity",value:function(e,t,i,n,d,p){var f=null;if(this.entityMap.has(t))this.controller.DEBUG&&this.game.debug.text("Duplicate entity name : "+t+"\n");else{switch(e){case"sheep":f=new a(this.controller,e,t,i,n,d);break;case"zombie":f=new r(this.controller,e,t,i,n,d);break;case"ironGolem":f=new s(this.controller,e,t,i,n,d);break;case"creeper":f=new l(this.controller,e,t,i,n,d);break;case"cow":f=new c(this.controller,e,t,i,n,d);break;case"chicken":f=new h(this.controller,e,t,i,n,d);break;case"ghast":f=new u(this.controller,e,t,i,n,d,p);break;default:f=new o(this.controller,e,t,i,n,d)}this.controller.DEBUG&&console.log("Create Entity type : "+e+" "+i+","+n),this.entityMap.set(t,f)}return f}},{key:"isSpawnableInBetween",value:function(e,t,i,n){for(var o=e;o<=i;o++)for(var a=t;a<=n;a++)if(this.controller.levelModel.isPositionEmpty(new d(o,a))[0])return!0;return!1}},{key:"spawnEntity",value:function(e,t){var i=function(e,t){return Math.floor(Math.random()*(t-e+1))+e},n=this.controller.levelModel,o=n.planeWidth,a=n.planeHeight;if("middle"===t){if(this.isSpawnableInBetween(Math.floor(.25*o),Math.floor(.25*a),Math.floor(.75*o),Math.floor(.75*a))){for(var r=new d(i(Math.floor(.25*o),Math.floor(.75*o)),i(Math.floor(.25*a),Math.floor(.75*a)));!n.isPositionEmpty(r)[0];)r=new d(i(Math.floor(.25*o),Math.floor(.75*o)),i(Math.floor(.25*a),Math.floor(.75*a)));return this.createEntity(e,this.id++,r.x,r.y,i(0,3))}if(!this.isSpawnableInBetween(1,1,o-2,a-2))return null;for(var s=new d(i(1,o-2),i(1,a-2));!n.isPositionEmpty(s)[0];)s=new d(i(1,o-2),i(1,a-2));return this.createEntity(e,this.id++,s.x,s.y,i(0,3))}if("left"===t){for(var l=0,c=!0;l<o&&c;){c=!0;for(var h=0;h<a;h++)if(n.isPositionEmpty(new d(l,h))[0]){c=!1;break}c&&l++}if(l<o){for(var u=new d(l,i(0,a-1));!n.isPositionEmpty(u)[0];)u=new d(l,i(0,a-1));return this.createEntity(e,this.id++,u.x,u.y,i(0,3))}}else if("right"===t){for(var p=o-1,f=!0;p>-1&&f;){f=!0;for(var y=0;y<a;y++)if(n.isPositionEmpty(new d(p,y))[0]){f=!1;break}f&&p--}if(p>-1){for(var m=new d(p,i(0,a-1));!n.isPositionEmpty(m)[0];)m=new d(p,i(0,a-1));return this.createEntity(e,this.id++,m.x,m.y,i(0,3))}}else if("up"===t){for(var v=0,g=!0;v<a&&g;){g=!0;for(var k=0;k<o;k++)if(n.isPositionEmpty(new d(k,v))[0]){g=!1;break}g&&v++}if(v<a){for(var b=new d(i(0,a-1),v);!n.isPositionEmpty(b)[0];)b=new d(i(0,a-1),v);return this.createEntity(e,this.id++,b.x,b.y,i(0,3))}}else if("down"===t){for(var w=a-1,P=!0;w>-1&&P;){P=!0;for(var S=0;S<o;S++)if(n.isPositionEmpty(new d(S,w))[0]){P=!1;break}P&&w--}if(w>-1){for(var _=new d(i(0,a-1),w);!n.isPositionEmpty(_)[0];)_=new d(i(0,a-1),w);return this.createEntity(e,this.id++,_.x,_.y,i(0,3))}}return null}},{key:"spawnEntityAt",value:function(e,t,i,n){return this.createEntity(e,this.id++,t,i,n)}},{key:"destroyEntity",value:function(e){if(this.entityMap.has(e)){var t=this.entityMap.get(e);this.entityDeathCount.has(t.type)?this.entityDeathCount.set(t.type,this.entityDeathCount.get(t.type)+1):this.entityDeathCount.set(t.type,1),t.reset(),t.sprite.animations.stop(null,!0),t.sprite.destroy(),this.entityMap.delete(e)}else this.controller.DEBUG&&this.game.debug.text("It's impossible to delete since entity name : "+e+" is not existing\n")}},{key:"getEntityAt",value:function(e){var t=!0,i=!1,n=void 0;try{for(var o,a=this.entityMap[Symbol.iterator]();!(t=(o=a.next()).done);t=!0){var r=o.value[1];if(d.equals(e,r.position))return r}}catch(e){i=!0,n=e}finally{try{!t&&a.return&&a.return()}finally{if(i)throw n}}return null}},{key:"getEntitiesOfType",value:function(e){if("all"===e){var t=[],i=!0,n=!1,o=void 0;try{for(var a,r=this.entityMap[Symbol.iterator]();!(i=(a=r.next()).done);i=!0){var s=a.value[1];"Player"!==s.type&&t.push(s)}}catch(e){n=!0,o=e}finally{try{!i&&r.return&&r.return()}finally{if(n)throw o}}return t}var l=[],c=!0,h=!1,u=void 0;try{for(var d,p=this.entityMap[Symbol.iterator]();!(c=(d=p.next()).done);c=!0){var f=d.value[1];f.type===e&&l.push(f)}}catch(e){h=!0,u=e}finally{try{!c&&p.return&&p.return()}finally{if(h)throw u}}return l}},{key:"reset",value:function(){this.entityMap.clear(),this.entityDeathCount=new Map}}]),e}()},function(e,t,i){"use strict";var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),o=function e(t,i,n){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,i);if(void 0===o){var a=Object.getPrototypeOf(t);return null===a?void 0:e(a,i,n)}if("value"in o)return o.value;var r=o.get;return void 0!==r?r.call(n):void 0};var a=i(1),r=i(7);e.exports=function(e){function t(e,i,n,o,a,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var s=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i,n,o,a,r));return s.offset=[-43,-55],s.controller.levelView&&(s.prepareSprite(),s.sprite.sortOrder=s.controller.levelView.yToIndex(s.position.y)),s.naked=!1,s}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a),n(t,[{key:"use",value:function(e,t){var i=this,n=this.getNakedSuffix()+"lookAtCam"+this.controller.levelView.getDirectionName(this.facing);this.controller.levelView.playScaledSpeed(this.sprite.animations,n),this.queue.startPushHighPriorityCommands(),this.controller.events.forEach(function(e){return e({eventType:r.WhenUsed,targetType:i.type,eventSenderIdentifier:t.identifier,targetIdentifier:i.identifier})}),this.queue.endPushHighPriorityCommands(),e.succeeded()}},{key:"getWalkAnimation",value:function(){return this.getNakedSuffix()+o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"getWalkAnimation",this).call(this)}},{key:"getIdleAnimation",value:function(){return this.getNakedSuffix()+o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"getIdleAnimation",this).call(this)}},{key:"bump",value:function(e){var t=this,i=this.getNakedSuffix()+"bump",n=this.controller.levelView.getDirectionName(this.facing);this.controller.levelView.playScaledSpeed(this.sprite.animations,i+n);var o=this.controller.levelModel.getMoveForwardPosition(this),a=this.controller.levelEntity.getEntityAt(o);null!==a&&(this.queue.startPushHighPriorityCommands(),this.controller.events.forEach(function(e){return e({eventType:r.WhenTouched,targetType:t.type,targetIdentifier:t.identifier,eventSenderIdentifier:a.identifier})}),this.queue.endPushHighPriorityCommands()),this.controller.delayPlayerMoveBy(400,800,function(){e.succeeded()})}},{key:"prepareSprite",value:function(){var e=this,t=function(e,t){return 1e3*(Math.random()*(t-e)+e)},i=this.controller.levelView.actionGroup,n=[],o="ShadowSheep_2016";this.sprite=i.create(0,0,"sheep","ShadowSheep_2016001.png");for(var a=["ShadowSheep_2016217.png","ShadowSheep_2016109.png","ShadowSheep_2016001.png","ShadowSheep_2016325.png"],r=[[[252,261],[220,222],[228,231],[276,279],[270,275],[282,293],[294,305],[306,317],[318,323],[234,243],[880,887]],[[144,153],[112,114],[120,123],[168,171],[162,167],[174,185],[186,197],[198,209],[210,215],[126,135],[872,879]],[[36,45],[3,6],[12,15],[60,63],[54,59],[66,77],[78,89],[90,101],[102,108],[18,26],[864,871]],[[360,369],[328,330],[336,339],[384,387],[378,383],[390,401],[402,413],[414,425],[426,431],[342,351],[888,895]]],s=0;s<4;s++){var l=this.controller.levelView.getDirectionName(s);n=Phaser.Animation.generateFrameNames(o,r[s][0][0],r[s][0][1],".png",3);for(var c=0;c<8;c++)n.push(a[s]);this.sprite.animations.add("idle"+l,n,10,!1).onComplete.add(function(){e.playRandomIdle(e.facing)}),n=Phaser.Animation.generateFrameNames(o,r[s][1][0],r[s][1][1],".png",3),this.sprite.animations.add("lookLeft"+l,n,10,!1).onComplete.add(function(){e.sprite.animations.stop(),setTimeout(function(){e.naked?e.controller.levelView.playScaledSpeed(e.sprite.animations,"naked_lookLeft"+e.controller.levelView.getDirectionName(e.facing)+"_2"):e.controller.levelView.playScaledSpeed(e.sprite.animations,"lookLeft"+e.controller.levelView.getDirectionName(e.facing)+"_2")},t(.2,1))}),n=Phaser.Animation.generateFrameNames(o,r[s][1][1],r[s][1][0],".png",3),this.sprite.animations.add("lookLeft"+l+"_2",n,10,!1).onComplete.add(function(){e.controller.levelView.playScaledSpeed(e.sprite.animations,"idle"+e.controller.levelView.getDirectionName(e.facing))}),n=Phaser.Animation.generateFrameNames(o,r[s][2][0],r[s][2][1],".png",3),this.sprite.animations.add("lookRight"+l,n,10,!1).onComplete.add(function(){e.sprite.animations.stop(),setTimeout(function(){e.naked?e.controller.levelView.playScaledSpeed(e.sprite.animations,"naked_lookRight"+e.controller.levelView.getDirectionName(e.facing)+"_2"):e.controller.levelView.playScaledSpeed(e.sprite.animations,"lookRight"+e.controller.levelView.getDirectionName(e.facing)+"_2")},t(.2,1))}),n=Phaser.Animation.generateFrameNames(o,r[s][2][1],r[s][2][0],".png",3),this.sprite.animations.add("lookRight"+l+"_2",n,10,!1).onComplete.add(function(){e.controller.levelView.playScaledSpeed(e.sprite.animations,"idle"+e.controller.levelView.getDirectionName(e.facing))}),n=Phaser.Animation.generateFrameNames(o,r[s][3][0],r[s][3][1],".png",3),this.sprite.animations.add("lookAtCam"+l,n,10,!1).onComplete.add(function(){e.sprite.animations.stop(),setTimeout(function(){e.naked?e.controller.levelView.playScaledSpeed(e.sprite.animations,"naked_lookAtCam"+e.controller.levelView.getDirectionName(e.facing)+"_2"):e.controller.levelView.playScaledSpeed(e.sprite.animations,"lookAtCam"+e.controller.levelView.getDirectionName(e.facing)+"_2")},t(.2,1))}),n=Phaser.Animation.generateFrameNames(o,r[s][3][1],r[s][3][0],".png",3),this.sprite.animations.add("lookAtCam"+l+"_2",n,10,!1).onComplete.add(function(){e.controller.levelView.playScaledSpeed(e.sprite.animations,"idle"+e.controller.levelView.getDirectionName(e.facing))}),n=Phaser.Animation.generateFrameNames(o,r[s][4][0],r[s][4][1],".png",3),this.sprite.animations.add("lookDown"+l,n,10,!1).onComplete.add(function(){e.controller.levelView.playScaledSpeed(e.sprite.animations,"idle"+e.controller.levelView.getDirectionName(e.facing))}),n=Phaser.Animation.generateFrameNames(o,r[s][5][0],r[s][5][1],".png",3),this.sprite.animations.add("walk"+l,n,10,!1).onComplete.add(function(){e.controller.levelView.playScaledSpeed(e.sprite.animations,"idle"+e.controller.levelView.getDirectionName(e.facing))}),n=Phaser.Animation.generateFrameNames(o,r[s][6][0],r[s][6][1],".png",3),this.sprite.animations.add("attack"+l,n,10,!1).onComplete.add(function(){e.controller.levelView.playScaledSpeed(e.sprite.animations,"idle"+e.controller.levelView.getDirectionName(e.facing))}),n=Phaser.Animation.generateFrameNames(o,r[s][7][0],r[s][7][1],".png",3),this.sprite.animations.add("hurt"+l,n,10,!1).onComplete.add(function(){e.controller.levelView.playScaledSpeed(e.sprite.animations,"idle"+e.controller.levelView.getDirectionName(e.facing))}),n=Phaser.Animation.generateFrameNames(o,r[s][8][0],r[s][8][1],".png",3),this.sprite.animations.add("die"+l,n,10,!1),n=this.controller.levelView.generateReverseFrames(o,r[s][9][0],r[s][9][1],".png",3),this.sprite.animations.add("eat"+l,n,10,!1).onComplete.add(function(){e.controller.levelView.playScaledSpeed(e.sprite.animations,"idle"+e.controller.levelView.getDirectionName(e.facing))}),n=this.controller.levelView.generateReverseFrames(o,r[s][10][0],r[s][10][1],".png",3),this.sprite.animations.add("bump"+l,n,10,!1).onComplete.add(function(){e.controller.levelView.playScaledSpeed(e.sprite.animations,"idle"+e.controller.levelView.getDirectionName(e.facing))})}r=[[[684,693],[652,654],[660,663],[708,711],[702,707],[714,725],[726,737],[738,749],[750,755],[666,675],[912,919]],[[576,585],[544,546],[552,555],[600,603],[594,599],[606,617],[618,629],[630,641],[642,647],[558,567],[904,911]],[[468,477],[436,438],[444,447],[492,495],[486,491],[498,509],[510,521],[522,533],[534,539],[450,459],[896,903]],[[792,801],[760,762],[768,771],[816,819],[810,815],[822,833],[834,845],[846,857],[858,863],[774,783],[920,927]]],a=["ShadowSheep_2016649.png","ShadowSheep_2016541.png","ShadowSheep_2016433.png","ShadowSheep_2016757.png"];for(var h=0;h<4;h++){var u=this.controller.levelView.getDirectionName(h);n=Phaser.Animation.generateFrameNames(o,r[h][0][0],r[h][0][1],".png",3);for(var d=0;d<8;d++)n.push(a[h]);this.sprite.animations.add("naked_idle"+u,n,10,!1).onComplete.add(function(){e.playRandomIdle(e.facing)}),n=Phaser.Animation.generateFrameNames(o,r[h][1][0],r[h][1][1],".png",3),this.sprite.animations.add("naked_lookLeft"+u,n,10,!1).onComplete.add(function(){e.sprite.animations.stop(),setTimeout(function(){e.controller.levelView.playScaledSpeed(e.sprite.animations,"naked_lookLeft"+e.controller.levelView.getDirectionName(e.facing)+"_2")},t(.2,1))}),n=Phaser.Animation.generateFrameNames(o,r[h][1][1],r[h][1][0],".png",3),this.sprite.animations.add("naked_lookLeft"+u+"_2",n,10,!1).onComplete.add(function(){e.controller.levelView.playScaledSpeed(e.sprite.animations,"naked_idle"+e.controller.levelView.getDirectionName(e.facing))}),n=Phaser.Animation.generateFrameNames(o,r[h][2][0],r[h][2][1],".png",3),this.sprite.animations.add("naked_lookRight"+u,n,10,!1).onComplete.add(function(){e.sprite.animations.stop(),setTimeout(function(){e.controller.levelView.playScaledSpeed(e.sprite.animations,"naked_lookRight"+e.controller.levelView.getDirectionName(e.facing)+"_2")},t(.2,1))}),n=Phaser.Animation.generateFrameNames(o,r[h][2][1],r[h][2][0],".png",3),this.sprite.animations.add("naked_lookRight"+u+"_2",n,10,!1).onComplete.add(function(){e.controller.levelView.playScaledSpeed(e.sprite.animations,"naked_idle"+e.controller.levelView.getDirectionName(e.facing))}),n=Phaser.Animation.generateFrameNames(o,r[h][3][0],r[h][3][1],".png",3),this.sprite.animations.add("naked_lookAtCam"+u,n,10,!1).onComplete.add(function(){e.sprite.animations.stop(),setTimeout(function(){e.controller.levelView.playScaledSpeed(e.sprite.animations,"naked_lookAtCam"+e.controller.levelView.getDirectionName(e.facing)+"_2")},t(.2,1))}),n=Phaser.Animation.generateFrameNames(o,r[h][3][1],r[h][3][0],".png",3),this.sprite.animations.add("naked_lookAtCam"+u+"_2",n,10,!1).onComplete.add(function(){e.controller.levelView.playScaledSpeed(e.sprite.animations,"naked_idle"+e.controller.levelView.getDirectionName(e.facing))}),n=Phaser.Animation.generateFrameNames(o,r[h][4][0],r[h][4][1],".png",3),this.sprite.animations.add("naked_lookDown"+u,n,10,!1).onComplete.add(function(){e.controller.levelView.playScaledSpeed(e.sprite.animations,"naked_idle"+e.controller.levelView.getDirectionName(e.facing))}),n=Phaser.Animation.generateFrameNames(o,r[h][5][0],r[h][5][1],".png",3),this.sprite.animations.add("naked_walk"+u,n,10,!0),n=Phaser.Animation.generateFrameNames(o,r[h][6][0],r[h][6][1],".png",3),this.sprite.animations.add("naked_attack"+u,n,10,!1).onComplete.add(function(){e.controller.levelView.playScaledSpeed(e.sprite.animations,"naked_idle"+e.controller.levelView.getDirectionName(e.facing))}),n=Phaser.Animation.generateFrameNames(o,r[h][7][0],r[h][7][1],".png",3),this.sprite.animations.add("naked_hurt_"+u,n,10,!1).onComplete.add(function(){e.controller.levelView.playScaledSpeed(e.sprite.animations,"naked_idle"+e.controller.levelView.getDirectionName(e.facing))}),n=Phaser.Animation.generateFrameNames(o,r[h][8][0],r[h][8][1],".png",3),this.sprite.animations.add("naked_die"+u,n,10,!1),n=this.controller.levelView.generateReverseFrames(o,r[h][9][0],r[h][9][1],".png",3),this.sprite.animations.add("naked_eat"+u,n,10,!1).onComplete.add(function(){e.naked=!1,e.controller.levelView.playScaledSpeed(e.sprite.animations,"idle"+e.controller.levelView.getDirectionName(e.facing))}),n=this.controller.levelView.generateReverseFrames(o,r[h][10][0],r[h][10][1],".png",3),this.sprite.animations.add("naked_bump"+u,n,10,!1).onComplete.add(function(){e.controller.levelView.playScaledSpeed(e.sprite.animations,"naked_idle"+e.controller.levelView.getDirectionName(e.facing))})}this.controller.levelView.playScaledSpeed(this.sprite.animations,"idle"+this.controller.levelView.getDirectionName(this.facing)),this.sprite.x=this.offset[0]+40*this.position.x,this.sprite.y=this.offset[1]+40*this.position.y}},{key:"playRandomIdle",value:function(e){var t,i=this.getNakedSuffix();switch(t=this.controller.levelView.getDirectionName(e),Math.trunc(6*Math.random())+1){case 1:i+="idle";break;case 2:i+="lookLeft";break;case 3:i+="lookRight";break;case 4:i+="lookAtCam";break;case 5:i+="lookDown";break;case 6:i+="eat"}i+=t,this.controller.levelView.playScaledSpeed(this.sprite.animations,i),this.controller.printErrorMsg(this.type+" calls animation : "+i+"\n")}},{key:"attack",value:function(e){var t=this,i=this.controller.levelView.getDirectionName(this.facing);this.controller.levelView.onAnimationEnd(this.controller.levelView.playScaledSpeed(this.sprite.animations,this.getNakedSuffix()+"attack"+i),function(){var n=t.controller.levelEntity.getEntityAt(t.controller.levelModel.getMoveForwardPosition(t));null!==n&&t.controller.levelView.onAnimationEnd(t.controller.levelView.playScaledSpeed(n.sprite.animations,t.getNakedSuffix()+"hurt"+i),function(){t.controller.events.forEach(function(e){return e({eventType:r.WhenAttacked,targetType:t.type,eventSenderIdentifier:t.identifier,targetIdentifier:n.identifier})})}),e.succeeded()})}},{key:"updateAnimationDirection",value:function(){var e=this.controller.levelView.getDirectionName(this.facing);this.controller.levelView.playScaledSpeed(this.sprite.animations,this.getNakedSuffix()+"idle"+e)}},{key:"drop",value:function(e,i){if(this.naked)return!1;if(e&&o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"drop",this).call(this,e,i),"wool"===i&&(this.naked=!0,this.controller.levelView)){var n=this.controller.levelView.getDirectionName(this.facing);this.controller.levelView.playScaledSpeed(this.sprite.animations,"naked_idle"+n,function(){})}return!0}},{key:"takeDamage",value:function(e){var t=this,i=this.controller.levelView,n=i.getDirectionName(this.facing);this.healthPoint>1?(i.playScaledSpeed(this.sprite.animations,this.getNakedSuffix()+"hurt"+n),setTimeout(function(){t.healthPoint--,e.succeeded()},1500)):(this.healthPoint--,this.sprite.animations.stop(null,!0),this.controller.levelView.playScaledSpeed(this.sprite.animations,this.getNakedSuffix()+"die"+n),setTimeout(function(){var e=t.controller.levelView.addResettableTween(t.sprite).to({alpha:0},500,Phaser.Easing.Linear.None);e.onComplete.add(function(){t.controller.levelEntity.destroyEntity(t.identifier)}),e.start()},1500))}},{key:"getNakedSuffix",value:function(){return this.naked?"naked_":""}}]),t}()},function(e,t,i){"use strict";var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),o=function e(t,i,n){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,i);if(void 0===o){var a=Object.getPrototypeOf(t);return null===a?void 0:e(a,i,n)}if("value"in o)return o.value;var r=o.get;return void 0!==r?r.call(n):void 0};var a=i(1);e.exports=function(e){function t(e,i,n,o,a,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var s=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i,n,o,a,r));return s.offset=[-43,-45],s.burningSprite=[null,null],s.burningSpriteGhost=[null,null],s.burningSpriteOffset=[47,40],s.prepareSprite(),s}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a),n(t,[{key:"tick",value:function(){o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"tick",this).call(this)}},{key:"reset",value:function(){for(var e=0;e<2;e++)this.burningSprite[e]&&this.burningSprite[e].destroy()}},{key:"playMoveForwardAnimation",value:function(e,i,n,a){var r=this;o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"playMoveForwardAnimation",this).call(this,e,i,n,a),this.burningSprite[0].sortOrder=this.sprite.sortOrder+1,this.burningSprite[1].sortOrder=this.sprite.sortOrder-1,setTimeout(function(){for(var t=0;t<2;t++){var i=r.controller.levelView.addResettableTween(r.burningSprite[t]).to({x:r.offset[0]+r.burningSpriteOffset[0]+40*e[0],y:r.offset[1]+r.burningSpriteOffset[1]+40*e[1]},300,Phaser.Easing.Linear.None);i.onComplete.add(function(){}),i.start()}},50/this.controller.tweenTimeScale)}},{key:"setBurn",value:function(e){if(e)for(var t=0;t<2;t++)this.burningSprite[t].alpha=1;else for(var i=0;i<2;i++)this.burningSprite[i].alpha=0}},{key:"prepareSprite",value:function(){var e=this,t=function(e,t){return 1e3*(Math.random()*(t-e)+e)},i=this.controller.levelView.actionGroup,n=[];this.sprite=i.create(0,0,"zombie","Zombie_001.png"),this.sprite.sortOrder=this.controller.levelView.yToIndex(this.position.y),this.sprite.x=this.offset[0]+40*this.position.x,this.sprite.y=this.offset[1]+40*this.position.y,this.burningSprite=[i.create(this.sprite.x+this.burningSpriteOffset[0],this.sprite.y+this.burningSpriteOffset[1],"burningInSun","BurningFront_001.png"),i.create(this.sprite.x+this.burningSpriteOffset[0],this.sprite.y+this.burningSpriteOffset[1],"burningInSun","BurningBehind_001.png")],n=Phaser.Animation.generateFrameNames("BurningFront_",1,15,".png",3),this.burningSprite[0].animations.add("burn",n,10,!0),n=Phaser.Animation.generateFrameNames("BurningBehind_",1,15,".png",3),this.burningSprite[1].animations.add("burn",n,10,!0),this.controller.levelView.playScaledSpeed(this.burningSprite[0].animations,"burn"),this.controller.levelView.playScaledSpeed(this.burningSprite[1].animations,"burn"),this.burningSprite[0].sortOrder=this.sprite.sortOrder+1,this.burningSprite[1].sortOrder=this.sprite.sortOrder-1;for(var o=["Zombie_056.png","Zombie_166.png","Zombie_001.png","Zombie_111.png"],a=[[[73,79],[57,59],[61,63],[69,71],[65,67],[80,88],[89,91],[93,101],[102,110],[229,236]],[[183,189],[167,169],[171,173],[179,181],[175,177],[190,198],[199,201],[203,211],[212,220],[245,252]],[[18,24],[2,4],[6,8],[14,16],[10,12],[25,33],[34,36],[38,46],[47,55],[221,228]],[[128,134],[112,114],[116,118],[124,126],[120,122],[135,143],[144,146],[148,156],[158,165],[237,244]]],r=0;r<4;r++){var s=this.controller.levelView.getDirectionName(r);n=Phaser.Animation.generateFrameNames("Zombie_",a[r][0][0],a[r][0][1],".png",3);for(var l=0;l<8;l++)n.push(o[r]);this.sprite.animations.add("idle"+s,n,10,!1).onComplete.add(function(){e.playRandomIdle(e.facing)}),n=Phaser.Animation.generateFrameNames("Zombie_",a[r][1][0],a[r][1][1],".png",3),this.sprite.animations.add("lookLeft"+s,n,10,!1).onComplete.add(function(){e.sprite.animations.stop(),setTimeout(function(){e.controller.levelView.playScaledSpeed(e.sprite.animations,"lookLeft"+e.controller.levelView.getDirectionName(e.facing)+"_2")},t(.2,1))}),n=Phaser.Animation.generateFrameNames("Zombie_",a[r][1][1],a[r][1][0],".png",3),this.sprite.animations.add("lookLeft"+s+"_2",n,10,!1).onComplete.add(function(){e.controller.levelView.playScaledSpeed(e.sprite.animations,"idle"+e.controller.levelView.getDirectionName(e.facing))}),n=Phaser.Animation.generateFrameNames("Zombie_",a[r][2][0],a[r][2][1],".png",3),this.sprite.animations.add("lookRight"+s,n,10,!1).onComplete.add(function(){e.sprite.animations.stop(),setTimeout(function(){e.controller.levelView.playScaledSpeed(e.sprite.animations,"lookRight"+e.controller.levelView.getDirectionName(e.facing)+"_2")},t(.2,1))}),n=Phaser.Animation.generateFrameNames("Zombie_",a[r][2][1],a[r][2][0],".png",3),this.sprite.animations.add("lookRight"+s+"_2",n,10,!1).onComplete.add(function(){e.controller.levelView.playScaledSpeed(e.sprite.animations,"idle"+e.controller.levelView.getDirectionName(e.facing))}),n=Phaser.Animation.generateFrameNames("Zombie_",a[r][3][0],a[r][3][1],".png",3),this.sprite.animations.add("lookAtCam"+s,n,10,!1).onComplete.add(function(){e.sprite.animations.stop(),setTimeout(function(){e.controller.levelView.playScaledSpeed(e.sprite.animations,"lookAtCam"+e.controller.levelView.getDirectionName(e.facing)+"_2")},t(.2,1))}),n=Phaser.Animation.generateFrameNames("Zombie_",a[r][3][1],a[r][3][0],".png",3),this.sprite.animations.add("lookAtCam"+s+"_2",n,10,!1).onComplete.add(function(){e.controller.levelView.playScaledSpeed(e.sprite.animations,"idle"+e.controller.levelView.getDirectionName(e.facing))}),n=Phaser.Animation.generateFrameNames("Zombie_",a[r][4][0],a[r][4][1],".png",3),this.sprite.animations.add("lookDown"+s,n,10/3,!1).onComplete.add(function(){e.controller.levelView.playScaledSpeed(e.sprite.animations,"idle"+e.controller.levelView.getDirectionName(e.facing))}),n=Phaser.Animation.generateFrameNames("Zombie_",a[r][5][0],a[r][5][1],".png",3),this.sprite.animations.add("walk"+s,n,10,!0),n=Phaser.Animation.generateFrameNames("Zombie_",a[r][6][0],a[r][6][1],".png",3),this.sprite.animations.add("attack"+s,n,10,!1).onComplete.add(function(){e.controller.levelView.playScaledSpeed(e.sprite.animations,"idle"+e.controller.levelView.getDirectionName(e.facing))}),n=Phaser.Animation.generateFrameNames("Zombie_",a[r][7][0],a[r][7][1],".png",3),this.sprite.animations.add("hurt"+s,n,10,!1).onComplete.add(function(){e.controller.levelView.playScaledSpeed(e.sprite.animations,"idle"+e.controller.levelView.getDirectionName(e.facing))}),n=Phaser.Animation.generateFrameNames("Zombie_",a[r][8][0],a[r][8][1],".png",3),this.sprite.animations.add("die"+s,n,10,!1),n=this.controller.levelView.generateReverseFrames("Zombie_",a[r][9][0],a[r][9][1],".png",3),this.sprite.animations.add("bump"+s,n,10,!1).onComplete.add(function(){e.controller.levelView.playScaledSpeed(e.sprite.animations,"idle"+e.controller.levelView.getDirectionName(e.facing))})}this.controller.levelView.playScaledSpeed(this.sprite.animations,"idle"+this.controller.levelView.getDirectionName(this.facing)),this.setBurn(this.controller.levelModel.isDaytime)}},{key:"takeDamage",value:function(e){var t=this,i=this.controller.levelView,n=i.getDirectionName(this.facing);this.healthPoint>1?(i.playScaledSpeed(this.sprite.animations,"hurt"+n),setTimeout(function(){t.healthPoint--,e.succeeded()},1500/this.controller.tweenTimeScale)):(this.healthPoint--,this.controller.levelView.playScaledSpeed(this.sprite.animations,"die"+n),setTimeout(function(){var e=t.controller.levelView.addResettableTween(t.sprite).to({alpha:0},500,Phaser.Easing.Linear.None);e.onComplete.add(function(){t.controller.levelEntity.destroyEntity(t.identifier)}),e.start();for(var i=0;i<2;i++)(e=t.controller.levelView.addResettableTween(t.burningSprite[i]).to({alpha:0},500,Phaser.Easing.Linear.None)).start()},1500/this.controller.tweenTimeScale))}}]),t}()},function(e,t,i){"use strict";var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();var o=i(1);e.exports=function(e){function t(e,i,n,o,a,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var s=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i,n,o,a,r));return s.offset=[-43,-55],s.prepareSprite(),s.sprite.sortOrder=s.controller.levelView.yToIndex(s.position.y),s}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o),n(t,[{key:"prepareSprite",value:function(){var e=this,t=function(e,t){return 1e3*(Math.random()*(t-e)+e)},i=this.controller.levelView.actionGroup,n=[],o="Iron_Golem_Anims";this.sprite=i.create(0,0,"ironGolem","Iron_Golem_Anims001.png");for(var a=[[[45,45],[46,48],[50,52],[58,60],[54,56],[62,70],[71,74],[77,81],[82,88],[185,192]],[[133,133],[134,136],[138,140],[146,148],[142,144],[150,158],[159,162],[165,169],[170,176],[201,208]],[[1,1],[2,4],[6,8],[14,16],[10,12],[18,26],[27,30],[33,37],[38,44],[177,184]],[[89,89],[90,92],[94,96],[102,104],[98,100],[106,114],[115,118],[121,125],[126,132],[193,200]]],r=0;r<4;r++){var s=this.controller.levelView.getDirectionName(r);n=Phaser.Animation.generateFrameNames(o,a[r][0][0],a[r][0][1],".png",3);for(var l=0;l<12;l++)n.push(n[0]);this.sprite.animations.add("idle"+s,n,8,!1).onComplete.add(function(){e.playRandomIdle(e.facing)}),n=Phaser.Animation.generateFrameNames(o,a[r][1][0],a[r][1][1],".png",3),this.sprite.animations.add("lookLeft"+s,n,8,!1).onComplete.add(function(){e.sprite.animations.stop(),setTimeout(function(){e.controller.levelView.playScaledSpeed(e.sprite.animations,"lookLeft"+e.controller.levelView.getDirectionName(e.facing)+"_2")},t(.2,1))}),n=Phaser.Animation.generateFrameNames(o,a[r][1][1],a[r][1][0],".png",3),this.sprite.animations.add("lookLeft"+s+"_2",n,8,!1).onComplete.add(function(){e.controller.levelView.playScaledSpeed(e.sprite.animations,"idle"+e.controller.levelView.getDirectionName(e.facing))}),n=Phaser.Animation.generateFrameNames(o,a[r][2][0],a[r][2][1],".png",3),this.sprite.animations.add("lookRight"+s,n,8,!1).onComplete.add(function(){e.sprite.animations.stop(),setTimeout(function(){e.controller.levelView.playScaledSpeed(e.sprite.animations,"lookRight"+e.controller.levelView.getDirectionName(e.facing)+"_2")},t(.2,1))}),n=Phaser.Animation.generateFrameNames(o,a[r][2][1],a[r][2][0],".png",3),this.sprite.animations.add("lookRight"+s+"_2",n,8,!1).onComplete.add(function(){e.controller.levelView.playScaledSpeed(e.sprite.animations,"idle"+e.controller.levelView.getDirectionName(e.facing))}),n=Phaser.Animation.generateFrameNames(o,a[r][3][0],a[r][3][1],".png",3),this.sprite.animations.add("lookAtCam"+s,n,8,!1).onComplete.add(function(){e.sprite.animations.stop(),setTimeout(function(){e.controller.levelView.playScaledSpeed(e.sprite.animations,"lookAtCam"+e.controller.levelView.getDirectionName(e.facing)+"_2")},t(.2,1))}),n=Phaser.Animation.generateFrameNames(o,a[r][3][1],a[r][3][0],".png",3),this.sprite.animations.add("lookAtCam"+s+"_2",n,8,!1).onComplete.add(function(){e.controller.levelView.playScaledSpeed(e.sprite.animations,"idle"+e.controller.levelView.getDirectionName(e.facing))}),n=Phaser.Animation.generateFrameNames(o,a[r][4][0],a[r][4][1],".png",3),this.sprite.animations.add("lookDown"+s,n,8,!1).onComplete.add(function(){e.controller.levelView.playScaledSpeed(e.sprite.animations,"lookDown_2"+e.controller.levelView.getDirectionName(e.facing))}),n=Phaser.Animation.generateFrameNames(o,a[r][4][1],a[r][4][0],".png",3),this.sprite.animations.add("lookDown_2"+s,n,8,!1).onComplete.add(function(){e.controller.levelView.playScaledSpeed(e.sprite.animations,"idle"+e.controller.levelView.getDirectionName(e.facing))}),n=Phaser.Animation.generateFrameNames(o,a[r][5][0],a[r][5][1],".png",3),this.sprite.animations.add("walk"+s,n,8,!0),n=Phaser.Animation.generateFrameNames(o,a[r][6][0],a[r][6][1],".png",3),this.sprite.animations.add("attack"+s,n,8,!1).onComplete.add(function(){e.controller.levelView.playScaledSpeed(e.sprite.animations,"idle"+e.controller.levelView.getDirectionName(e.facing))}),n=Phaser.Animation.generateFrameNames(o,a[r][7][0],a[r][7][1],".png",3),this.sprite.animations.add("hurt"+s,n,16/3,!1).onComplete.add(function(){e.controller.levelView.playScaledSpeed(e.sprite.animations,"idle"+e.controller.levelView.getDirectionName(e.facing))}),n=Phaser.Animation.generateFrameNames(o,a[r][8][0],a[r][8][1],".png",3),this.sprite.animations.add("die"+s,n,16/3,!1),n=this.controller.levelView.generateReverseFrames(o,a[r][9][0],a[r][9][1],".png",3),this.sprite.animations.add("bump"+s,n,8,!1).onComplete.add(function(){e.controller.levelView.playScaledSpeed(e.sprite.animations,"idle"+e.controller.levelView.getDirectionName(e.facing))})}this.controller.levelView.playScaledSpeed(this.sprite.animations,"idle"+this.controller.levelView.getDirectionName(this.facing)),this.sprite.x=this.offset[0]+40*this.position[0],this.sprite.y=this.offset[1]+40*this.position[1]}}]),t}()},function(e,t,i){"use strict";var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();var o=i(1);e.exports=function(e){function t(e,i,n,o,a,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var s=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i,n,o,a,r));return s.offset=[-43,-55],s.prepareSprite(),s.sprite.sortOrder=s.controller.levelView.yToIndex(s.position.y),s}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o),n(t,[{key:"prepareSprite",value:function(){var e=this,t=function(e,t){return 1e3*(Math.random()*(t-e)+e)},i=this.controller.levelView.actionGroup,n=[],o="ShadowCreeper_2016_";this.sprite=i.create(0,0,"creeper","ShadowCreeper_2016_000.png");for(var a=[[[128,128],[128,131],[134,137],[140,143],[146,149],[152,163],[164,167],[164,178],[179,184],[185,191],[272,279]],[[64,64],[64,67],[70,73],[76,89],[82,85],[88,99],[100,103],[100,114],[115,120],[121,127],[264,271]],[[0,0],[0,3],[6,10],[12,16],[18,21],[24,35],[36,39],[36,50],[51,56],[57,63],[256,263]],[[192,192],[192,195],[198,201],[204,207],[210,213],[216,227],[228,231],[228,242],[243,248],[249,255],[280,287]]],r=0;r<4;r++){var s=this.controller.levelView.getDirectionName(r);n=Phaser.Animation.generateFrameNames(o,a[r][0][0],a[r][0][1],".png",3);for(var l=0;l<12;l++)n.push(n[0]);this.sprite.animations.add("idle"+s,n,10,!1).onComplete.add(function(){e.playRandomIdle(e.facing)}),n=Phaser.Animation.generateFrameNames(o,a[r][1][0],a[r][1][1],".png",3),this.sprite.animations.add("lookLeft"+s,n,10,!1).onComplete.add(function(){e.sprite.animations.stop(),setTimeout(function(){e.controller.levelView.playScaledSpeed(e.sprite.animations,"lookLeft"+e.controller.levelView.getDirectionName(e.facing)+"_2")},t(.2,1))}),n=Phaser.Animation.generateFrameNames(o,a[r][1][1],a[r][1][0],".png",3),this.sprite.animations.add("lookLeft"+s+"_2",n,10,!1).onComplete.add(function(){e.controller.levelView.playScaledSpeed(e.sprite.animations,"idle"+e.controller.levelView.getDirectionName(e.facing))}),n=Phaser.Animation.generateFrameNames(o,a[r][2][0],a[r][2][1],".png",3),this.sprite.animations.add("lookRight"+s,n,10,!1).onComplete.add(function(){e.sprite.animations.stop(),setTimeout(function(){e.controller.levelView.playScaledSpeed(e.sprite.animations,"lookRight"+e.controller.levelView.getDirectionName(e.facing)+"_2")},t(.2,1))}),n=Phaser.Animation.generateFrameNames(o,a[r][2][1],a[r][2][0],".png",3),this.sprite.animations.add("lookRight"+s+"_2",n,10,!1).onComplete.add(function(){e.controller.levelView.playScaledSpeed(e.sprite.animations,"idle"+e.controller.levelView.getDirectionName(e.facing))}),n=Phaser.Animation.generateFrameNames(o,a[r][3][0],a[r][3][1],".png",3),this.sprite.animations.add("lookAtCam"+s,n,10,!1).onComplete.add(function(){e.sprite.animations.stop(),setTimeout(function(){e.controller.levelView.playScaledSpeed(e.sprite.animations,"lookAtCam"+e.controller.levelView.getDirectionName(e.facing)+"_2")},t(.2,1))}),n=Phaser.Animation.generateFrameNames(o,a[r][3][1],a[r][3][0],".png",3),this.sprite.animations.add("lookAtCam"+s+"_2",n,10,!1).onComplete.add(function(){e.controller.levelView.playScaledSpeed(e.sprite.animations,"idle"+e.controller.levelView.getDirectionName(e.facing))}),n=Phaser.Animation.generateFrameNames(o,a[r][4][0],a[r][4][1],".png",3),this.sprite.animations.add("lookDown"+s,n,10,!1).onComplete.add(function(){e.controller.levelView.playScaledSpeed(e.sprite.animations,"lookDown_2"+e.controller.levelView.getDirectionName(e.facing))}),n=Phaser.Animation.generateFrameNames(o,a[r][4][1],a[r][4][0],".png",3),this.sprite.animations.add("lookDown_2"+s,n,10,!1).onComplete.add(function(){e.controller.levelView.playScaledSpeed(e.sprite.animations,"idle"+e.controller.levelView.getDirectionName(e.facing))}),n=Phaser.Animation.generateFrameNames(o,a[r][5][0],a[r][5][1],".png",3),this.sprite.animations.add("walk"+s,n,10,!0),n=Phaser.Animation.generateFrameNames(o,a[r][6][0],a[r][6][1],".png",3),this.sprite.animations.add("attack"+s,n,10,!1).onComplete.add(function(){e.controller.levelView.playScaledSpeed(e.sprite.animations,"idle"+e.controller.levelView.getDirectionName(e.facing))}),n=Phaser.Animation.generateFrameNames(o,a[r][7][0],a[r][7][1],".png",3),this.sprite.animations.add("explode"+s,n,10,!1).onComplete.add(function(){e.controller.levelView.playScaledSpeed(e.sprite.animations,"idle"+e.controller.levelView.getDirectionName(e.facing))}),n=Phaser.Animation.generateFrameNames(o,a[r][8][0],a[r][8][1],".png",3),this.sprite.animations.add("hurt"+s,n,10,!1).onComplete.add(function(){e.controller.levelView.playScaledSpeed(e.sprite.animations,"idle"+e.controller.levelView.getDirectionName(e.facing))}),n=Phaser.Animation.generateFrameNames(o,a[r][9][0],a[r][9][1],".png",3),this.sprite.animations.add("die"+s,n,10,!1),n=this.controller.levelView.generateReverseFrames(o,a[r][10][0],a[r][10][1],".png",3),this.sprite.animations.add("bump"+s,n,10,!1).onComplete.add(function(){e.controller.levelView.playScaledSpeed(e.sprite.animations,"idle"+e.controller.levelView.getDirectionName(e.facing))})}this.controller.levelView.playScaledSpeed(this.sprite.animations,"idle"+this.controller.levelView.getDirectionName(this.facing)),this.sprite.x=this.offset[0]+40*this.position.x,this.sprite.y=this.offset[1]+40*this.position.y}}]),t}()},function(e,t,i){"use strict";var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();var o=i(1);e.exports=function(e){function t(e,i,n,o,a,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var s=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i,n,o,a,r));return s.offset=[-43,-55],s.prepareSprite(),s.sprite.sortOrder=s.controller.levelView.yToIndex(s.position.y),s}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o),n(t,[{key:"prepareSprite",value:function(){var e=this,t=function(e,t){return 1e3*(Math.random()*(t-e)+e)},i=this.controller.levelView.actionGroup,n=[];this.sprite=i.create(0,0,"cow","Cow0001.png");for(var o=["Cow0222.png","Cow0111.png","Cow0001.png","Cow0333.png"],a=[[[258,264],[225,227],[224,226],[285,287],[240,241],[291,302],[303,313],[314,326],[327,332],[460,467],[276,282],[240,249]],[[147,153],[114,116],[129,130],[174,176],[129,130],[180,191],[192,202],[203,215],[216,221],[452,459],[165,171],[129,138]],[[36,42],[3,5],[12,14],[63,65],[18,19],[69,80],[81,91],[92,104],[105,110],[444,451],[51,54],[18,27]],[[369,375],[336,338],[335,337],[396,398],[351,352],[402,413],[414,424],[425,437],[438,443],[468,475],[387,393],[351,360]]],r=0;r<4;r++){var s=this.controller.levelView.getDirectionName(r);n=[];for(var l=0;l<20;l++)n.push(o[r]);this.sprite.animations.add("idle"+s,n,12,!1).onComplete.add(function(){e.controller.levelView.playScaledSpeed(e.sprite.animations,"idle2"+e.controller.levelView.getDirectionName(e.facing))}),n=Phaser.Animation.generateFrameNames("Cow",a[r][1][0],a[r][1][1],".png",4),this.sprite.animations.add("lookLeft"+s,n,12,!1).onComplete.add(function(){e.sprite.animations.stop(),setTimeout(function(){e.controller.levelView.playScaledSpeed(e.sprite.animations,"lookLeft"+e.controller.levelView.getDirectionName(e.facing)+"_2")},t(.2,1))}),n=Phaser.Animation.generateFrameNames("Cow",a[r][1][1],a[r][1][0],".png",4),this.sprite.animations.add("lookLeft"+s+"_2",n,12,!1).onComplete.add(function(){e.controller.levelView.playScaledSpeed(e.sprite.animations,"idle"+e.controller.levelView.getDirectionName(e.facing))}),n=Phaser.Animation.generateFrameNames("Cow",a[r][2][0],a[r][2][1],".png",4),this.sprite.animations.add("lookRight"+s,n,12,!1).onComplete.add(function(){setTimeout(function(){e.controller.levelView.playScaledSpeed(e.sprite.animations,"lookRight"+e.controller.levelView.getDirectionName(e.facing)+"_2")},t(.2,1))}),n=Phaser.Animation.generateFrameNames("Cow",a[r][2][1],a[r][2][0],".png",4),this.sprite.animations.add("lookRight"+s+"_2",n,12,!1).onComplete.add(function(){e.controller.levelView.playScaledSpeed(e.sprite.animations,"idle"+e.controller.levelView.getDirectionName(e.facing))}),n=Phaser.Animation.generateFrameNames("Cow",a[r][3][0],a[r][3][1],".png",4),this.sprite.animations.add("lookAtCam"+s,n,12,!1).onComplete.add(function(){setTimeout(function(){e.controller.levelView.playScaledSpeed(e.sprite.animations,"lookAtCam"+e.controller.levelView.getDirectionName(e.facing)+"_2")},t(.2,1))}),n=Phaser.Animation.generateFrameNames("Cow",a[r][3][1],a[r][3][0],".png",4),this.sprite.animations.add("lookAtCam"+s+"_2",n,12,!1).onComplete.add(function(){e.controller.levelView.playScaledSpeed(e.sprite.animations,"idle"+e.controller.levelView.getDirectionName(e.facing))}),n=Phaser.Animation.generateFrameNames("Cow",a[r][4][0],a[r][4][1],".png",4),this.sprite.animations.add("lookDown"+s,n,12,!1).onComplete.add(function(){setTimeout(function(){e.controller.levelView.playScaledSpeed(e.sprite.animations,"lookDown"+e.controller.levelView.getDirectionName(e.facing)+"_2")},t(.2,1))}),n=Phaser.Animation.generateFrameNames("Cow",a[r][4][1],a[r][4][0],".png",4),this.sprite.animations.add("lookDown"+s+"_2",n,12,!1).onComplete.add(function(){e.controller.levelView.playScaledSpeed(e.sprite.animations,"idle"+e.controller.levelView.getDirectionName(e.facing))}),n=Phaser.Animation.generateFrameNames("Cow",a[r][5][0],a[r][5][1],".png",4),this.sprite.animations.add("walk"+s,n,12,!0),n=Phaser.Animation.generateFrameNames("Cow",a[r][6][0],a[r][6][1],".png",4),this.sprite.animations.add("attack"+s,n,12,!1).onComplete.add(function(){e.controller.levelView.playScaledSpeed(e.sprite.animations,"idle"+e.controller.levelView.getDirectionName(e.facing))}),n=Phaser.Animation.generateFrameNames("Cow",a[r][7][0],a[r][7][1],".png",4),this.sprite.animations.add("hurt"+s,n,12,!1).onComplete.add(function(){e.controller.levelView.playScaledSpeed(e.sprite.animations,"idle"+e.controller.levelView.getDirectionName(e.facing))}),n=Phaser.Animation.generateFrameNames("Cow",a[r][8][0],a[r][8][1],".png",4),this.sprite.animations.add("die"+s,n,12,!1),n=this.controller.levelView.generateReverseFrames("Cow",a[r][9][0],a[r][9][1],".png",4),this.sprite.animations.add("bump"+s,n,12,!1).onComplete.add(function(){e.controller.levelView.playScaledSpeed(e.sprite.animations,"idle"+e.controller.levelView.getDirectionName(e.facing))}),2===r?(n=Phaser.Animation.generateFrameNames("Cow",a[r][10][0],a[r][10][1],".png",4),this.sprite.animations.add("idle2"+s,n,6,!1).onComplete.add(function(){e.controller.levelView.playScaledSpeed(e.sprite.animations,"idle2"+e.controller.levelView.getDirectionName(e.facing)+"_reverse")}),n=Phaser.Animation.generateFrameNames("Cow",a[r][10][1],a[r][10][0],".png",4),this.sprite.animations.add("idle2"+s+"_reverse",n,6,!1).onComplete.add(function(){e.playRandomIdle(e.facing)})):(n=Phaser.Animation.generateFrameNames("Cow",a[r][10][1],a[r][10][0],".png",4),this.sprite.animations.add("idle2"+s,n,12,!1).onComplete.add(function(){e.controller.levelView.playScaledSpeed(e.sprite.animations,"idle2"+e.controller.levelView.getDirectionName(e.facing)+"_reverse")}),n=Phaser.Animation.generateFrameNames("Cow",a[r][10][0],a[r][10][1],".png",4),this.sprite.animations.add("idle2"+s+"_reverse",n,12,!1).onComplete.add(function(){e.playRandomIdle(e.facing)})),n=Phaser.Animation.generateFrameNames("Cow",a[r][11][0],a[r][11][1],".png",4),this.sprite.animations.add("eat"+s,n,12,!1).onComplete.add(function(){e.sprite.animations.stop(),setTimeout(function(){e.controller.levelView.playScaledSpeed(e.sprite.animations,"eat"+e.controller.levelView.getDirectionName(e.facing)+"_2")},t(.2,1))}),n=Phaser.Animation.generateFrameNames("Cow",a[r][11][1],a[r][11][0],".png",4),this.sprite.animations.add("eat"+s+"_2",n,12,!1).onComplete.add(function(){e.controller.levelView.playScaledSpeed(e.sprite.animations,"idle"+e.controller.levelView.getDirectionName(e.facing))})}this.controller.levelView.playScaledSpeed(this.sprite.animations,"idle"+this.controller.levelView.getDirectionName(this.facing)),this.sprite.x=this.offset[0]+40*this.position.x,this.sprite.y=this.offset[1]+40*this.position.y}},{key:"playRandomIdle",value:function(e){var t,i="";switch(t=this.controller.levelView.getDirectionName(e),Math.trunc(5*Math.random())+1){case 1:i+="idle";break;case 2:i+="lookLeft";break;case 3:i+="lookRight";break;case 4:i+="lookAtCam";break;case 5:i+="lookDown"}i+=t,this.controller.levelView.playScaledSpeed(this.sprite.animations,i),this.controller.printErrorMsg(this.type+" calls animation : "+i+"\n")}}]),t}()},function(e,t,i){"use strict";var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();var o=i(1);e.exports=function(e){function t(e,i,n,o,a,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var s=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i,n,o,a,r));return s.offset=[-25,-32],s.prepareSprite(),s.sprite.sortOrder=s.controller.levelView.yToIndex(s.position.y),s}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o),n(t,[{key:"prepareSprite",value:function(){var e=this,t=function(e,t){return 1e3*(Math.random()*(t-e)+e)},i=this.controller.levelView.actionGroup,n=[];this.sprite=i.create(0,0,"chicken","chicken0001.png"),this.sprite.scale.setTo(.75,.75);for(var o=["chicken0222.png","chicken0111.png","chicken0001.png","chicken0333.png"],a=[[[259,275],[225,227],[224,226],[285,287],[276,281],[291,302],[303,313],[314,326],[327,332],[460,467],[240,249]],[[148,164],[114,116],[113,115],[174,176],[165,170],[180,191],[192,202],[203,215],[216,221],[452,459],[129,138]],[[37,53],[3,5],[12,14],[63,65],[54,59],[69,80],[81,91],[92,104],[105,110],[444,451],[18,27]],[[370,386],[336,338],[335,337],[396,398],[387,392],[402,413],[414,424],[425,437],[438,443],[468,475],[351,360]]],r=0;r<4;r++){var s=this.controller.levelView.getDirectionName(r);n=Phaser.Animation.generateFrameNames("chicken",a[r][0][0],a[r][0][1],".png",4);for(var l=0;l<8;l++)n.push(o[r]);this.sprite.animations.add("idle"+s,n,12,!1).onComplete.add(function(){e.playRandomIdle(e.facing)}),n=Phaser.Animation.generateFrameNames("chicken",a[r][1][0],a[r][1][1],".png",4),this.sprite.animations.add("lookLeft"+s,n,12,!1).onComplete.add(function(){e.sprite.animations.stop(),setTimeout(function(){e.controller.levelView.playScaledSpeed(e.sprite.animations,"lookLeft"+e.controller.levelView.getDirectionName(e.facing)+"_2")},t(.2,1))}),n=Phaser.Animation.generateFrameNames("chicken",a[r][1][1],a[r][1][0],".png",4),this.sprite.animations.add("lookLeft"+s+"_2",n,12,!1).onComplete.add(function(){e.controller.levelView.playScaledSpeed(e.sprite.animations,"idle"+e.controller.levelView.getDirectionName(e.facing))}),n=Phaser.Animation.generateFrameNames("chicken",a[r][2][0],a[r][2][1],".png",4),this.sprite.animations.add("lookRight"+s,n,12,!1).onComplete.add(function(){e.sprite.animations.stop(),setTimeout(function(){e.controller.levelView.playScaledSpeed(e.sprite.animations,"lookRight"+e.controller.levelView.getDirectionName(e.facing)+"_2")},t(.2,1))}),n=Phaser.Animation.generateFrameNames("chicken",a[r][2][1],a[r][2][0],".png",4),this.sprite.animations.add("lookRight"+s+"_2",n,12,!1).onComplete.add(function(){e.controller.levelView.playScaledSpeed(e.sprite.animations,"idle"+e.controller.levelView.getDirectionName(e.facing))}),n=Phaser.Animation.generateFrameNames("chicken",a[r][3][0],a[r][3][1],".png",4),this.sprite.animations.add("lookAtCam"+s,n,12,!1).onComplete.add(function(){e.sprite.animations.stop(),setTimeout(function(){e.controller.levelView.playScaledSpeed(e.sprite.animations,"lookAtCam"+e.controller.levelView.getDirectionName(e.facing)+"_2")},t(.2,1))}),n=Phaser.Animation.generateFrameNames("chicken",a[r][3][1],a[r][3][0],".png",4),this.sprite.animations.add("lookAtCam"+s+"_2",n,12,!1).onComplete.add(function(){e.controller.levelView.playScaledSpeed(e.sprite.animations,"idle"+e.controller.levelView.getDirectionName(e.facing))}),n=Phaser.Animation.generateFrameNames("chicken",a[r][4][0],a[r][4][1],".png",4),this.sprite.animations.add("lookDown"+s,n,12,!1).onComplete.add(function(){e.controller.levelView.playScaledSpeed(e.sprite.animations,"idle"+e.controller.levelView.getDirectionName(e.facing))}),n=Phaser.Animation.generateFrameNames("chicken",a[r][5][0],a[r][5][1],".png",4),this.sprite.animations.add("walk"+s,n,12,!0),n=Phaser.Animation.generateFrameNames("chicken",a[r][6][0],a[r][6][1],".png",4),this.sprite.animations.add("attack"+s,n,12,!1).onComplete.add(function(){e.controller.levelView.playScaledSpeed(e.sprite.animations,"idle"+e.controller.levelView.getDirectionName(e.facing))}),n=Phaser.Animation.generateFrameNames("chicken",a[r][7][0],a[r][7][1],".png",4),this.sprite.animations.add("hurt"+s,n,12,!1).onComplete.add(function(){e.controller.levelView.playScaledSpeed(e.sprite.animations,"idle"+e.controller.levelView.getDirectionName(e.facing))}),n=Phaser.Animation.generateFrameNames("chicken",a[r][8][0],a[r][8][1],".png",4),this.sprite.animations.add("die"+s,n,12,!1),n=this.controller.levelView.generateReverseFrames("chicken",a[r][9][0],a[r][9][1],".png",4),this.sprite.animations.add("bump"+s,n,12,!1).onComplete.add(function(){e.controller.levelView.playScaledSpeed(e.sprite.animations,"idle"+e.controller.levelView.getDirectionName(e.facing))}),n=Phaser.Animation.generateFrameNames("chicken",a[r][10][0],a[r][10][1],".png",4),this.sprite.animations.add("eat"+s,n,12,!1).onComplete.add(function(){e.sprite.animations.stop(),setTimeout(function(){e.controller.levelView.playScaledSpeed(e.sprite.animations,"eat"+e.controller.levelView.getDirectionName(e.facing)+"_2")},t(.2,1))}),n=Phaser.Animation.generateFrameNames("chicken",a[r][10][1],a[r][10][0],".png",4),this.sprite.animations.add("eat"+s+"_2",n,12,!1).onComplete.add(function(){e.controller.levelView.playScaledSpeed(e.sprite.animations,"idle"+e.controller.levelView.getDirectionName(e.facing))})}this.controller.levelView.playScaledSpeed(this.sprite.animations,"idle"+this.controller.levelView.getDirectionName(this.facing)),this.sprite.x=this.offset[0]+40*this.position.x,this.sprite.y=this.offset[1]+40*this.position.y}}]),t}()},function(e,t,i){"use strict";var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();var o=i(1),a=i(9).randomInt;e.exports=function(e){function t(e,i,n,o,a,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var s=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i,n,o,a,r));return s.offset=[-50,-84],s.prepareSprite(),s.sprite.sortOrder=s.controller.levelView.yToIndex(Number.MAX_SAFE_INTEGER),s.audioDelay=15,o<5?s.patrolA():s.patrolB(),s}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o),n(t,[{key:"prepareSprite",value:function(){var e=this,t=function(e,t){return 1e3*(Math.random()*(t-e)+e)},i=this.controller.levelView.actionGroup,n=[];this.sprite=i.create(0,0,"ghast","Ghast0000.png"),this.sprite.scale.setTo(1,1);for(var o=[[[72,83],[84,95]],[[48,59],[60,71]],[[24,35],[36,47]],[[0,11],[12,23]]],r=0;r<4;r++){var s=this.controller.levelView.getDirectionName(r);n=Phaser.Animation.generateFrameNames("Ghast",o[r][0][0],o[r][0][1],".png",4);for(var l=a(2,n.length),c=[],h=0;h<l;++h)c.push(n[0]),n.splice(0,1);for(var u=0;u<c.length;++u)n.push(c[u]);for(var d=0;d<0;d++)n.push(n[0]);this.sprite.animations.add("idle"+s,n,12,!1).onComplete.add(function(){e.playRandomIdle(e.facing)}),n=Phaser.Animation.generateFrameNames("Ghast",o[r][1][0],o[r][1][1],".png",4),this.sprite.animations.add("shoot"+s,n,12,!1).onComplete.add(function(){e.sprite.animations.stop(),setTimeout(function(){e.controller.levelView.playScaledSpeed(e.sprite.animations,"shoot"+e.controller.levelView.getDirectionName(e.facing)+"_2")},t(.2,1))}),n=Phaser.Animation.generateFrameNames("Ghast",o[r][1][1],o[r][1][0],".png",4),this.sprite.animations.add("shoot"+s+"_2",n,12,!1).onComplete.add(function(){e.controller.levelView.playScaledSpeed(e.sprite.animations,"idle"+e.controller.levelView.getDirectionName(e.facing))})}this.controller.levelView.playScaledSpeed(this.sprite.animations,"idle"+this.controller.levelView.getDirectionName(this.facing)),this.sprite.x=this.offset[0]+40*this.position.x,this.sprite.y=this.offset[1]+40*this.position.y}},{key:"canMoveThrough",value:function(){return!0}},{key:"playRandomIdle",value:function(e){var t="";if(t+="idle",t+=this.controller.levelView.getDirectionName(e),this.controller.levelView.playScaledSpeed(this.sprite.animations,t),this.audioDelay>0)--this.audioDelay;else if(this.audioDelay=5,0===Math.floor(5*Math.random())){var i=Math.floor(4*Math.random());this.playMoan(i)}}},{key:"playMoan",value:function(e){switch(e){case 0:this.controller.audioPlayer.play("moan2");break;case 1:this.controller.audioPlayer.play("moan3");break;case 2:this.controller.audioPlayer.play("moan6");break;default:this.controller.audioPlayer.play("moan7")}}},{key:"patrolA",value:function(){var e,t,i=[Phaser.Easing.Sinusoidal.InOut,!0,0,-1,!0];(e=this.controller.levelView.addResettableTween(this.sprite)).to.apply(e,[{y:this.offset[1]+40*this.position.y+80},a(2500,3500)].concat(i)),(t=this.controller.levelView.addResettableTween(this.sprite)).to.apply(t,[{x:this.offset[0]+40*this.position.x+10},a(1500,2e3)].concat(i))}},{key:"patrolB",value:function(){var e,t,i=[Phaser.Easing.Sinusoidal.InOut,!0,0,-1,!0];(e=this.controller.levelView.addResettableTween(this.sprite)).to.apply(e,[{y:this.offset[1]+40*this.position.y-80},a(2500,3500)].concat(i)),(t=this.controller.levelView.addResettableTween(this.sprite)).to.apply(t,[{x:this.offset[0]+40*this.position.x-10},a(1500,2e3)].concat(i))}}]),t}()},function(e,t,i){"use strict";var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();e.exports=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.controller=t,this.audioPlayer=t.audioPlayer,this.game=t.game,this.assetRoot=t.assetRoot,this.assets={entityShadow:{type:"image",path:this.assetRoot+"images/Character_Shadow.png"},selectionIndicator:{type:"image",path:this.assetRoot+"images/Selection_Indicator.png"},tallGrass:{type:"image",path:this.assetRoot+"images/TallGrass.png"},finishOverlay:{type:"image",path:this.assetRoot+"images/WhiteRect.png"},bed:{type:"image",path:this.assetRoot+"images/Bed.png"},playerSteve:{type:"atlasJSON",pngPath:this.assetRoot+"images/Steve1013.png",jsonPath:this.assetRoot+"images/Steve1013.json"},playerAlex:{type:"atlasJSON",pngPath:this.assetRoot+"images/Alex1013.png",jsonPath:this.assetRoot+"images/Alex1013.json"},playerSteveEvents:{type:"atlasJSON",pngPath:this.assetRoot+"images/Steve_2016.png",jsonPath:this.assetRoot+"images/Steve_2016.json"},playerAlexEvents:{type:"atlasJSON",pngPath:this.assetRoot+"images/DevAlex.png",jsonPath:this.assetRoot+"images/DevAlex.json"},playerAgent:{type:"atlasJSON",pngPath:this.assetRoot+"images/Agent.png",jsonPath:this.assetRoot+"images/Agent.json"},AO:{type:"atlasJSON",pngPath:this.assetRoot+"images/AO.png",jsonPath:this.assetRoot+"images/AO.json"},LavaGlow:{type:"atlasJSON",pngPath:this.assetRoot+"images/LavaGlow.png",jsonPath:this.assetRoot+"images/LavaGlow.json"},WaterAO:{type:"atlasJSON",pngPath:this.assetRoot+"images/WaterAO.png",jsonPath:this.assetRoot+"images/WaterAO.json"},blockShadows:{type:"atlasJSON",pngPath:this.assetRoot+"images/Block_Shadows.png",jsonPath:this.assetRoot+"images/Block_Shadows.json"},undergroundFow:{type:"atlasJSON",pngPath:this.assetRoot+"images/UndergroundFoW.png",jsonPath:this.assetRoot+"images/UndergroundFoW.json"},blocks:{type:"atlasJSON",pngPath:this.assetRoot+"images/Blocks.png",jsonPath:this.assetRoot+"images/Blocks.json"},leavesAcacia:{type:"atlasJSON",pngPath:this.assetRoot+"images/Leaves_Acacia_Decay.png",jsonPath:this.assetRoot+"images/Leaves_Acacia_Decay.json"},leavesBirch:{type:"atlasJSON",pngPath:this.assetRoot+"images/Leaves_Birch_Decay.png",jsonPath:this.assetRoot+"images/Leaves_Birch_Decay.json"},leavesJungle:{type:"atlasJSON",pngPath:this.assetRoot+"images/Leaves_Jungle_Decay.png",jsonPath:this.assetRoot+"images/Leaves_Jungle_Decay.json"},leavesOak:{type:"atlasJSON",pngPath:this.assetRoot+"images/Leaves_Oak_Decay.png",jsonPath:this.assetRoot+"images/Leaves_Oak_Decay.json"},leavesSpruce:{type:"atlasJSON",pngPath:this.assetRoot+"images/Leaves_Spruce_Decay.png",jsonPath:this.assetRoot+"images/Leaves_Spruce_Decay.json"},leavesSpruceSnowy:{type:"atlasJSON",pngPath:this.assetRoot+"images/Leaves_Spruce_Snowy_Decay.png",jsonPath:this.assetRoot+"images/Leaves_Spruce_Snowy_Decay.json"},sheep:{type:"atlasJSON",pngPath:this.assetRoot+"images/Sheep_2016.png",jsonPath:this.assetRoot+"images/Sheep_2016.json"},crops:{type:"atlasJSON",pngPath:this.assetRoot+"images/Crops.png",jsonPath:this.assetRoot+"images/Crops.json"},torch:{type:"atlasJSON",pngPath:this.assetRoot+"images/Torch.png",jsonPath:this.assetRoot+"images/Torch.json"},destroyOverlay:{type:"atlasJSON",pngPath:this.assetRoot+"images/Destroy_Overlay.png",jsonPath:this.assetRoot+"images/Destroy_Overlay.json"},blockExplode:{type:"atlasJSON",pngPath:this.assetRoot+"images/BlockExplode.png",jsonPath:this.assetRoot+"images/BlockExplode.json"},miningParticles:{type:"atlasJSON",pngPath:this.assetRoot+"images/MiningParticles.png",jsonPath:this.assetRoot+"images/MiningParticles.json"},miniBlocks:{type:"atlasJSON",pngPath:this.assetRoot+"images/Miniblocks.png",jsonPath:this.assetRoot+"images/Miniblocks.json"},lavaPop:{type:"atlasJSON",pngPath:this.assetRoot+"images/LavaPop.png",jsonPath:this.assetRoot+"images/LavaPop.json"},redstoneSparkle:{type:"atlasJSON",pngPath:this.assetRoot+"images/Redstone_Sparkle.png",jsonPath:this.assetRoot+"images/Redstone_Sparkle.json"},fire:{type:"atlasJSON",pngPath:this.assetRoot+"images/Fire.png",jsonPath:this.assetRoot+"images/Fire.json"},bubbles:{type:"atlasJSON",pngPath:this.assetRoot+"images/Bubbles.png",jsonPath:this.assetRoot+"images/Bubbles.json"},explosion:{type:"atlasJSON",pngPath:this.assetRoot+"images/Explosion.png",jsonPath:this.assetRoot+"images/Explosion.json"},door:{type:"atlasJSON",pngPath:this.assetRoot+"images/Door.png",jsonPath:this.assetRoot+"images/Door.json"},doorIron:{type:"atlasJSON",pngPath:this.assetRoot+"images/Door_Iron.png",jsonPath:this.assetRoot+"images/Door_Iron.json"},rails:{type:"atlasJSON",pngPath:this.assetRoot+"images/Rails.png",jsonPath:this.assetRoot+"images/Rails.json"},tnt:{type:"atlasJSON",pngPath:this.assetRoot+"images/TNT.png",jsonPath:this.assetRoot+"images/TNT.json"},burningInSun:{type:"atlasJSON",pngPath:this.assetRoot+"images/BurningInSun.png",jsonPath:this.assetRoot+"images/BurningInSun.json"},zombie:{type:"atlasJSON",pngPath:this.assetRoot+"images/Zombie.png",jsonPath:this.assetRoot+"images/Zombie.json"},ironGolem:{type:"atlasJSON",pngPath:this.assetRoot+"images/Iron_Golem.png",jsonPath:this.assetRoot+"images/Iron_Golem.json"},creeper:{type:"atlasJSON",pngPath:this.assetRoot+"images/Creeper_2016.png",jsonPath:this.assetRoot+"images/Creeper_2016.json"},cow:{type:"atlasJSON",pngPath:this.assetRoot+"images/Cow.png",jsonPath:this.assetRoot+"images/Cow.json"},chicken:{type:"atlasJSON",pngPath:this.assetRoot+"images/Chicken.png",jsonPath:this.assetRoot+"images/Chicken.json"},ghast:{type:"atlasJSON",pngPath:this.assetRoot+"images/Ghast.png",jsonPath:this.assetRoot+"images/Ghast.json"},dig_wood1:{type:"sound",mp3:this.assetRoot+"audio/dig_wood1.mp3",wav:this.assetRoot+"audio/dig_wood1.wav",ogg:this.assetRoot+"audio/dig_wood1.ogg"},stepGrass:{type:"sound",mp3:this.assetRoot+"audio/step_grass1.mp3",wav:this.assetRoot+"audio/step_grass1.wav",ogg:this.assetRoot+"audio/step_grass1.ogg"},stepWood:{type:"sound",mp3:this.assetRoot+"audio/wood2.mp3",ogg:this.assetRoot+"audio/wood2.ogg"},stepStone:{type:"sound",mp3:this.assetRoot+"audio/stone2.mp3",ogg:this.assetRoot+"audio/stone2.ogg"},stepGravel:{type:"sound",mp3:this.assetRoot+"audio/gravel1.mp3",ogg:this.assetRoot+"audio/gravel1.ogg"},stepFarmland:{type:"sound",mp3:this.assetRoot+"audio/cloth4.mp3",ogg:this.assetRoot+"audio/cloth4.ogg"},failure:{type:"sound",mp3:this.assetRoot+"audio/break.mp3",ogg:this.assetRoot+"audio/break.ogg"},success:{type:"sound",mp3:this.assetRoot+"audio/levelup.mp3",ogg:this.assetRoot+"audio/levelup.ogg"},fall:{type:"sound",mp3:this.assetRoot+"audio/fallsmall.mp3",ogg:this.assetRoot+"audio/fallsmall.ogg"},fuse:{type:"sound",mp3:this.assetRoot+"audio/fuse.mp3",ogg:this.assetRoot+"audio/fuse.ogg"},explode:{type:"sound",mp3:this.assetRoot+"audio/explode3.mp3",ogg:this.assetRoot+"audio/explode3.ogg"},placeBlock:{type:"sound",mp3:this.assetRoot+"audio/cloth1.mp3",ogg:this.assetRoot+"audio/cloth1.ogg"},collectedBlock:{type:"sound",mp3:this.assetRoot+"audio/pop.mp3",ogg:this.assetRoot+"audio/pop.ogg"},bump:{type:"sound",mp3:this.assetRoot+"audio/hit3.mp3",ogg:this.assetRoot+"audio/hit3.ogg"},punch:{type:"sound",mp3:this.assetRoot+"audio/cloth1.mp3",ogg:this.assetRoot+"audio/cloth1.ogg"},fizz:{type:"sound",mp3:this.assetRoot+"audio/fizz.mp3",ogg:this.assetRoot+"audio/fizz.ogg"},doorOpen:{type:"sound",mp3:this.assetRoot+"audio/door_open.mp3",ogg:this.assetRoot+"audio/door_open.ogg"},houseSuccess:{type:"sound",mp3:this.assetRoot+"audio/launch1.mp3",ogg:this.assetRoot+"audio/launch1.ogg"},minecart:{type:"sound",mp3:this.assetRoot+"audio/minecartBase.mp3",ogg:this.assetRoot+"audio/minecartBase.ogg"},sheepBaa:{type:"sound",mp3:this.assetRoot+"audio/say3.mp3",ogg:this.assetRoot+"audio/say3.ogg"},chickenHurt:{type:"sound",mp3:this.assetRoot+"audio/chickenhurt2.mp3",ogg:this.assetRoot+"audio/chickenhurt2.ogg"},chickenBawk:{type:"sound",mp3:this.assetRoot+"audio/chickensay3.mp3",ogg:this.assetRoot+"audio/chickensay3.ogg"},cowHuff:{type:"sound",mp3:this.assetRoot+"audio/cowhuff.mp3",ogg:this.assetRoot+"audio/cowhuff.ogg"},cowHurt:{type:"sound",mp3:this.assetRoot+"audio/cowhurt.mp3",ogg:this.assetRoot+"audio/cowhurt.ogg"},cowMoo:{type:"sound",mp3:this.assetRoot+"audio/cowmoo1.mp3",ogg:this.assetRoot+"audio/cowmoo1.ogg"},cowMooLong:{type:"sound",mp3:this.assetRoot+"audio/cowmoolong.mp3",ogg:this.assetRoot+"audio/cowmoolong.ogg"},creeperHiss:{type:"sound",mp3:this.assetRoot+"audio/creeper.mp3",ogg:this.assetRoot+"audio/creeper.ogg"},ironGolemHit:{type:"sound",mp3:this.assetRoot+"audio/irongolemhit.mp3",ogg:this.assetRoot+"audio/irongolemhit.ogg"},metalWhack:{type:"sound",mp3:this.assetRoot+"audio/metalwhack.mp3",ogg:this.assetRoot+"audio/metalwhack.ogg"},zombieBrains:{type:"sound",mp3:this.assetRoot+"audio/zombiebrains.mp3",ogg:this.assetRoot+"audio/zombiebrains.ogg"},zombieGroan:{type:"sound",mp3:this.assetRoot+"audio/zombiegroan.mp3",ogg:this.assetRoot+"audio/zombiegroan.ogg"},zombieHurt:{type:"sound",mp3:this.assetRoot+"audio/zombiehurt1.mp3",ogg:this.assetRoot+"audio/zombiehurt1.ogg"},pistonIn:{type:"sound",mp3:this.assetRoot+"audio/piston_in.mp3",ogg:this.assetRoot+"audio/piston_in.ogg"},zombieHurt2:{type:"sound",mp3:this.assetRoot+"audio/zombiehurt2.mp3",ogg:this.assetRoot+"audio/zombiehurt2.ogg"},pistonOut:{type:"sound",mp3:this.assetRoot+"audio/piston_out.mp3",ogg:this.assetRoot+"audio/piston_out.ogg"},portalAmbient:{type:"sound",mp3:this.assetRoot+"audio/portal.mp3",ogg:this.assetRoot+"audio/portal.ogg"},portalTravel:{type:"sound",mp3:this.assetRoot+"audio/travel_portal.mp3",ogg:this.assetRoot+"audio/travel_portal.ogg"},pressurePlateClick:{type:"sound",mp3:this.assetRoot+"audio/pressurePlateClick.mp3",ogg:this.assetRoot+"audio/pressurePlateClick.ogg"},moan2:{type:"sound",mp3:this.assetRoot+"audio/moan2.mp3",ogg:this.assetRoot+"audio/moan2.ogg"},moan3:{type:"sound",mp3:this.assetRoot+"audio/moan3.mp3",ogg:this.assetRoot+"audio/moan3.ogg"},moan6:{type:"sound",mp3:this.assetRoot+"audio/moan6.mp3",ogg:this.assetRoot+"audio/moan6.ogg"},moan7:{type:"sound",mp3:this.assetRoot+"audio/moan7.mp3",ogg:this.assetRoot+"audio/moan7.ogg"}};var i=["chicken","entityShadow","selectionIndicator","AO","blockShadows","tallGrass","blocks","miniBlocks","stepGrass","failure","success"].concat(["dig_wood1","stepGrass","stepWood","stepStone","stepGravel","stepFarmland","failure","success","fall","fuse","explode","placeBlock","collectedBlock","bump","punch","fizz","doorOpen","minecart","sheepBaa","chickenHurt","chickenBawk","cowHuff","cowHurt","cowMoo","cowMooLong","creeperHiss","ironGolemHit","metalWhack","zombieBrains","zombieGroan","zombieHurt","pistonIn","pistonOut","portalAmbient","portalTravel","pressurePlateClick","moan2","moan3","moan6","moan7"]);this.assetPacks={adventurerLevelOneAssets:["entityShadow","selectionIndicator","AO","blockShadows","leavesOak","leavesBirch","tallGrass","blocks","sheep","bump","stepGrass","failure","success"],adventurerLevelTwoAssets:["entityShadow","selectionIndicator","AO","blockShadows","leavesSpruce","tallGrass","blocks","sheep","bump","stepGrass","failure","playerSteve","success","miniBlocks","blockExplode","miningParticles","destroyOverlay","dig_wood1","collectedBlock","punch"],adventurerLevelThreeAssets:["entityShadow","selectionIndicator","AO","blockShadows","leavesOak","tallGrass","blocks","sheep","bump","stepGrass","failure","playerSteve","success","miniBlocks","blockExplode","miningParticles","destroyOverlay","dig_wood1","collectedBlock","sheepBaa","punch"],adventurerAllAssetsMinusPlayer:["entityShadow","selectionIndicator","tallGrass","finishOverlay","bed","AO","LavaGlow","WaterAO","blockShadows","undergroundFow","blocks","leavesAcacia","leavesBirch","leavesOak","leavesSpruce","sheep","creeper","crops","torch","destroyOverlay","blockExplode","miningParticles","miniBlocks","lavaPop","fire","bubbles","explosion","door","rails","tnt","dig_wood1","stepGrass","stepWood","stepStone","stepGravel","stepFarmland","failure","success","fall","fuse","explode","placeBlock","collectedBlock","bump","punch","fizz","doorOpen","houseSuccess","minecart","sheepBaa"],levelOneAssets:i,levelTwoAssets:i,levelThreeAssets:i,designerAllAssetsMinusPlayer:["entityShadow","selectionIndicator","tallGrass","finishOverlay","bed","AO","LavaGlow","WaterAO","blockShadows","undergroundFow","blocks","leavesAcacia","leavesBirch","leavesJungle","leavesOak","leavesSpruce","sheep","creeper","crops","torch","destroyOverlay","blockExplode","miningParticles","miniBlocks","lavaPop","fire","bubbles","explosion","door","rails","tnt","dig_wood1","stepGrass","stepWood","stepStone","stepGravel","stepFarmland","failure","success","fall","fuse","explode","placeBlock","collectedBlock","bump","punch","fizz","doorOpen","houseSuccess","minecart","sheepBaa","zombie","cow","chicken","ironGolem","burningInSun","chickenHurt","chickenBawk","cowHuff","cowHurt","cowMoo","cowMooLong","creeperHiss","ironGolemHit","metalWhack","zombieBrains","zombieGroan","zombieHurt","zombieHurt2"],heroAllAssetsMinusPlayer:["entityShadow","selectionIndicator","tallGrass","finishOverlay","bed","AO","LavaGlow","WaterAO","blockShadows","undergroundFow","blocks","leavesAcacia","leavesBirch","leavesOak","leavesSpruce","leavesSpruceSnowy","sheep","creeper","crops","torch","destroyOverlay","blockExplode","miningParticles","miniBlocks","lavaPop","redstoneSparkle","fire","bubbles","explosion","door","doorIron","rails","tnt","dig_wood1","stepGrass","stepWood","stepStone","stepGravel","stepFarmland","failure","success","fall","fuse","explode","placeBlock","collectedBlock","bump","punch","fizz","doorOpen","houseSuccess","minecart","sheepBaa","zombie","cow","chicken","burningInSun","ghast","chickenHurt","chickenBawk","cowHuff","cowHurt","cowMoo","cowMooLong","creeperHiss","metalWhack","zombieBrains","zombieGroan","zombieHurt","zombieHurt2","pistonIn","pistonOut","portalAmbient","portalTravel","pressurePlateClick","moan2","moan3","moan6","moan7"],allAssetsMinusPlayer:["entityShadow","selectionIndicator","tallGrass","finishOverlay","bed","AO","LavaGlow","WaterAO","blockShadows","undergroundFow","blocks","leavesAcacia","leavesBirch","leavesJungle","leavesOak","leavesSpruce","leavesSpruceSnowy","sheep","creeper","crops","torch","destroyOverlay","blockExplode","miningParticles","miniBlocks","lavaPop","redstoneSparkle","fire","bubbles","explosion","door","doorIron","rails","tnt","dig_wood1","stepGrass","stepWood","stepStone","stepGravel","stepFarmland","failure","success","fall","fuse","explode","placeBlock","collectedBlock","bump","punch","fizz","doorOpen","houseSuccess","minecart","sheepBaa","zombie","cow","chicken","ghast","ironGolem","burningInSun","chickenHurt","chickenBawk","cowHuff","cowHurt","cowMoo","cowMooLong","creeperHiss","ironGolemHit","metalWhack","zombieBrains","zombieGroan","zombieHurt","zombieHurt2","pistonIn","pistonOut","portalAmbient","portalTravel","pressurePlateClick","moan2","moan3","moan6","moan7"],playerSteve:["playerSteve"],playerAlex:["playerAlex"],playerSteveEvents:["playerSteveEvents"],playerAlexEvents:["playerAlexEvents"],playerAgent:["playerAgent"],grass:["tallGrass"]}}return n(e,[{key:"loadPacks",value:function(e){var t=this;e.forEach(function(e){t.loadPack(e)})}},{key:"loadPack",value:function(e){var t=this.assetPacks[e];this.loadAssets(t)}},{key:"loadAssets",value:function(e){var t=this;e.forEach(function(e){var i=t.assets[e];t.loadAsset(e,i)})}},{key:"loadAsset",value:function(e,t){switch(t.type){case"image":this.game.load.image(e,t.path);break;case"sound":this.audioPlayer.register({id:e,mp3:t.mp3,ogg:t.ogg});break;case"atlasJSON":this.game.load.atlasJSONHash(e,t.pngPath,t.jsonPath);break;default:throw"Asset "+e+" needs config.type set in configuration."}}}]),e}()},function(e,t,i){"use strict";var n=i(29),o=i(30),a=i(31),r=i(32),s=i(33),l=i(34),c=i(35),h=i(36),u=i(4),d=i(37);e.exports.get=function(e){return{startCommandCollection:function(){e.DEBUG&&console.log("Collecting commands.")},startAttempt:function(t){e.OnCompleteCallback=t,e.setPlayerActionDelayByQueueLength(),e.queue.begin(),e.run(),e.attemptRunning=!0,e.resultReported=!1},resetAttempt:function(){e.reset(),e.queue.reset(),e.OnCompleteCallback=null,e.attemptRunning=!1},registerEventCallback:function(t,i){e.events.push(i)},onEventTriggered:function(e,t,i,n){this.registerEventCallback(e,function(e){e.eventType===i&&e.targetType===t&&n(e)})},isEventTriggered:function(e,t){return e.eventType===t},moveDirection:function(t,i,n){e.addCommand(new l(e,t,i,n),i)},moveForward:function(t,i){e.addCommand(new r(e,t,i),i)},moveBackward:function(t,i){e.addCommand(new s(e,t,i),i)},moveAway:function(t,i,n){var o=new u(e,t,function(){e.moveAway(o,n)},i);e.addCommand(o)},moveToward:function(t,i,n){var o=new u(e,t,function(){e.moveToward(o,n)},i);e.addCommand(o)},flashEntity:function(t,i){var n=new u(e,t,function(){e.flashEntity(n)},i);e.addCommand(n)},explodeEntity:function(t,i){var n=new u(e,t,function(){e.explodeEntity(n)},i);e.addCommand(n)},use:function(t,i){var n=new u(e,t,function(){e.use(n,i)},i);e.addCommand(n)},playSound:function(t,i,n){var o=new u(e,t,function(){e.playSound(o,i)},n);e.addCommand(o)},turn:function(t,i,n){var o=new u(e,t,function(){e.turn(o,"right"===i?1:-1)},n);e.addCommand(o)},turnRandom:function(t,i){var n=new u(e,t,function(){e.turnRandom(n)},i);e.addCommand(n)},turnRight:function(e,t){this.turn(e,"right",t)},turnLeft:function(e,t){this.turn(e,"left",t)},destroyBlock:function(t,i){var n=new u(e,t,function(){e.destroyBlock(n)},i);e.addCommand(n)},placeBlock:function(t,i,o){e.addCommand(new n(e,t,i,o),o)},placeDirection:function(t,i,n,o){e.addCommand(new a(e,t,i,n,o),n,o)},placeInFront:function(t,i,n){e.addCommand(new o(e,t,i,n),n)},tillSoil:function(t,i){e.addCommand(new o(e,t,"watering",i))},whilePathAhead:function(t,i,n,o){e.addCommand(new c(e,t,i,n,o),n)},ifBlockAhead:function(t,i,n,o){e.addCommand(new h(e,t,i,n,o),n)},repeat:function(t,i,n,o){e.addCommand(new d(e,t,i,n,o))},repeatRandom:function(t,i,n){var o=Math.floor(10*Math.random())+1;e.addCommand(new d(e,t,i,o,n))},getScreenshot:function(){return e.getScreenshot()},spawnEntity:function(t,i,n){var o=new u(e,t,function(){e.spawnEntity(o,i,n)});e.addCommand(o)},destroyEntity:function(t,i){var n=new u(e,t,function(){e.destroyEntity(n,i)},i);e.addGlobalCommand(n)},drop:function(t,i,n){var o=new u(e,t,function(){e.drop(o,i)},n);e.addCommand(o)},startDay:function(t){var i=new u(e,t,function(){e.startDay(i)});e.addGlobalCommand(i)},startNight:function(t){var i=new u(e,t,function(){e.startNight(i)});e.addGlobalCommand(i)},wait:function(t,i,n){var o=new u(e,t,function(){e.wait(o,i)},n);e.addGlobalCommand(o)},attack:function(t,i){var n=new u(e,t,function(){e.attack(n)},i);e.addCommand(n)},setDayNightCycle:function(t,i,n){e.dayNightCycle||(e.dayNightCycle=!0,e.initiateDayNightCycle(t,i,n))},addScore:function(t,i,n){var o=new u(e,t,function(){e.addScore(o,i)},n);e.addGlobalCommand(o)},arrowDown:function(t){e.arrowDown(t)},arrowUp:function(t){e.arrowUp(t)},clickDown:function(){e.clickDown()},clickUp:function(){e.clickUp()}}}},function(e,t,i){"use strict";var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();var o=i(0);e.exports=function(e){function t(e,i,n,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var a=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i,o));return a.BlockType=n,a}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o),n(t,[{key:"tick",value:function(){}},{key:"begin",value:function(){(function e(t,i,n){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,i);if(void 0===o){var a=Object.getPrototypeOf(t);return null===a?void 0:e(a,i,n)}if("value"in o)return o.value;var r=o.get;return void 0!==r?r.call(n):void 0})(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"begin",this).call(this),this.GameController.placeBlock(this,this.BlockType)}}]),t}()},function(e,t,i){"use strict";var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();var o=i(0);e.exports=function(e){function t(e,i,n,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var a=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i,o));return a.BlockType=n,a}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o),n(t,[{key:"tick",value:function(){}},{key:"begin",value:function(){(function e(t,i,n){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,i);if(void 0===o){var a=Object.getPrototypeOf(t);return null===a?void 0:e(a,i,n)}if("value"in o)return o.value;var r=o.get;return void 0!==r?r.call(n):void 0})(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"begin",this).call(this),this.GameController.placeBlockForward(this,this.BlockType)}}]),t}()},function(e,t,i){"use strict";var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();var o=i(0);e.exports=function(e){function t(e,i,n,o,a){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i,o));return r.BlockType=n,r.Direction=a,r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o),n(t,[{key:"tick",value:function(){}},{key:"begin",value:function(){(function e(t,i,n){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,i);if(void 0===o){var a=Object.getPrototypeOf(t);return null===a?void 0:e(a,i,n)}if("value"in o)return o.value;var r=o.get;return void 0!==r?r.call(n):void 0})(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"begin",this).call(this),this.GameController.placeBlockDirection(this,this.BlockType,this.Direction)}}]),t}()},function(e,t,i){"use strict";var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();var o=i(0);e.exports=function(e){function t(e,i,n){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i,n))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o),n(t,[{key:"tick",value:function(){}},{key:"begin",value:function(){(function e(t,i,n){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,i);if(void 0===o){var a=Object.getPrototypeOf(t);return null===a?void 0:e(a,i,n)}if("value"in o)return o.value;var r=o.get;return void 0!==r?r.call(n):void 0})(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"begin",this).call(this),this.GameController.moveForward(this)}}]),t}()},function(e,t,i){"use strict";var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();var o=i(0);e.exports=function(e){function t(e,i,n){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i,n))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o),n(t,[{key:"tick",value:function(){}},{key:"begin",value:function(){(function e(t,i,n){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,i);if(void 0===o){var a=Object.getPrototypeOf(t);return null===a?void 0:e(a,i,n)}if("value"in o)return o.value;var r=o.get;return void 0!==r?r.call(n):void 0})(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"begin",this).call(this),this.GameController.moveBackward(this)}}]),t}()},function(e,t,i){"use strict";var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();var o=i(0);e.exports=function(e){function t(e,i,n,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var a=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i,n,o));return a.Direciton=o,a}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o),n(t,[{key:"tick",value:function(){}},{key:"begin",value:function(){(function e(t,i,n){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,i);if(void 0===o){var a=Object.getPrototypeOf(t);return null===a?void 0:e(a,i,n)}if("value"in o)return o.value;var r=o.get;return void 0!==r?r.call(n):void 0})(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"begin",this).call(this),this.GameController.moveDirection(this,this.Direciton)}}]),t}()},function(e,t,i){"use strict";var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();var o=i(6),a=i(5),r=i(0);e.exports=function(e){function t(e,i,n,o,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var s=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i,o));return s.iterationsLeft=15,s.BlockType=n,s.WhileCode=r,s.queue=new a(e),s}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,r),n(t,[{key:"tick",value:function(){this.state===o.WORKING&&this.queue.tick(),this.queue.isFailed()&&(this.state=o.FAILURE),this.queue.isSucceeded()&&this.handleWhileCheck()}},{key:"begin",value:function(){(function e(t,i,n){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,i);if(void 0===o){var a=Object.getPrototypeOf(t);return null===a?void 0:e(a,i,n)}if("value"in o)return o.value;var r=o.get;return void 0!==r?r.call(n):void 0})(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"begin",this).call(this),this.GameController.DEBUG&&console.log("WHILE command: BEGIN"),this.handleWhileCheck()}},{key:"handleWhileCheck",value:function(){this.iterationsLeft<=0&&(this.state=o.FAILURE),this.GameController.isPathAhead(this.BlockType)?(this.queue.reset(),this.GameController.queue.setWhileCommandInsertState(this.queue),this.WhileCode(),this.GameController.queue.setWhileCommandInsertState(null),this.queue.begin()):this.state=o.SUCCESS,this.iterationsLeft--,this.GameController.DEBUG&&console.log("While command: Iterationsleft   "+this.iterationsLeft+" ")}}]),t}()},function(e,t,i){"use strict";var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();var o=i(6),a=i(5),r=i(0);e.exports=function(e){function t(e,i,n,o,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var s=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i,o));return s.blockType=n,s.ifCodeCallback=r,s.queue=new a(e),s}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,r),n(t,[{key:"tick",value:function(){this.state===o.WORKING&&this.queue.tick(),this.queue.isFailed()&&(this.state=o.FAILURE),this.queue.isSucceeded()&&(this.state=o.SUCCESS)}},{key:"begin",value:function(){(function e(t,i,n){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,i);if(void 0===o){var a=Object.getPrototypeOf(t);return null===a?void 0:e(a,i,n)}if("value"in o)return o.value;var r=o.get;return void 0!==r?r.call(n):void 0})(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"begin",this).call(this),this.GameController.DEBUG&&console.log("WHILE command: BEGIN"),this.handleIfCheck()}},{key:"handleIfCheck",value:function(){if(this.GameController.isPathAhead(this.blockType)){var e=this.GameController.getEntity(this.target).queue;this.queue.reset(),e.setWhileCommandInsertState(this.queue),this.ifCodeCallback(),e.setWhileCommandInsertState(null),this.queue.begin()}else this.state=o.SUCCESS}}]),t}()},function(e,t,i){"use strict";var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();var o=i(0);e.exports=function(e){function t(e,i,n,o,a){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i,a));return r.actionCallback=n,r.iteration=o,r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o),n(t,[{key:"tick",value:function(){}},{key:"begin",value:function(){(function e(t,i,n){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,i);if(void 0===o){var a=Object.getPrototypeOf(t);return null===a?void 0:e(a,i,n)}if("value"in o)return o.value;var r=o.get;return void 0!==r?r.call(n):void 0})(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"begin",this).call(this),this.succeeded(),this.addRepeatCommand()}},{key:"addRepeatCommand",value:function(){var e=this.GameController.levelEntity.entityMap.get(this.target);void 0===e?this.GameController.queue.addRepeatCommands(this.actionCallback,this.iteration):e.queue.addRepeatCommands(this.actionCallback,this.iteration)}}]),t}()}])});